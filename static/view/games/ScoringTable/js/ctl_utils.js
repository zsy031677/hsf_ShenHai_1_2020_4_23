function trace(e){console.log(e)}function isIOS(){for(var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];e.length;)if(navigator.platform===e.pop())return s_bIsIphone=!0,!0;return s_bIsIphone=!1,!1}function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler(),window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function getSize(e){var t,n=e.toLowerCase(),i=window.document,a=i.documentElement;if(void 0===window["inner"+e])t=a["client"+e];else if(window["inner"+e]!=a["client"+e]){var o=i.createElement("body");o.id="vpw-test-b",o.style.cssText="overflow:scroll";var s=i.createElement("div");s.id="vpw-test-d",s.style.cssText="position:absolute;top:-1000px",s.innerHTML="<style>@media("+n+":"+a["client"+e]+"px){body#vpw-test-b div#vpw-test-d{"+n+":7px!important}}</style>",o.appendChild(s),a.insertBefore(o,i.head),t=7==s["offset"+e]?a["client"+e]:window["inner"+e],a.removeChild(o)}else t=window["inner"+e];return t}function getIOSWindowHeight(){var e=document.documentElement.clientWidth/window.innerWidth;return window.innerHeight*e}function getHeightOfIOSToolbars(){var e=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return e>1?e:0}function sizeHandler(){if(window.scrollTo(0,1),$("#canvas")){var e;e=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var t=getSize("Width");_checkOrientation(t,e),s_iScaleFactor=Math.min(e/CANVAS_HEIGHT,t/CANVAS_WIDTH);var n=CANVAS_WIDTH*s_iScaleFactor,i=CANVAS_HEIGHT*s_iScaleFactor,a=0;i<e?(i+=a=e-i,n+=a*(CANVAS_WIDTH/CANVAS_HEIGHT)):n<t&&(n+=a=t-n,i+=a*(CANVAS_HEIGHT/CANVAS_WIDTH));var o=e/2-i/2,s=t/2-n/2,r=CANVAS_WIDTH/n;(s*r<-EDGEBOARD_X||o*r<-EDGEBOARD_Y)&&(s_iScaleFactor=Math.min(e/(CANVAS_HEIGHT-2*EDGEBOARD_Y),t/(CANVAS_WIDTH-2*EDGEBOARD_X)),n=CANVAS_WIDTH*s_iScaleFactor,o=(e-(i=CANVAS_HEIGHT*s_iScaleFactor))/2,s=(t-n)/2,r=CANVAS_WIDTH/n),s_fInverseScaling=r,s_iOffsetX=-1*s*r,s_iOffsetY=-1*o*r,o>=0&&(s_iOffsetY=0),s>=0&&(s_iOffsetX=0),null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY),null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY),$("#canvas").css("width",n+"px"),$("#canvas").css("height",i+"px"),o<0?($("#canvas").css("top",o+"px"),s_iCanvasOffsetHeight=o):($("#canvas").css("top","0px"),s_iCanvasOffsetHeight=0),$("#canvas").css("left",s+"px"),resizeCanvas3D(),s_iCanvasResizeWidth=n,s_iCanvasResizeHeight=i,s_iCanvasOffsetWidth=s,fullscreenHandler()}}function _checkOrientation(e,t){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(e>t?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()))}function createBitmap(e,t,n){var i=new createjs.Bitmap(e),a=new createjs.Shape;return t&&n?a.graphics.beginFill("#fff").drawRect(-t/2,-n/2,t,n):a.graphics.beginFill("#ff0").drawRect(0,0,e.width,e.height),i.hitArea=a,i}function createSprite(e,t,n,i,a,o){if(null!==t)s=new createjs.Sprite(e,t);else var s=new createjs.Sprite(e);var r=new createjs.Shape;return r.graphics.beginFill("#000000").drawRect(-n,-i,a,o),s.hitArea=r,s}function randomFloatBetween(e,t,n){return void 0===n&&(n=2),parseFloat(Math.min(e+Math.random()*(t-e),t).toFixed(n))}function shuffle(e){for(var t,n,i=e.length;0!==i;)n=Math.floor(Math.random()*i),t=e[i-=1],e[i]=e[n],e[n]=t;return e}function formatTime(e){e/=1e3;var t=Math.floor(e/60),n=e-60*t;n=parseFloat(n).toFixed(1);var i="";return i+=t<10?"0"+t+":":t+":",i+=n<10?"0"+n:n}function degreesToRadians(e){return e*Math.PI/180}function checkRectCollision(e,t){var n,i;return n=getBounds(e,.9),i=getBounds(t,.98),calculateIntersection(n,i)}function calculateIntersection(e,t){var n,i,a={},o={};return a.cx=e.x+(a.hw=e.width/2),a.cy=e.y+(a.hh=e.height/2),o.cx=t.x+(o.hw=t.width/2),o.cy=t.y+(o.hh=t.height/2),n=Math.abs(a.cx-o.cx)-(a.hw+o.hw),i=Math.abs(a.cy-o.cy)-(a.hh+o.hh),n<0&&i<0?(n=Math.min(Math.min(e.width,t.width),-n),i=Math.min(Math.min(e.height,t.height),-i),{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y),width:n,height:i,rect1:e,rect2:t}):null}function getBounds(e,t){var n={x:1/0,y:1/0,width:0,height:0};if(e instanceof createjs.Container){n.x2=-1/0,n.y2=-1/0;var i,a,o=e.children,s=o.length;for(a=0;a<s;a++)(i=getBounds(o[a],1)).x<n.x&&(n.x=i.x),i.y<n.y&&(n.y=i.y),i.x+i.width>n.x2&&(n.x2=i.x+i.width),i.y+i.height>n.y2&&(n.y2=i.y+i.height);n.x==1/0&&(n.x=0),n.y==1/0&&(n.y=0),n.x2==1/0&&(n.x2=0),n.y2==1/0&&(n.y2=0),n.width=n.x2-n.x,n.height=n.y2-n.y,delete n.x2,delete n.y2}else{var r,c,h,d,l,u={};if(e instanceof createjs.Bitmap)l=e.sourceRect||e.image,u.width=l.width*t,u.height=l.height*t;else if(e instanceof createjs.Sprite)if(e.spriteSheet._frames&&e.spriteSheet._frames[e.currentFrame]&&e.spriteSheet._frames[e.currentFrame].image){var m=e.spriteSheet.getFrame(e.currentFrame);u.width=m.rect.width,u.height=m.rect.height,u.regX=m.regX,u.regY=m.regY}else n.x=e.x||0,n.y=e.y||0;else n.x=e.x||0,n.y=e.y||0;u.regX=u.regX||0,u.width=u.width||0,u.regY=u.regY||0,u.height=u.height||0,n.regX=u.regX,n.regY=u.regY,r=e.localToGlobal(0-u.regX,0-u.regY),c=e.localToGlobal(u.width-u.regX,u.height-u.regY),h=e.localToGlobal(u.width-u.regX,0-u.regY),d=e.localToGlobal(0-u.regX,u.height-u.regY),n.x=Math.min(Math.min(Math.min(r.x,c.x),h.x),d.x),n.y=Math.min(Math.min(Math.min(r.y,c.y),h.y),d.y),n.width=Math.max(Math.max(Math.max(r.x,c.x),h.x),d.x)-n.x,n.height=Math.max(Math.max(Math.max(r.y,c.y),h.y),d.y)-n.y}return n}function NoClickDelay(e){this.element=e,window.Touch&&this.element.addEventListener("touchstart",this,!1)}function playSound(e,t,n){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[e].play(),s_aSounds[e].volume(t),s_aSounds[e].loop(n),s_aSounds[e]):null}function stopSound(e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].stop()}function setVolume(e,t){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].volume(t)}function setMute(e,t){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].mute(t)}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var i=t[n].split("=");if(i[0]==e)return i[1]}}function rotateVector2D(e,t){return{x:t.x*Math.cos(e)+t.y*Math.sin(e),y:t.x*-Math.sin(e)+t.y*Math.cos(e)}}function normalize(e,t){return t>0&&(e.x/=t,e.y/=t),e}function length(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function findNearestIntersectingObject(e,t,n,i){var a=CANVAS_RESIZE_WIDTH+2*OFFSET_WIDTH,o=CANVAS_RESIZE_HEIGHT+2*OFFSET_HEIGHT,s=new THREE.Raycaster,r=new THREE.Vector3;r.x=e/a*2-1,r.y=-t/o*2+1,r.z=.5,s.setFromCamera(r,n);var c=s.intersectObjects(i,!0),h=!1;return c.length>0&&(h=c[0]),h}function distance(e,t,n,i){var a=e-n,o=t-i;return Math.sqrt(a*a+o*o)}function distance2(e,t,n,i){var a=e-n,o=t-i;return a*a+o*o}function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}function createPerspectiveGraphicCamera(){var e=new THREE.PerspectiveCamera(FOV,CANVAS_WIDTH/CANVAS_HEIGHT,NEAR,FAR);return e.rotation.x=Math.radians(CAMERA_ROTATION.x),e.rotation.y=Math.radians(CAMERA_ROTATION.y),e.rotation.z=Math.radians(CAMERA_ROTATION.z),e.position.set(CAMERA_POSITION.x,CAMERA_POSITION.y,CAMERA_POSITION.z),e.updateProjectionMatrix(),e.updateMatrixWorld(),e}function rotateVector2D(e,t){return{x:t.x*Math.cos(e)+t.y*Math.sin(e),y:t.x*-Math.sin(e)+t.y*Math.cos(e),z:0}}function distanceV3(e,t,n,i,a,o){var s=e-i,r=t-a,c=n-o;return Math.sqrt(s*s+r*r+c*c)}function distanceV2(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function saveItem(e,t){localStorage.setItem(e,t)}function getItem(e){return localStorage.getItem(e)}function clearAllItem(){localStorage.clear()}function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.enabled&&(screen.height<window.innerHeight+3&&screen.height>window.innerHeight-3?s_bFullscreen=!0:s_bFullscreen=!1,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut())}var s_iOffsetX=0,s_iOffsetY=0,s_fInverseScaling=0;!function(e){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),$(window).resize(function(){sizeHandler()}),window.addEventListener("orientationchange",onOrientationChange),NoClickDelay.prototype={handleEvent:function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onTouchEnd(e)}},onTouchStart:function(e){e.preventDefault(),this.moved=!1,this.element.addEventListener("touchmove",this,!1),this.element.addEventListener("touchend",this,!1)},onTouchMove:function(e){this.moved=!0},onTouchEnd:function(e){if(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1),!this.moved){var t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY);3==t.nodeType&&(t=t.parentNode);var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),t.dispatchEvent(n)}}},function(){function e(e){var n="visible",i="hidden",a={focus:n,focusin:n,pageshow:n,blur:i,focusout:i,pagehide:i};(e=e||window.event).type in a?document.body.className=a[e.type]:(document.body.className=this[t]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var t="hidden";t in document?document.addEventListener("visibilitychange",e):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(t="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e}(),Math.radians=function(e){return e*Math.PI/180},Math.degrees=function(e){return 180*e/Math.PI},screenfull.enabled&&screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut()});