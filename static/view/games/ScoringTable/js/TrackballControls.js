THREE.TrackballControls=function(e,t){function o(e){!1!==s.enabled&&(window.removeEventListener("keydown",o),h=p,p===i.NONE&&(e.keyCode!==s.keys[i.ROTATE]||s.noRotate?e.keyCode!==s.keys[i.ZOOM]||s.noZoom?e.keyCode!==s.keys[i.PAN]||s.noPan||(p=i.PAN):p=i.ZOOM:p=i.ROTATE))}function n(e){!1!==s.enabled&&(e.preventDefault(),e.stopPropagation(),p!==i.ROTATE||s.noRotate?p!==i.ZOOM||s.noZoom?p!==i.PAN||s.noPan||f.copy(O(e.pageX,e.pageY)):E.copy(O(e.pageX,e.pageY)):l.copy(R(e.pageX,e.pageY)),trace(camera))}function a(e){!1!==s.enabled&&(e.preventDefault(),e.stopPropagation(),p=i.NONE,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a),s.dispatchEvent(T))}function c(e){if(!1!==s.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),g.y+=.01*t,s.dispatchEvent(b),s.dispatchEvent(T)}}var s=this,i={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var r=new THREE.Vector3,p=i.NONE,h=i.NONE,d=new THREE.Vector3,u=new THREE.Vector3,l=new THREE.Vector3,g=new THREE.Vector2,E=new THREE.Vector2,m=0,y=0,v=new THREE.Vector2,f=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var w={type:"change"},b={type:"start"},T={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var O=function(){var e=new THREE.Vector2;return function(t,o){return e.set((t-s.screen.left)/s.screen.width,(o-s.screen.top)/s.screen.height),e}}(),R=function(){var e=new THREE.Vector3,t=new THREE.Vector3,o=new THREE.Vector3;return function(n,a){o.set((n-.5*s.screen.width-s.screen.left)/(.5*s.screen.width),(.5*s.screen.height+s.screen.top-a)/(.5*s.screen.height),0);var c=o.length();return s.noRoll?c<Math.SQRT1_2?o.z=Math.sqrt(1-c*c):o.z=.5/c:c>1?o.normalize():o.z=Math.sqrt(1-c*c),d.copy(s.object.position).sub(s.target),e.copy(s.object.up).setLength(o.y),e.add(t.copy(s.object.up).cross(d).setLength(o.x)),e.add(d.setLength(o.z)),e}}();this.rotateCamera=function(){var e=new THREE.Vector3,t=new THREE.Quaternion;return function(){var o=Math.acos(u.dot(l)/u.length()/l.length());o&&(e.crossVectors(u,l).normalize(),o*=s.rotateSpeed,t.setFromAxisAngle(e,-o),d.applyQuaternion(t),s.object.up.applyQuaternion(t),l.applyQuaternion(t),s.staticMoving?u.copy(l):(t.setFromAxisAngle(e,o*(s.dynamicDampingFactor-1)),u.applyQuaternion(t)))}}(),this.zoomCamera=function(){if(p===i.TOUCH_ZOOM_PAN){e=m/y;m=y,d.multiplyScalar(e)}else{var e;1!==(e=1+(E.y-g.y)*s.zoomSpeed)&&e>0&&(d.multiplyScalar(e),s.staticMoving?g.copy(E):g.y+=(E.y-g.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,o=new THREE.Vector3;return function(){e.copy(f).sub(v),e.lengthSq()&&(e.multiplyScalar(d.length()*s.panSpeed),o.copy(d).cross(s.object.up).setLength(e.x),o.add(t.copy(s.object.up).setLength(e.y)),s.object.position.add(o),s.target.add(o),s.staticMoving?v.copy(f):v.add(e.subVectors(f,v).multiplyScalar(s.dynamicDampingFactor)))}}(),this.checkDistances=function(){s.noZoom&&s.noPan||(d.lengthSq()>s.maxDistance*s.maxDistance&&s.object.position.addVectors(s.target,d.setLength(s.maxDistance)),d.lengthSq()<s.minDistance*s.minDistance&&s.object.position.addVectors(s.target,d.setLength(s.minDistance)))},this.update=function(){d.subVectors(s.object.position,s.target),s.noRotate||s.rotateCamera(),s.noZoom||s.zoomCamera(),s.noPan||s.panCamera(),s.object.position.addVectors(s.target,d),s.checkDistances(),s.object.lookAt(s.target),r.distanceToSquared(s.object.position)>1e-6&&(s.dispatchEvent(w),r.copy(s.object.position))},this.reset=function(){p=i.NONE,h=i.NONE,s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.up.copy(s.up0),d.subVectors(s.object.position,s.target),s.object.lookAt(s.target),s.dispatchEvent(w),r.copy(s.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function(e){!1!==s.enabled&&(e.preventDefault(),e.stopPropagation(),p===i.NONE&&(p=e.button),p!==i.ROTATE||s.noRotate?p!==i.ZOOM||s.noZoom?p!==i.PAN||s.noPan||(v.copy(O(e.pageX,e.pageY)),f.copy(v)):(g.copy(O(e.pageX,e.pageY)),E.copy(g)):(u.copy(R(e.pageX,e.pageY)),l.copy(u)),document.addEventListener("mousemove",n,!1),document.addEventListener("mouseup",a,!1),s.dispatchEvent(b))},!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",function(e){if(!1!==s.enabled){switch(e.touches.length){case 1:p=i.TOUCH_ROTATE,u.copy(R(e.touches[0].pageX,e.touches[0].pageY)),l.copy(u);break;case 2:p=i.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;y=m=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(O(n,a)),f.copy(v);break;default:p=i.NONE}s.dispatchEvent(b)}},!1),this.domElement.addEventListener("touchend",function(e){if(!1!==s.enabled){switch(e.touches.length){case 1:l.copy(R(e.touches[0].pageX,e.touches[0].pageY)),u.copy(l);break;case 2:m=y=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;f.copy(O(t,o)),v.copy(f)}p=i.NONE,s.dispatchEvent(T)}},!1),this.domElement.addEventListener("touchmove",function(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:l.copy(R(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;y=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;f.copy(O(n,a));break;default:p=i.NONE}},!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",function(e){!1!==s.enabled&&(p=h,window.addEventListener("keydown",o,!1))},!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);