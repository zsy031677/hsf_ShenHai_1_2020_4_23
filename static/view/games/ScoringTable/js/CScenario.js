function CScenario(){var e,a,n,o,i,t,r,s,l,c,d;if(SHOW_3D_RENDER)var N=new CANNON.Demo;this.getDemo=function(){return N},this._init=function(){e=SHOW_3D_RENDER?N.getWorld():new CANNON.World,d=new Array,e.gravity.set(0,0,-196.2),e.broadphase=new CANNON.NaiveBroadphase,e.solver.iterations=10,e.solver.tolerance=1e-5,a=new CANNON.Material,n=new CANNON.Material,o=new CANNON.Material;var i=new CANNON.ContactMaterial(n,o,{friction:.2,restitution:.1}),t=new CANNON.ContactMaterial(n,a,{friction:.2,restitution:.1});e.addContactMaterial(i),e.addContactMaterial(t),s_oScenario._createFieldBody(),s_oScenario._createBallBody();var r=new THREE.LoadingManager;r.onProgress=function(e,a,n){console.log(e,a,n)};new THREE.FBXLoader(r).load("models/skeeball_collision_mesh_18.txt",function(e){s_oGame.scenarioLoaded(),s_oScenario.parseFile(e),e=null},function(e){e.lengthComputable&&(e.loaded,e.total)},function(e){trace("ERROR LOAD FBX")})},this.parseFile=function(e){for(var a=0;a<e.children.length;a++){var n=e.children[a];console.log("oMesh.name: "+n.name),"collision_mesh"===n.name?s_oScenario._createTable(n):s_oScenario._createHoles(n)}},this.__extractMeshData=function(e){for(var a=e.geometry.faces,n=e.geometry.vertices,o=new Array,i=0;i<a.length;i++)o[i]={a:a[i].a,b:a[i].b,c:a[i].c};for(var t=[],r=[],i=0;i<n.length;i++)t.push(1*n[i].x),t.push(1*n[i].y),t.push(1*n[i].z);for(i=0;i<a.length;i++)r.push(a[i].a),r.push(a[i].b),r.push(a[i].c);return new CANNON.Trimesh(t,r)},this._createTable=function(n){var o=this.__extractMeshData(n);(c=new CANNON.Body({mass:0,material:a})).addShape(o);var i=new CANNON.Vec3(n.position.x,n.position.y,n.position.z);c.position.copy(i),c.addEventListener("collide",function(e){}),e.addBody(c),SHOW_3D_RENDER&&N.addVisual(c)},this._createFieldBody=function(){if(s=new CANNON.Plane,(l=new CANNON.Body({mass:0,material:a})).addShape(s),l.addEventListener("collide",function(e){s_oScenario.fieldCollision()}),e.addBody(l),SHOW_3D_RENDER){var n=new THREE.MeshPhongMaterial({color:5803568,specular:1118481,shininess:10});N.addVisual(l,n)}},this._createBallBody=function(){i=new CANNON.Sphere(BALL_RADIUS),t=new CANNON.Body({mass:BALL_MASS,material:n,linearDamping:BALL_LINEAR_DAMPING,angularDamping:BALL_LINEAR_DAMPING});var a=new CANNON.Vec3(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);if(t.position.copy(a),t.addShape(i),e.add(t),SHOW_3D_RENDER){var o=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:70,wireframe:!0});r=N.addVisual(t,o)}},this._createHoles=function(n){var o=this.__extractMeshData(n),i=new CANNON.Body({mass:0,material:a});i.addShape(o);var t=new CANNON.Vec3(n.position.x,n.position.y,n.position.z);if(i.position.copy(t),i.collisionResponse=0,i.addEventListener("collide",function(e){s_oGame.goal(n.name)}),e.addBody(i),SHOW_3D_RENDER){var r=new THREE.MeshPhongMaterial({color:14549117,specular:1118481,shininess:70});N.addVisual(i,r)}},this.addImpulse=function(e,a){var n=new CANNON.Vec3(0,0,0);e.applyLocalImpulse(a,n)},this.addForce=function(e,a){var n=new CANNON.Vec3(a.x,a.y,a.z);e.applyForce(n,e.position)},this.ballBody=function(){return t},this.getCamera=function(){return N.camera()},this.getDemo=function(){return N},this.getWorld=function(){return e},this.fieldCollision=function(){s_oGame.fieldCollision(),s_oGame.ballFadeForReset()},this.getFieldBody=function(){return l},this.getTableBody=function(){return c},this.update=function(){e.step(PHYSICS_STEP)},this.destroyWorld=function(){for(var a=e.bodies,n=0;n<a.length;n++)e.remove(a[n]);e=null},s_oScenario=this,SHOW_3D_RENDER?(N.addScene("Test",this._init),N.start()):this._init()}var s_oScenario;