function popElementFromArray(t,e){for(var i=0;i<e.length;i++)if(e[i]===t)return e.splice(i,1),void i--}function popAllElementsFromArray(t){t.splice(0,t.length)}function isInArray(t,e){for(var i=0,n=0;n<e.length;n++)e[n]===t&&i++;return i}function getCursorPositionXY(t){var e,i;return isMobile()?(e=t.pageX,i=t.pageY):(e=t.clientX,i=t.clientY),{x:e,y:i}}function cssTransform(t,e,i,n,a,o){if(Device.isNative()){s={matrix:e,translate:[o.x,o.y],rotate:i};t.css("transform",s)}else{var s="";null!=e&&(s+="matrix("+e+")"),Device.supports3dTransfrom()?(null!=o&&(s+=" translate3d("+o.x+"px, "+o.y+"px, 0px)"),null!=i&&(s+=" rotate3d(0, 0, 1, "+i+"deg)"),(n||a)&&(s+=" scale3d("+(n=n||1)+", "+(a=a||1)+", 1)")):(null!=o&&(s+=" translateX("+o.x+"px)",s+=" translateY("+o.y+"px)"),null!=i&&(s+=" rotate("+i+"deg)"),null!=n&&(s+=" scaleX("+n+")"),null!=a&&(s+=" scaleY("+a+")")),t.css("-webkit-transform",s),t.css("-moz-transform",s),t.css("transform",s),t.css("-o-transform",s),t.css("transform",s),t.css("msTransform",s)}}function eLog(t,e,i){eLog.displayF&&(i&&i>eLog.currentLevel||(e?eLog.displayF(e+" :  "+t):eLog.displayF(t)))}function preventDefaultEventFunction(t){return t.preventDefault(),!1}function makeUnselectable(t){t.addClass("unselectable"),t.bind("touchstart",function(t){return t.preventDefault(),!1}),t.bind("touchmove",function(t){return t.preventDefault(),!1}),t.bind("touchend",function(t){return t.preventDefault(),!1})}function makeClickTransparent(t){t.css("pointer-events","none")}function loadMedia(t,e,i,n){for(var a,o,s,r=0,c=t.length,l=c,u=0;r<c;++r){if(a=t[r],"mp3"===(s=a.substr(a.lastIndexOf(".")+1).toLowerCase())||"wav"===s||"ogg"===s||"mp4"===s)o=new Audio(a),-1!=navigator.userAgent.indexOf("Chrome")&&u++;else{if("jpg"!==s&&"jpeg"!==s&&"gif"!==s&&"png"!==s){l--;continue}(o=new Image).src=a}assets[a]=o,o.onload=function(){++u,i&&i.call(this,{loaded:u,total:l,percent:u/l*100}),u===l&&e&&e()},o.onerror=function(){n?n.call(this,{loaded:u,total:l,percent:u/l*100}):++u===l&&e&&e()}}}function distance(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function selectValue(){for(var t=0;t<arguments.length-1;t++)if(null!=(e=arguments[t]))return e;var e;return e=arguments[arguments.length-1]}function RandomNumberGenerator(t){function e(){a=(a+i[n=(n+1)%256])%256;var t=i[n];return i[n]=i[a],i[a]=t,i[(i[n]+i[a])%256]}var i=[],n=0,a=0;!function(t){for(n=0;n<256;n++)i[n]=n;for(var e=0,n=0;n<256;n++){e=(e+i[n]+t.charCodeAt(n%t.length))%256;var a=i[n];i[n]=i[e],i[e]=a}}(t),this.next=function(){for(var t=0,i=1,n=0;n<8;n++)t+=e()*i,i*=256;return t/0x10000000000000000}}function cloneObject(t){if("object"==typeof t&&t.length){for(var e=[],i=0;i<t.length;i++)e[i]=cloneObject(t[i]);return e}if(null==t||"object"!=typeof t)return t;var n={};for(var a in t)n[a]=cloneObject(t[a]);return n}function toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function turnOnOnScreenDebug(){return DEBUG_INTERFACE.toppos=0,DEBUG_INTERFACE.div=document.createElement("div"),DEBUG_INTERFACE.div.style.position="fixed",DEBUG_INTERFACE.div.style.zIndex=1e8,DEBUG_INTERFACE.div.style.fontSize="12px",DEBUG_INTERFACE.div.style.marginTop="30px",DEBUG_INTERFACE.div.style.marginLeft="50px",DEBUG_INTERFACE.div.style.backgroundColor="rgba(255,255,255,0.5)",document.body.appendChild(DEBUG_INTERFACE.div),DEBUG_INTERFACE.text1="",DEBUG_INTERFACE.log=function(t){DEBUG_INTERFACE.text1+=t;var e=DEBUG_INTERFACE.div;if(e.innerHTML="<p>"+DEBUG_INTERFACE.text1+"</p>",e.clientHeight>500){var i=530-e.clientHeight;e.style.marginTop=i+"px"}},DEBUG_INTERFACE.div2=document.createElement("div"),DEBUG_INTERFACE.div2.style.position="fixed",DEBUG_INTERFACE.div2.style.zIndex=1e8,DEBUG_INTERFACE.div2.style.marginTop="30px",DEBUG_INTERFACE.div2.style.marginLeft="200px",DEBUG_INTERFACE.div2.style.backgroundColor="white",document.body.appendChild(DEBUG_INTERFACE.div2),DEBUG_INTERFACE.log2=function(t){DEBUG_INTERFACE.div2.innerHTML=t},DEBUG_INTERFACE.div3=document.createElement("div"),DEBUG_INTERFACE.div3.style.position="fixed",DEBUG_INTERFACE.div3.style.zIndex=1e8,DEBUG_INTERFACE.div3.style.fontSize="12px",DEBUG_INTERFACE.div3.style.marginTop="30px",DEBUG_INTERFACE.div3.style.marginLeft="400px",DEBUG_INTERFACE.div3.style.backgroundColor="rgba(255,255,255,0.5)",document.body.appendChild(DEBUG_INTERFACE.div3),DEBUG_INTERFACE.text="",DEBUG_INTERFACE.log3=function(t){var e=DEBUG_INTERFACE.div3;if(DEBUG_INTERFACE.text+=t,e.innerHTML="<p>"+DEBUG_INTERFACE.text+"</p>",e.clientHeight>500){var i=530-e.clientHeight;e.style.marginTop=i+"px"}},DEBUG_INTERFACE.div4=document.createElement("div"),DEBUG_INTERFACE.div4.style.position="fixed",DEBUG_INTERFACE.div4.style.zIndex=1e8,DEBUG_INTERFACE.div4.style.fontSize="12px",DEBUG_INTERFACE.div4.style.marginTop="30px",DEBUG_INTERFACE.div4.style.marginLeft="900px",DEBUG_INTERFACE.div4.style.backgroundColor="rgba(255,255,255,0.5)",document.body.appendChild(DEBUG_INTERFACE.div4),DEBUG_INTERFACE.text3="",DEBUG_INTERFACE.log4=function(t){var e=DEBUG_INTERFACE.div4;if(DEBUG_INTERFACE.text3+=t,e.innerHTML="<p>"+DEBUG_INTERFACE.text3+"</p>",e.clientHeight>500){var i=530-e.clientHeight;e.style.marginTop=i+"px"}},DEBUG_INTERFACE.active=!0,DEBUG_INTERFACE}function isImageOk(t){return!!t.complete&&(void 0===t.naturalWidth||0!==t.naturalWidth)}function countProperties(t){return Object.keys(t).length}function ColorRgb(t,e,i){this.r=t,this.g=e,this.b=i}function ColorRgbChangingPair(t,e){this.a=t,this.b=e}function recolorImage(t,e){var i=document.createElement("canvas"),n=i.getContext("2d"),a=t.width,o=t.height;i.width=a,i.height=o,n.drawImage(t,0,0,a,o);for(var s=n.getImageData(0,0,a,o),r=0;r<s.data.length;r+=4)for(var c=0;c<e.length;c++){var l=e[c].a,u=e[c].b;if(s.data[r]==l.r&&s.data[r+1]==l.g&&s.data[r+2]==l.b){s.data[r]=u.r,s.data[r+1]=u.g,s.data[r+2]=u.b;break}}n.putImageData(s,0,0);var h=i.toDataURL("image/png");try{i.remove()}catch(t){console.error("recolorImage: "+t)}return i=null,h}function recolorFullImage(t,e){var i=document.createElement("canvas"),n=i.getContext("2d"),a=t.width,o=t.height;i.width=a,i.height=o,n.drawImage(t,0,0,a,o);for(var s=n.getImageData(0,0,a,o),r=new ColorRgb(0,0,0),c=0;c<s.data.length;c+=4)if(0!==s.data[c]||0!==s.data[c+1]||0!==s.data[c+2]||0!==s.data[c+3]){var l=e.a,u=e.b;r.set(s.data[c],s.data[c+1],s.data[c+2]),r.subtract(l),r.add(u),s.data[c]=r.r,s.data[c+1]=r.g,s.data[c+2]=r.b}n.putImageData(s,0,0);var h=i.toDataURL("image/png");try{i.remove()}catch(t){console.error("recolorFullImage: "+t)}return i=null,h}function AssertException(t){this.message=t}function assert(t,e){if(!t)throw new AssertException(e)}function isMobile(){if(null!=mobileBrowser)return mobileBrowser;var t=navigator.userAgent.toLowerCase(),e=(/(webkit)[ \/]([\w.]+)/.exec(t)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(t)||/(ms)ie ([\w.]+)/.exec(t)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(t),/iPad|iPod|iPhone|Android|webOS/i.exec(t));return mobileBrowser=e}function Transform(){this.m=[1,0,0,1,0,0]}function AbstractFactory(){var t=new Object;this.addClass=function(e,i){var n;"function"==typeof e?(n=e.prototype.className,i=e.prototype.createInstance):n=e,assert("string"==typeof n,"Invalid classId: "+n),assert("function"==typeof i,"Invalid createInstance function for classId "+n),t[n]=i},this.createObject=function(e,i){var n=t[e];assert("function"==typeof n,"classId: "+e+" was not properly registered.");return"array"==typeof i?n.apply(null,i):n.call(null,i)},this.createObjectsFromJson=function(t,e,i){var n=new Object,a=this;return $.each(t,function(t,o){var s=o.params;assert(s,"Params field not specified in '"+t+"'"),s.name=t,e&&e(t,s);var r=a.createObject(o.class,s);n[t]=r,i&&i(t,r,s)}),n}}function Entity(){}function BaseState(){BaseState.parent.constructor.call(this)}function Account(t){Account.parent.constructor.call(this)}function VisualEntity(){VisualEntity.parent.constructor.call(this)}function Scene(){Scene.parent.constructor.call(this)}function Item(){Item.parent.constructor.call(this)}function SimpleCountdown(){SimpleCountdown.parent.constructor.call(this)}function Countdown(){Countdown.parent.constructor.call(this)}function Inventory(){Inventory.parent.constructor.call(this)}function BackgroundState(){BackgroundState.parent.constructor.call(this)}function boxPolyVertices(t,e,i,n){var a=t,o=e,s=i,r=n;return[{x:a,y:o},{x:a+s,y:o},{x:a+s,y:o+r},{x:a,y:o+r}]}function calculateAngle(t,e){var i=new b2Vec2(t.x,t.y),n=new b2Vec2(e.x,e.y),a=(t.x*e.x+t.y*e.y)/(i.Length()*n.Length());return MathUtils.toDeg(Math.acos(a))}function calculateSignedAngle(t,e){var i=new b2Vec2(t.x,t.y),n=new b2Vec2(e.x,e.y);return(t.x*e.y+t.y*e.x)/(i.Length()*n.Length())}function DebugCanvas(){var t=document.getElementById("debugCanvas");t||($("#root").append("<canvas id='debugCanvas' style='position :absolute; top: 0px; left: 0px;'></canvas>"),t=document.getElementById("debugCanvas")),t.width=BASE_WIDTH,t.height=BASE_HEIGHT,t.style.width=t.width*Screen.widthRatio(),t.style.height=t.height*Screen.heightRatio();var e=new b2DebugDraw;e.SetSprite(t.getContext("2d")),e.SetDrawScale(Physics.getB2dToGameRatio()),e.SetFillAlpha(.5),e.SetLineThickness(1),e.SetFlags(b2DebugDraw.e_shapeBit|b2DebugDraw.e_jointBit),Physics.getWorld().SetDebugDraw(e)}function ContactProcessor(){this.pairs={},this.defaultBegin=function(){},this.defaultEnd=function(){}}function PhysicEntity(){PhysicEntity.parent.constructor.call(this)}function PhysicScene(){PhysicScene.parent.constructor.call(this)}function Effect(){Effect.parent.constructor.call(this)}function GuiContainer(){this.guiEntities=null}function GuiElement(){}function GuiDiv(){GuiDiv.parent.constructor.call(this)}function GuiButton(){GuiButton.parent.constructor.call(this)}function GuiLabel(){GuiLabel.parent.constructor.call(this)}function GuiScroll(){GuiScroll.parent.constructor.call(this)}function GuiSprite(){GuiSprite.parent.constructor.call(this)}function GuiScene(){GuiScene.parent.constructor.call(this)}function GuiDialog(){GuiDialog.parent.constructor.call(this)}function GuiCanvas(){}function GuiCSprite(){}function startTheGame(){Device.init({name:"FootballTricks"}),(new CannonsAndSoldiersAccount).init(),Resources.init();try{SCORE=JSON.parse(Device.getStorageItem("scores",{})),$.each(SCORE,function(t,e){1})}catch(t){SCORE={}}Resources.addResolution("low","images/low/"),Resources.addResolution("normal","images/",!0),Resources.setLanguage("EN"),Device.isSlow()&&(Resources.setResolution("low"),Device.isAppleMobile()&&(Sound.TURNED_OFF_BY_DEFAULT=!0)),Screen.init(Account.instance,!0),Account.instance.readGlobalUpdate(Account.instance.states.MenuState01)}function CannonsAndSoldiersAccount(t){CannonsAndSoldiersAccount.parent.constructor.call(this)}function Country(t,e,i,n){this.name=t,this.shortName=e,this.shirtColor=null!=i?i:ColorRgb.Colors.WHITE,this.pantsColor=null!=n?n:ColorRgb.Colors.SILVER}function LevelMenuState(){this.preloadJson(LVL_MENU_GUI_JSON),this.preloadJson(LEVEL_ORDER),this.preloadJson(LEVEL_ORDER),LevelMenuState.parent.constructor.call(this)}function MenuState(){this.preloadJson(MENU_GUI_JSON),this.preloadJson(CREDITS_JSON),this.preloadJson(DESCRIPTIONS_JSON),this.preloadJson(COUNTRIES_SHEET),Account.instance.mediaPreloaded||(Sound.init("sounds/total",!0),Sound.add("click",2,.5,"sounds/total"),Sound.add("win_crowd_v2",45,5,"sounds/total",10),Sound.add("loss_crowd",40,4,"sounds/total",10),Sound.add("shot",5.1,.5,"sounds/total"),Sound.add("star",4,.4,"sounds/total"),Sound.add("bubble",3,.2,"sounds/total"),Sound.add("ball_jump_1",6,.2,"sounds/total"),Sound.add("ball_jump_2",7,.2,"sounds/total"),Sound.add("brick_cube_damaged",8,.8,"sounds/total"),Sound.add("brick_cube_destroyed",9,1.6,"sounds/total"),Sound.add("crossbar",11,1,"sounds/total"),Sound.add("glass_cube_damaged",13,1.3,"sounds/total"),Sound.add("glass_cube_destroyed",15,1.6,"sounds/total"),Sound.add("highlight_button",17,.4,"sounds/total"),Sound.add("metal_cube_hit_1",18,1.5,"sounds/total"),Sound.add("metal_cube_hit_2",20,1.5,"sounds/total"),Sound.add("net",23,1.4,"sounds/total"),Sound.add("push_button",50,.2,"sounds/total"),Sound.add("referee",26,1.2,"sounds/total",9),Sound.add("stadium",28,5.8,"sounds/total"),Sound.add("star",34,1.4,"sounds/total"),Sound.add("wood_cube_damaged",36,1,"sounds/total"),Sound.add("wood_cube_destroyed",38,1.75,"sounds/total"),Sound.add("first_star",52,.6,"sounds/total"),Sound.add("second_star",53,.6,"sounds/total"),Sound.add("third_star",54,.6,"sounds/total"),Sound.add("enemy_1",55,.5,"sounds/total"),Sound.add("enemy_2",56,.65,"sounds/total"),Sound.add("enemy_3",57,.75,"sounds/total"),Sound.add("ukraine_wins",58,6.6,"sounds/total",10)),MenuState.parent.constructor.call(this)}function CountrySelectMenuState(){this.preloadJson(COUNTRY_MENU_GUI_JSON),CountrySelectMenuState.parent.constructor.call(this)}function VelocitySoundProfile(t,e,i,n){this.min=t,this.max=e,this.priority=i,this.loop=n}function Player(){Player.parent.constructor.call(this),this.rotationCenter={x:138,y:85}}function Ball(){Ball.parent.constructor.call(this),this.leftScene=!1}function Block(){Block.parent.constructor.call(this)}function Enemy(){Enemy.parent.constructor.call(this)}function Ground(){Ground.parent.constructor.call(this)}function BattleScene(){BattleScene.parent.constructor.call(this),BattleScene.instance=this}function GameState(){this.preloadJson(GAME_GUI_JSON),this.preloadJson(LEVEL_DESCRIPTION),this.preloadJson(OBJECTS_DESCRIPTION),this.preloadJson(EVERY_LEVEL_OBJECTS),this.preloadJson(CONFIG),GameState.parent.constructor.call(this)}function Goal(){Goal.parent.constructor.call(this)}function FootballContactListener(){function t(t,e,i,n){return(null===e||null===i||t.m_fixtureA.m_body.m_userData.params.type===e&&t.m_fixtureB.m_body.m_userData.params.type===i||t.m_fixtureA.m_body.m_userData.params.type===i&&t.m_fixtureB.m_body.m_userData.params.type===e)&&(n(t),!0)}function e(t,e,i,n){return(null===e||null===i||t.m_fixtureA.m_body.m_userData.params.class===e&&t.m_fixtureB.m_body.m_userData.params.class===i||t.m_fixtureA.m_body.m_userData.params.class===i&&t.m_fixtureB.m_body.m_userData.params.class===e)&&(n(t),!0)}function i(t){var e,i;if("Ball"===t.m_fixtureA.m_body.m_userData.params.type?(e=t.m_fixtureA.m_body,i=t.m_fixtureB):(e=t.m_fixtureB.m_body,i=t.m_fixtureA),"net"===i.m_userData){var n=e.GetLinearVelocity(),a=n.LengthSquared();FtSound.playSoundProfile("net",Account.instance.configData.sounds.net,a),n.Multiply(.1),e.SetLinearVelocity(n)}else if("crossbar"===i.m_userData){a=e.GetLinearVelocity().LengthSquared();FtSound.playSoundProfile("crossbar",Account.instance.configData.sounds.crossbar,a)}else if("body"===i.m_userData){Account.instance.getEntity("Scene01").scoreGoal()}}function n(t){var e=t.m_fixtureA.m_body,i=t.m_fixtureB.m_body,n=e.m_mass*Math.pow(e.m_linearVelocity.Length(),2),a=i.m_mass*Math.pow(i.m_linearVelocity.Length(),2);"Ground"===e.m_userData.params.type&&(n=10*a);var o=a*SELF_DESTR_MULT+n*SELF_DESTR_MULT;e.m_userData&&e.m_userData.onDamage&&e.m_userData.onDamage(o/2),i.m_userData&&i.m_userData.onDamage&&i.m_userData.onDamage(o/2)}function a(t){"Star"===t.m_fixtureA.m_body.m_userData.params.type?t.m_fixtureA.m_body.m_userData.destroyAndPlayAnimation():t.m_fixtureB.m_body.m_userData.destroyAndPlayAnimation(),Sound.playWithVolume("star")}function o(t){var e,i;"Ball"===t.m_fixtureA.m_body.m_userData.params.type?(e=t.m_fixtureA.m_body,i=t.m_fixtureB.m_body.m_userData):(e=t.m_fixtureB.m_body,i=t.m_fixtureA.m_body.m_userData),i.kickBall(e)}function s(t){var e,i=(e="Ball"===t.m_fixtureA.m_body.m_userData.params.type?t.m_fixtureA.m_body:t.m_fixtureB.m_body).GetLinearVelocity().LengthSquared();FtSound.playSoundProfile("ball_jump_"+(Math.random()<.5?1:2),Account.instance.configData.sounds.ground,i)}function r(t){console.log("onBallPlayerBeginContact"),BattleScene.instance.forceInitBallPosition()}function c(t){var e,i;"Ball"===t.m_fixtureA.m_body.m_userData.params.type?(e=t.m_fixtureA.m_body,i=t.m_fixtureB.m_body.m_userData):(e=t.m_fixtureB.m_body,i=t.m_fixtureA.m_body.m_userData);if(e.GetLinearVelocity().LengthSquared()>Account.instance.configData.sounds.minBallSqVelocityToPlayEnemy){var n=Math.random(),a=n<.33?1:n<.66?2:3;Sound.playWithVolume("enemy_"+a),i.DoNotUpdate=!0;i.getVisual("line").setAnimationEndCallback(function(){i.DoNotUpdate=!1}),i.playAnimation("surprised",500,!1,!0)}}var l=new(0,Box2D.Dynamics.b2ContactListener);l.BeginContact=function(l){t(l,"Ball","Goal",i)||t(l,"Ball","Star",a)||e(l,"Ball","TeamPlayer",o)||e(l,"Ball","Ground",s)||e(l,"Ball","Player",r)||e(l,"Ball","Enemy",c)||t(l,null,null,n)},l.EndContact=function(t){},l.PostSolve=function(t,e){},l.PreSolve=function(t,e){},Physics.getWorld().SetContactListener(l)}function Referee(){Referee.parent.constructor.call(this)}function Star(){Star.parent.constructor.call(this)}function TeamPlayer(){TeamPlayer.parent.constructor.call(this),this.direction=new b2Vec2(1,0),this.powerRatio=1,this.canKick=!0}function PlayerGuiSprite(){PlayerGuiSprite.parent.constructor.call(this)}function PlayerGuiCSprite(){PlayerGuiCSprite.parent.constructor.call(this)}function EnemyGuiSprite(){EnemyGuiSprite.parent.constructor.call(this)}function PlayerVisualGui(){VisualEntity.parent.constructor.call(this)}function EnemyGuiCSprite(){EnemyGuiCSprite.parent.constructor.call(this)}function PowerLineGuiCSprite(){PowerLineGuiCSprite.parent.constructor.call(this)}var viewporter;!function(){var t;if(viewporter={forceDetection:!1,disableLegacyAndroid:!0,ACTIVE:function(){return(!viewporter.disableLegacyAndroid||!/android 2/i.test(navigator.userAgent))&&(!/ipad/i.test(navigator.userAgent)&&(!!/webos/i.test(navigator.userAgent)||"ontouchstart"in window))},READY:!1,isLandscape:function(){return 90===window.orientation||-90===window.orientation},ready:function(t){window.addEventListener("viewportready",t,!1)},change:function(t){window.addEventListener("viewportchange",t,!1)},refresh:function(){t&&t.prepareVisualViewport()},preventPageScroll:function(){document.body.addEventListener("touchmove",function(t){t.preventDefault()},!1),document.body.addEventListener("touchstart",function(){t.prepareVisualViewport()},!1)}},viewporter.ACTIVE=viewporter.ACTIVE(),viewporter.ACTIVE){var e=function(){var t=this;this.IS_ANDROID=/Android/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);var e=function(){t.prepareVisualViewport();var e=window.orientation;window.addEventListener("orientationchange",function(){window.orientation!==e&&(t.prepareVisualViewport(),e=window.orientation)},!1)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){e()},!1):e()};e.prototype={getProfile:function(){if(viewporter.forceDetection)return null;for(var t in viewporter.profiles)if(new RegExp(t).test(navigator.userAgent))return viewporter.profiles[t];return null},postProcess:function(){viewporter.READY=!0,this.triggerWindowEvent(this._firstUpdateExecuted?"viewportchange":"viewportready"),this._firstUpdateExecuted=!0},prepareVisualViewport:function(){var t=this;if(navigator.standalone)return this.postProcess();document.documentElement.style.minHeight="5000px";var e=window.innerHeight,i=this.getProfile(),n=viewporter.isLandscape()?"landscape":"portrait";window.scrollTo(0,t.IS_ANDROID?1:0);var a=40,o=window.setInterval(function(){if(window.scrollTo(0,t.IS_ANDROID?1:0),a--,(t.IS_ANDROID?!!i&&window.innerHeight===i[n]:window.innerHeight>e)||a<0){document.documentElement.style.minHeight=window.innerHeight+"px";var s=document.getElementById("viewporter");s&&s.style&&(s.style.position="relative",s.style.height=window.innerHeight+"px"),clearInterval(o),t.postProcess()}},10)},triggerWindowEvent:function(t){var e=document.createEvent("Event");e.initEvent(t,!1,!1),window.dispatchEvent(e)}},t=new e}}(),viewporter.profiles={MZ601:{portrait:696,landscape:1176},"GT-I9000|GT-I9100|Nexus S":{portrait:508,landscape:295},"GT-P1000":{portrait:657,landscape:400},"Desire_A8181|DesireHD_A9191":{portrait:533,landscape:320}},Function.prototype.inheritsFrom=function(t){return t.constructor==Function?(this.prototype=new t,this.prototype.constructor=this,this.parent=t.prototype):(this.prototype=t,this.prototype.constructor=this,this.parent=t),this};var uniqueId=function(){var t=0;return function(){return t++}}();if(void 0===console)var console={log:function(){},warn:function(){},error:function(){}};eLog.displayF=function(t){try{console.log(t)}catch(t){}},eLog.currentLevel=1,calcPercentage=function(t,e){return"string"==typeof t&&t.indexOf("%")>-1&&(t=parseFloat(t.replace("%",""))*e/100),t};var assets=new Array,Recorder=function(){function t(){n=[],a=-1,console.log("Cleared recorder content")}function e(){a=Date.now(),console.log("Setting ref time to ",new Date(a))}function i(){var t="";console.log("content on saveToFile: ",n);for(var e=0;e<n.length;e++){var i=n[e].action+";"+n[e].target+";"+n[e].time+";";"clickedAt"==n[e].action&&(i=i+n[e].params.x+","+n[e].params.y+";"),t+=i+="\n"}uriContent="data:application/octet-stream,"+encodeURIComponent(t),newWindow=window.open(uriContent,"neuesDokument")}var n=[],a=-1,o=!1;return obj={},obj.recordAction=function(t,e,i){o&&(n.push({action:t,target:e,params:i,time:-1!=a?Date.now()-a:a}),console.log("Recorded Action: ",n[n.length-1]))},obj.clearContent=t,obj.setRefTime=e,obj.saveToFile=i,obj.startRecord=function(){t(),e(),o=!0},obj.stopRecord=function(){o=!1,a=-1,i()},obj.getState=function(){return o},obj}(),DEBUG_INTERFACE={active:!1,log:function(){},log2:function(){},log3:function(){},log4:function(){}},mathSin=Math.sin;Math.sin=function(t){return 0===t?0:mathSin(t)};var mathCos=Math.cos;Math.cos=function(t){return 0===t?1:mathCos(t)},ColorRgb.Colors={BLACK:new ColorRgb(0,0,0),WHITE:new ColorRgb(255,255,255),RED:new ColorRgb(255,0,0),LIME:new ColorRgb(0,255,0),BLUE:new ColorRgb(0,0,255),YELLOW:new ColorRgb(255,255,0),AQUA:new ColorRgb(0,255,255),MAGENTA:new ColorRgb(255,0,255),SILVER:new ColorRgb(192,192,192),GRAY:new ColorRgb(128,128,128),MAROON:new ColorRgb(128,0,0),OLIVE:new ColorRgb(128,128,0),GREEN:new ColorRgb(0,128,0),PURPLE:new ColorRgb(128,0,128),TEAL:new ColorRgb(0,128,128),NAVY:new ColorRgb(0,0,128)},ColorRgb.prototype.set=function(t,e,i){this.r=t,this.g=e,this.b=i},ColorRgb.prototype.copy=function(){return new ColorRgb(this.r,this.g,this.b)},ColorRgb.prototype.add=function(t){this.r+=t.r,this.g+=t.g,this.b+=t.b},ColorRgb.prototype.subtract=function(t){this.r-=t.r,this.g-=t.g,this.b-=t.b},ColorRgb.prototype.equals=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b},AssertException.prototype.toString=function(){return"AssertException: "+this.message};var MAX_WIDTH=1280,MAX_HEIGHT=800,BASE_WIDTH=800,BASE_HEIGHT=500,ENHANCED_BASE_WIDTH=1138,ENHANCED_BASE_HEIGHT=640,ENHANCED_BASE_MARGIN_WIDTH=169,ENHANCED_BASE_MARGIN_HEIGHT=70,DO_NOT_RESIZE=!1,BASE_MARGIN_WIDTH=0,BASE_MARGIN_HEIGHT=0,Screen=function(){function t(){"undefined"==typeof Native&&(setTimeout(function(){window.scrollTo(0,1)},10),setTimeout(function(){window.scrollTo(0,1)},500))}function e(t,e){if(Screen.isCorrectOrientation()){var i=function(t,e){var i=selectValue(t,window.innerWidth),h=selectValue(e,window.innerHeight);r=i,c=h,g=Math.min(MAX_WIDTH,i),y=Math.min(MAX_HEIGHT,h);var p=BASE_WIDTH/BASE_HEIGHT;g/p>=y?g=Math.ceil(y*p):y=Math.ceil(g/p);if(o=g*(ENHANCED_BASE_WIDTH/BASE_WIDTH),s=y*(ENHANCED_BASE_HEIGHT/BASE_HEIGHT),n==y&&a==g&&l==r&&u==c)return!1;var d=Math.round((o-g)/2),m=Math.round((s-y)/2);C=Math.round((i-g)/2),G=Math.round((h-y)/2),l=r,u=c,n=y,a=g,A=g/BASE_WIDTH,w=y/BASE_HEIGHT;var f=$("#root");f.length>0&&(f.css("left",d),f.css("top",m));var v=$("#all");v.length>0&&(v.css("width",o),v.css("height",s),v.css("marginLeft",-o/2),v.css("marginTop",-s/2));return D.left=-Screen.offsetX(),D.top=-Screen.offsetY(),D.right=-Screen.offsetX()+Screen.fullWidth(),D.bottom=-Screen.offsetY()+Screen.fullHeight(),D.width=D.right-D.left,D.height=D.bottom-D.top,D.offsetX=0,D.offsetY=0,!0}(t,e);"undefined"==typeof Native&&i&&m.resize()}}function i(i,n,a){"undefined"==typeof Native&&(DO_NOT_RESIZE||(f&&(n=f),v&&(a=v),E=null,Screen.isCorrectOrientation()?((Screen.orientationChanged()||S!=n||b!=a)&&(S=n,b=a,clearTimeout(P),P=setTimeout(function(){e(n,a)},100)),t(),$("#rotateMsg").css("z-index",0),$("#rotateMsg").css("display","none"),E=!1):Loader.loadingMessageShowed()||(R(n,a),$("#rotateMsg").css("display","block"),$("#rotateMsg").css("z-index",99999999),E=!0),setTimeout(function(){Screen.isCorrectOrientation()?(clearTimeout(P),P=setTimeout(function(){e(n,a)},100),t(),$("#rotateMsg").css("z-index",0),$("#rotateMsg").css("display","none")):Loader.loadingMessageShowed()||(R(n,a),$("#rotateMsg").css("display","block"),$("#rotateMsg").css("z-index",99999999))},500)))}var n,a,o,s,r,c,l,u,h,p={},d=!1,m=null,g=BASE_WIDTH,y=BASE_HEIGHT,f=null,v=null,S=null,b=null,E=null,A=1,w=1,C=0,G=0,I=!0,D={left:0,top:0,right:0,bottom:0};"undefined"!=typeof Native&&(D.right=Native.ScreenWidth,D.bottom=Native.ScreenHeight);var P=null,R=function(t,e){var i=$("#rotateMsg");"number"!=typeof h&&(h=i.height()/i.width());var n=selectValue(t,window.innerWidth),a=Math.min(MAX_WIDTH,n),o=a*h;i.width(a),i.height(o)};return{init:function(e,n,a){if(m=e,a=selectValue(a,{}),!1===n){var o=BASE_HEIGHT;BASE_HEIGHT=BASE_WIDTH,BASE_WIDTH=o,o=ENHANCED_BASE_HEIGHT,ENHANCED_BASE_HEIGHT=ENHANCED_BASE_WIDTH,ENHANCED_BASE_WIDTH=o,o=ENHANCED_BASE_MARGIN_HEIGHT,ENHANCED_BASE_MARGIN_HEIGHT=ENHANCED_BASE_MARGIN_WIDTH,ENHANCED_BASE_MARGIN_WIDTH=o,MAX_HEIGHT=MAX_WIDTH,MAX_WIDTH=o=MAX_WIDTH}"fixed"===n?(this.fixedSize=!0,f=a.width,v=a.height):(BASE_WIDTH=selectValue(a.BASE_WIDTH,BASE_WIDTH),BASE_HEIGHT=selectValue(a.BASE_HEIGHT,BASE_HEIGHT),MAX_WIDTH=selectValue(a.MAX_WIDTH,MAX_WIDTH),MAX_HEIGHT=selectValue(a.MAX_HEIGHT,MAX_HEIGHT),ENHANCED_BASE_WIDTH=selectValue(a.ENHANCED_BASE_WIDTH,ENHANCED_BASE_WIDTH),ENHANCED_BASE_HEIGHT=selectValue(a.ENHANCED_BASE_HEIGHT,ENHANCED_BASE_HEIGHT),ENHANCED_BASE_MARGIN_WIDTH=selectValue(a.ENHANCED_BASE_MARGIN_WIDTH,ENHANCED_BASE_MARGIN_WIDTH),ENHANCED_BASE_MARGIN_HEIGHT=selectValue(a.ENHANCED_BASE_MARGIN_HEIGHT,ENHANCED_BASE_MARGIN_HEIGHT)),p={BASE_WIDTH:BASE_WIDTH,BASE_HEIGHT:BASE_HEIGHT,ENHANCED_BASE_WIDTH:ENHANCED_BASE_WIDTH,ENHANCED_BASE_HEIGHT:ENHANCED_BASE_HEIGHT,ENHANCED_BASE_MARGIN_WIDTH:ENHANCED_BASE_MARGIN_WIDTH,ENHANCED_BASE_MARGIN_HEIGHT:ENHANCED_BASE_MARGIN_HEIGHT,"-ENHANCED_BASE_MARGIN_WIDTH":-ENHANCED_BASE_MARGIN_WIDTH,"-ENHANCED_BASE_MARGIN_HEIGHT":-ENHANCED_BASE_MARGIN_HEIGHT},"onorientationchange"in window&&!a.disableOrientation?0==n?(I=!1,$("head").append('<link rel="stylesheet" href="css/orientationPortrait.css" type="text/css" />')):(I=!0,$("head").append('<link rel="stylesheet" href="css/orientationLandscape.css" type="text/css" />')):(I=null,$("#rotateMsg").remove()),disableTouchEvents(),$(window).resize(i),$(window).bind("scrollstart",function(e){t()}),$(window).bind("scrollstop",function(e){t()}),$(window).trigger("orientationchange"),(Device.is("iphone")||Device.is("ipod"))&&setInterval(t,5e3),$(window).bind("viewportready viewportchange",function(){$(window).trigger("resize")}),$(window).trigger("resize")},windowOnResize:function(t,e){console.log("Window resize: "+t+"; "+e),i(0,t,e)},setLandscapeDefault:function(t){I=t},isCorrectOrientation:function(){var t=window.innerWidth/window.innerHeight<1.1;return null==I||I===!t},orientationChanged:function(){return null==I||!E},isLandscape:function(){return"undefined"!=typeof Native?(console.log("Screen.isLandscape is not implemented"),!0):viewporter.isLandscape()},widthRatio:function(){return 1==this.fixedSize?1:A},heightRatio:function(){return 1==this.fixedSize?1:w},fieldWidth:function(){return a},fieldHeight:function(){return n},offsetX:function(){return C/A},offsetY:function(){return G/w},fullWidth:function(){return l/A},fullHeight:function(){return u/w},fullRect:function(){return D},baseWidth:function(){return BASE_WIDTH},baseHeight:function(){return BASE_HEIGHT},macro:function(t){if("string"==typeof t){var e=p[t];return e||t}return t},calcRealSize:function(t,e){return"number"==typeof t?t=Math.round(Screen.widthRatio()*t):"FULL_WIDTH"==t&&(t=l),"number"==typeof e?e=Math.round(Screen.heightRatio()*e):"FULL_HEIGHT"==e&&(e=u),{x:t,y:e}},calcLogicSize:function(t,e){return{x:t/Screen.widthRatio(),y:e/Screen.heightRatio()}},isDOMForced:function(){return d},setDOMForced:function(t){d=t}}}(),touchStartX=0,touchStartY=0,touchEndX=0,touchEndY=0,mobileBrowser=null,disableTouchEvents=function(){isMobile()&&(document.body.ontouchmove=function(t){t.preventDefault()},document.body.ontouchstart=function(t){t.preventDefault()},document.body.ontouchend=function(t){t.preventDefault()})},enableTouchEvents=function(t){isMobile()&&(document.body.ontouchstart=function(t){return t.preventDefault(),touchStartX=touchEndX=t.touches[0].pageX,touchStartY=touchEndY=t.touches[0].pageY,!1},document.body.ontouchmove=function(t){return t.preventDefault(),touchEndX=t.touches[0].pageX,touchEndY=t.touches[0].pageY,!1},document.body.ontouchend=function(t){if(t.preventDefault(),touchEndX&&touchEndY){var e={};e.pageX=touchEndX,e.pageY=touchEndY}return!1})};Transform.prototype.reset=function(){this.m=[1,0,0,1,0,0]},Transform.prototype.multiply=function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],a=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=s},Transform.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,a=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=s},Transform.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,a=this.m[1]*e+this.m[3]*i,o=this.m[0]*-i+this.m[2]*e,s=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=a,this.m[2]=o,this.m[3]=s},Transform.prototype.rotateDegrees=function(t){var e=t*Math.PI/180,i=Math.cos(e),n=Math.sin(e),a=this.m[0]*i+this.m[2]*n,o=this.m[1]*i+this.m[3]*n,s=this.m[0]*-n+this.m[2]*i,r=this.m[1]*-n+this.m[3]*i;this.m[0]=a,this.m[1]=o,this.m[2]=s,this.m[3]=r},Transform.prototype.translate=function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},Transform.prototype.scale=function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},Transform.prototype.transformPoint=function(t,e){var i=t,n=e;return t=i*this.m[0]+n*this.m[2]+this.m[4],e=i*this.m[1]+n*this.m[3]+this.m[5],[t,e]};var USE_NATIVE_RENDER=!0,Device=function(){function t(){if(null==r)try{r="localStorage"in window&&null!==window.localStorage;var t=window.localStorage;t.setItem("test","test"),t.getItem("test")}catch(t){console.error("Local storage not supported!"),r=!1}return r}var e,i,n,a,o,s="",r=null,c={},l=null,u=null,h=null,p=null,d=null,m=null,g=null,y=9999,f=USE_NATIVE_RENDER&&window.NativeRender?window.NativeRender:null,v="undefined"!=typeof Native&&Native.Screen;return window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,{init:function(t){!function(){if(!l){g=navigator.userAgent.toLowerCase(),h=/iphone|ipod|ipad/gi.test(navigator.platform),p=/iphone|ipod/gi.test(navigator.platform),d=g.indexOf("webkit")>-1;var t=navigator.userAgent;m=t.indexOf("Mozilla/5.0")>-1&&t.indexOf("Android ")>-1&&t.indexOf("AppleWebKit")>-1&&!(t.indexOf("Chrome")>-1);var e=g.indexOf("android");if(e>-1){var i=e+"android".length,n=g.indexOf(";",i),a=g.substring(i,n);u=parseFloat(a)}l=!0}}(),t=selectValue(t,{}),Device.setStoragePrefix(selectValue(t.name,""));var s=selectValue(t.icon,"images/icon114x114.png"),r=selectValue(t.iconAlpha,"images/icon114x114alpha.png");$("head").append('<link rel="apple-touch-icon"  href="'+s+'" />'),Device.isAndroid()&&$("head").append('<link rel="apple-touch-icon-precomposed" href="'+r+'" />'),Device.isTouch()&&(document.ontouchstart=function(t){return t.preventDefault(),i=a=t.touches[0].pageX,n=o=t.touches[0].pageY,!1},document.ontouchmove=function(t){return t.preventDefault(),a=t.touches[0].pageX,o=t.touches[0].pageY,!1},document.ontouchend=function(t){if(t.preventDefault(),a&&o){var e={};e.pageX=a,e.pageY=o}return!1}),function(){for(var t,e=new Date,i=2e4;i--;)Math.sqrt(i*Math.random());t=new Date-e+1,y=1200/t}(),e=m||Device.isNative()?(console.log("supportsToDataURL is not implemented"),!1):0==document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")},setStoragePrefix:function(t){assert("string"==typeof t,"Wrong storage prefix: "+t),s=t+"_"},setStorageItem:function(e,i){if(Device.isNative()){if(void 0===i||"function"==typeof i)return;switch(typeof i){case"string":case"number":break;case"object":i=JSON.stringify(i)}Native.Storage.SaveToIsolatedStorage(s+e,i)}else if(t()){window.localStorage.setItem(s+e,i)}else c[s+e]=i},getStorageItem:function(e,i){if(Device.isNative()){var n=Native.Storage.GetFromIsolatedStorage(s+e);return null==n||""==n||"null"==n?n=i:isNaN(n)?"true"==n?n=!0:"false"==n&&(n=!1):n*=1,n}if(t()){var a=window.localStorage.getItem(s+e);return null!=a?a:i}return c[s+e]?c[s+e]:i},removeStorageItem:function(e){if(!Device.isNative())if(t()){window.localStorage.removeItem(e)}else c[e]&&delete c[e]},is:function(t){return Device.isNative()?"Not implemented":g.indexOf(t)>-1},isAndroid:function(){return Device.isNative()?"Not implemented":null!=u},androidVersion:function(){return Device.isNative()?"Not implemented":u},isWebkit:function(){return Device.isNative()?"Not implemented":d},isAppleMobile:function(){return Device.isNative()?"Not implemented":h},isIpodDevice:function(){return Device.isNative()?"Not implemented":p},isMobile:function(){return Device.isNative()?"Not implemented":Device.isTouch()},isNative:function(){return v},supports3dTransfrom:function(){return!1},nativeRender:function(){return Device.isNative()?null:f},isTouch:function(){return!Device.isNative()&&"ontouchstart"in document.documentElement},getPositionFromEvent:function(t){return t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?{x:t.originalEvent.touches[0].pageX,y:t.originalEvent.touches[0].pageY}:t.originalEvent&&!t.originalEvent.touches&&t.originalEvent.pageX?{x:t.originalEvent.pageX,y:t.originalEvent.pageY}:t.touches?{x:t.touches[0].pageX,y:t.touches[0].pageY}:{x:t.pageX,y:t.pageY}},getLogicPositionFromEvent:function(t){var e=Device.getPositionFromEvent(t);return{x:e.x/Screen.widthRatio()-Screen.offsetX(),y:e.y/Screen.heightRatio()-Screen.offsetY()}},event:function(t){var e;switch(t){case"click":e=Device.isTouch()?"touchstart":"click";break;case"cursorDown":e=Device.isTouch()?"touchstart":"mousedown";break;case"cursorUp":e=Device.isTouch()?"touchend":"mouseup";break;case"cursorMove":e=Device.isTouch()?"touchmove":"mousemove";break;case"cursorOut":e=Device.isTouch()?"touchstart":"mouseout";break;case"cursorOver":e=Device.isTouch()?"touchstart":"mouseover";break;default:assert(!1,"Unrecognizible event "+t),e=t}return e},touchStartX:function(){return i},touchStartY:function(){return n},touchEndX:function(){return a},touchEndY:function(){return o},isWindowsPhone:function(){var t=new RegExp("Windows Phone","i");return navigator.userAgent.match(t)},isSlow:function(){return!Device.isNative()&&!Device.isWindowsPhone()&&(!!(Device.isAppleMobile()&&(parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1)<7)||!!(Device.isAndroid()&&Device.androidVersion()<2.3||y<80))},isSupportsToDataURL:function(){return e},isAndroidStockBrowser:function(){return m},addToHomeOpenPopup:function(){window.addToHomeOpen()}}}(),DragManager=function(){function t(t){i&&(i.dragMove(t),$.each(n,function(e,n){n.isEventIn(t)?n.dragItemEntered||(n.onDragItemEnter&&n.onDragItemEnter(i),n.dragItemEntered=!0):n.dragItemEntered&&(n.onDragItemOut&&n.onDragItemOut(i),n.dragItemEntered=!1)}))}function e(){if(i){var t=null;$.each(n,function(e,n){n.dragItemEntered&&(!t&&n.onDragItemDrop?n.onDragItemDrop(i)&&(t=n):n.onDragItemOut&&n.onDragItemOut(i),n.dragItemEntered=!1)}),i.dragEnd(t),i=null}}var i=null,n=new Array,a=!1;return{addListener:function(t){assert(t instanceof GuiDiv,"Trying to add illegal drag'n'drop listener. Should be GuiDiv"),t.dragItemEntered=!1,n.push(t),n.sort(function(t,e){var i=t.dragListenerPriority?t.dragListenerPriority:0;return(e.dragListenerPriority?e.dragListenerPriority:0)-i})},removeListener:function(t){popElementFromArray(t,n)},setItem:function(n,o){a||($(document).bind(Device.event("cursorUp"),e),$(document).bind(Device.event("cursorMove"),t),a=!0),i&&i.dragEnd&&i.dragEnd(),i=n,t(o)},getItem:function(){return i}}}(),Resources=function(){var t=new Array,e=(new Array,new Object),i=new Object,n=null,a=null,o=function(t,e){var i=new Image;return i.src=t,i.onload=e,i};return{init:function(){},setResolution:function(t){assert(e[t],"Resolution "+t+" not exists!"),n=t},setDefaultResolution:function(t){assert(e[t],"Resolution "+t+" not exists!"),a=t},addResolution:function(t,i,n){assert(!e[t],"Resolution "+t+" already exists!"),e[t]={folder:i,images:new Object},n&&(Resources.setResolution(t),Resources.setDefaultResolution(t))},addImage:function(t,i){var n;if("string"==typeof i)(n=new Array)(i);else if("array"==typeof i)n=i;else{n=new Array;for(var a in e)n.push(a)}for(a=0;a<n.length;a++){var o=n[a];assert(e[o],"Resolution "+o+" not exists!"),e[o].images[t]=t}},getString:function(t,e){if(i[t]){var n=i[t];if(i[t]instanceof Array){if(0==e)return i[t];return n[Math.floor(Math.random()*i[t].length)]}return i[t]}return t},setLanguage:function(t,e){if(1==e&&"object"==typeof t)i=t;else{var n="resources/localization/"+t+".json";$.getJSON(n,function(t){i=t})}},getImage:function(i,s,r){var c=null,l=null;if(n){if(e[n].images[i]&&(c=e[n].folder+e[n].images[i]),!c&&a&&a!=n&&e[a].images[i]&&(c=e[a].folder+e[a].images[i]),!i||"undefined"==i)return null;c||(c=e[n].folder+i),s&&(l=o(i,r))}else s&&(l=o(i,r)),c=i;return r&&l&&l.complete&&r(),t[i],c},getAsset:function(e){return!!t[e]&&t[e]},getImageAsset:function(e,i){if(t[e])return i&&i(t[e]),t[e];var n=new Image;return n.src=Resources.getImage(e),n.onload=function(){i&&i(n),t[e]=n},n},getUsedImages:function(){var t=new Array;for(var i in e[a].images[i])e[n].images[i]&&t.push(Resources.getImage(i));return t},preloadFonts:function(t){for(var e=0;e<t.length;++e){$("#root").append("<div id='fontsPreload"+e+"' + style='opacity:0.1;font-size:1px'>.</div>");var i=$("#fontsPreload"+e);i.addClass(t[e]),setTimeout(function(){i.remove()},1e3)}},loadMedia:function(e,i,n,a){for(var o,s,r,c=0,l=e.length,u=l,h=0;c<l;++c){if(o=e[c],"mp3"===(r=o.substr(o.lastIndexOf(".")+1).toLowerCase())||"wav"===r||"ogg"===r||"mp4"===r)s=new Audio(o),-1!=navigator.userAgent.indexOf("Chrome")&&h++;else{if("jpg"!==r&&"jpeg"!==r&&"gif"!==r&&"png"!==r){u--;continue}(s=new Image).src=Resources.getImage(o)}t[o]=s,s.onload=function(){++h,n&&n.call(this,{loaded:h,total:u,percent:h/u*100}),h===u&&i&&i()},s.onerror=function(){a?a.call(this,{loaded:h,total:u,percent:h/u*100}):++h===u&&i&&i()}}}}}(),WebSound=function(t){this.context=t,this.volume=1,this.fade=!1,this.deprecated=!1};WebSound.prototype.createSource=function(t){var e=this.context.createBufferSource();return e.buffer=t,e=this.createGain(e)},WebSound.prototype.createGain=function(t){if(!this.context.createGain)return!1;var e=this.context.createGain();return t.connect(e),e.connect(this.context.destination),t.gain=e.gain,t},WebSound.prototype.play=function(t,e){var i=this;if(this.deprecated&&this.playDeprecated(t,e),t.buffer){if(t.source=this.createSource(t.buffer),!t.source)return this.deprecated=!0,void this.playDeprecated(t,e);t.source.loop=t.loop,t.source.gain.value=t.volume,t.source.start(0,t.offset,t.duration);var n=t.buffer;t.loop||(this.playTimeout=setTimeout(function(){t.source=i.createSource(n),e&&e()},1e3*t.duration))}},WebSound.prototype.playDeprecated=function(t,e){var i=this,n=this.context.createBufferSource();if(t.source=n,t.source.connect(this.context.destination),t.buffer){t.source.buffer=t.buffer,t.source.loop=t.loop,t.source.gain.value=t.volume,t.source.noteGrainOn(0,t.offset,t.duration);var a=t.buffer;t.loop||(this.playTimeout=setTimeout(function(){t.source=i.context.createBufferSource(),t.source.buffer=a,e&&e()},1e3*t.duration))}},WebSound.prototype.stop=function(t){if(t&&t.source)try{t.source.noteOff(0)}catch(t){}},WebSound.prototype.mute=function(t){this.muted=!0,t?(t.playing.source=this.createGain(t.playing.source),t.playing.source.gain.value=0):this.volume=0},WebSound.prototype.unmute=function(t){this.muted=!1,t?(t.playing.source=this.createGain(t.playing.source),t.playing.source.gain.value=t.volume):this.volume=1},WebSound.prototype.fadeTo=function(t){if(!this.muted){if(this.fade!=t.sndInst.id){this.fade=t.sndInst.id;var e=this;if(t.sndInst.source=e.createGain(t.sndInst.source),t.dVol=t.volume-t.sndInst.source.gain.value,0!=t.dVol&&(t.dVol=Math.round(t.dVol/(t.time/10)*1e4)/1e4,t.sndInst)){this.fading=!0;var i=setInterval(function(){Math.abs(t.sndInst.source.gain.value-t.volume)>=Math.abs(2*t.dVol)?t.sndInst.source.gain.value+=t.dVol:(t.sndInst.source.gain.value=t.volume,t.sndInst.source.gain.value=Math.round(1e4*t.sndInst.source.gain.value)/1e4,e.fade=!1,t.callback&&t.callback(),clearInterval(i))},10)}}}},WebSound.prototype.loadSprite=function(t,e){this.loadSound(t,e)},WebSound.prototype.loadSound=function(t,e){var i=this,n=null,a=document.createElement("audio");a.canPlayType&&(!!a.canPlayType&&""!=a.canPlayType("audio/mpeg"),n=!!a.canPlayType&&""!=a.canPlayType('audio/ogg; codecs="vorbis"'));var o;o=n?".ogg":".mp3";var s=new XMLHttpRequest;s.open("GET",t+o,!0),s.responseType="arraybuffer",s.onload=function(){i.context.decodeAudioData(s.response,function(t){i.context.createBufferSource().buffer=t,e&&e(t)},function(){console.error("Unable to load sound:"+t+EXTENTION)})},s.send()};var jSound=function(){this.chCount=10,this.sprites=null,this.i=0};jSound.prototype.playSprite=function(t,e){var i=this;this.jPlayerInstance.jPlayer("pause",t.offset),this.jPlayerInstance.jPlayer("play",t.offset),audioSpriteEndCallback=function(){t.loop?i.play(t,e):(i.stop(),e&&e())},this.audioSpriteTimeoutHandler=setTimeout(audioSpriteEndCallback,1e3*t.duration)},jSound.prototype.play=function(t,e){var i=this.sprites[t.spriteName];i&&(i.volume=t.volume,i.play(t,e))},jSound.prototype.fadeTo=function(t){if(this.fade!=t.sndInst.spriteName){var e=this.sprites[t.sndInst.spriteName];if(!e.muted){this.fade=t.sndInst.spriteName;var i=this;t.dVol=t.volume-e.volume,0!=t.dVol&&(t.dVol/=t.time/10,t.sndInst&&(this.fading=!0,e.int=setInterval(function(){Math.abs(e.volume-t.volume)>=Math.abs(t.dVol)?(e.volume+=t.dVol,e.setVolume(t.sndInst.id,e.volume)):(e.volume=t.volume,e.setVolume(t.sndInst.id,t.volume),i.fade=!1,t.callback&&t.callback(),clearInterval(e.int))},10)))}}},jSound.prototype.stop=function(t){if(null!=this.sprites)if(t){if(!this.sprites[t.spriteName])return;this.sprites[t.spriteName].stop(),this.sprites[t.spriteName].int&&clearInterval(this.sprites[t.spriteName].int)}else $.each(this.sprites,function(t,e){e.audio.stop(),e.int&&clearInterval(e.int)})},jSound.prototype.mute=function(t){null!=this.sprites&&(t?this.sprites[t.playing.spriteName].mute():$.each(this.sprites,function(t,e){e.mute()}))},jSound.prototype.unmute=function(t){null!=this.sprites&&(t?this.sprites[t.playing.spriteName].unmute(t.volume):$.each(this.sprites,function(t,e){e.unmute()}))},jSound.prototype.loadSound=function(t,e,i){null==this.sprites&&(this.sprites={});Device.isAppleMobile()&&(playOffset=APPLE_OFFSET);var n=t;if(t.indexOf("/")>=0){var a=t.split("/");n=a[a.length-1]}var o=[],s=1;i&&(s=this.chCount);for(var r=0;r<s;r++){var c=this.generateJplayer(n+r,t);o.push(c)}this.sprites[t]=this.generateSpriteChannels(o),e&&setTimeout(e,1e3)},jSound.prototype.loadSprite=function(t){null==this.sprites&&(this.sprites={}),$("body").append("<div id='jPlayerInstanceId"+t+"' style='position:absolute; left:50%; right:50%; width: 0px; height: 0px;'></div>"),this.sprites[t]=$("#jPlayerInstanceId"+t),this.sprites[t].jPlayer({ready:function(){$(this).jPlayer("setMedia",{oga:"sounds/"+t+".ogg",m4a:"sounds/"+t+".mp4",mp3:"sounds/"+t+".mp3"})},supplied:"oga, mp3, m4a",solution:"html, flash",swfPath:"js/",ended:function(){},playing:function(t){t.jPlayer.status.currentTime},timeupdate:function(t){t.jPlayer.status.currentTime}})},jSound.prototype.generateJplayer=function(t,e){var i="<div id='"+t+"' style='position:absolute; left:50%; right:50%; width: 0px; height: 0px;'></div>";$("body").append(i);var n=$("#"+t);return n.jPlayer({ready:function(){$(this).jPlayer("setMedia",{oga:e+".ogg",mp3:e+".mp3"})},supplied:"oga, mp3, m4a",solution:"html, flash",preload:"auto",swfPath:"js/",ended:function(){},playing:function(t){t.jPlayer.status.currentTime},timeupdate:function(t){t.jPlayer.status.currentTime}}),n},jSound.prototype.generateSpriteChannels=function(t){var e=this,i={volume:1,channels:[],play:function(t,i){var n=this.getFree();n&&(this.muted?n.audio.jPlayer("volume",0):n.audio.jPlayer("volume",this.volume),n.audio.jPlayer("play",t.offset),n.playing=t,audioSpriteEndCallback=function(){n.audio.jPlayer("pause"),n.playing=null,t.loop?e.play(t,i):i&&i()},n.audioSpriteTimeoutHandler=setTimeout(audioSpriteEndCallback,1e3*t.duration))},stop:function(){$.each(this.channels,function(t,e){e.playing&&(e.audio.jPlayer("pause"),e.playing=null,clearTimeout(e.audioSpriteTimeoutHandler))})},getFree:function(){for(var t=0;t<this.channels.length;t++)if(!this.channels[t].playing)return this.channels[t];return console.log("NO FREE CHANNEL"),null},mute:function(){this.muted=!0,$.each(this.channels,function(t,e){e.audio.jPlayer("volume",0)})},unmute:function(t){this.muted=!1,$.each(this.channels,function(e,i){i.audio.jPlayer("volume",t)})},setVolume:function(t,e){$.each(this.channels,function(i,n){n.playing&&n.playing.id==t&&n.audio.jPlayer("volume",e)})}};return $.each(t,function(t,e){var n={audio:e,playing:null};i.channels.push(n)}),i};var htmlSound=function(){this.soundOffset=0,this.mp3offset=.001,this.audioSpriteInstance={},this.fade=!1,this.startTime=0,this.endTime=0};htmlSound.prototype.play=function(t,e){var i=this.audioSpriteInstance[t.spriteName];if(!i||i.play){if(!(i.priority<=t.priority))return;this.stop(t)}i.priority=t.priority,i.stopCallback=e,i.audio.volume=t.volume,i.audio.pause(),t.loop&&i.audio.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),i.startTime=t.offset+this.soundOffset,i.endTime=i.startTime+t.duration,i.audio.currentTime=i.startTime,i.play=!0,i.audio.play()},htmlSound.prototype.stop=function(t){if(null!=this.audioSpriteInstance)if(t){if(!this.audioSpriteInstance[t.spriteName])return;this.audioSpriteInstance[t.spriteName].audio.pause(),this.audioSpriteInstance[t.spriteName].play=!1}else $.each(this.audioSpriteInstance,function(t,e){e.audio.pause(),e.play=!1})},htmlSound.prototype.mute=function(t){null!=this.audioSpriteInstance&&(t?(this.audioSpriteInstance[t.playing.spriteName].audio.muted=!0,this.audioSpriteInstance[t.playing.spriteName].muted=!0):$.each(this.audioSpriteInstance,function(t,e){e.audio.muted=!0,e.muted=!0}))},htmlSound.prototype.unmute=function(t){null!=this.audioSpriteInstance&&(t?(this.audioSpriteInstance[t.playing.spriteName].audio.muted=!1,this.audioSpriteInstance[t.playing.spriteName].muted=!1):$.each(this.audioSpriteInstance,function(t,e){e.audio.muted=!1,e.muted=!1}))},htmlSound.prototype.fadeTo=function(t){if(this.fade!=t.sndInst.id){var e=this.audioSpriteInstance[t.sndInst.spriteName].audio;if(!this.audioSpriteInstance[t.sndInst.spriteName].muted){this.fade=t.sndInst.id;var i=this;if(t.dVol=t.volume-e.volume,0!=t.dVol&&(t.dVol/=t.time/10,t.sndInst)){this.fading=!0;var n=setInterval(function(){Math.abs(e.volume-t.volume)>=Math.abs(t.dVol)?e.volume+=t.dVol:(e.volume=t.volume,i.fade=!1,t.callback&&t.callback(),clearInterval(n))},10)}}}},htmlSound.prototype.loadSound=function(t,e){var i=null,n=document.createElement("audio");n.canPlayType&&(!!n.canPlayType&&""!=n.canPlayType("audio/mpeg"),i=!!n.canPlayType&&""!=n.canPlayType('audio/ogg; codecs="vorbis"'));var a;i?a=".ogg":(a=".mp3",this.soundOffset=this.mp3offset);var o=new Audio(t+a);o.preload="auto";var s=this;if(e){o.addEventListener("abort",function(){},!0),o.addEventListener("error",function(){},!0),o.addEventListener("suspend",function(){},!0);var r=function(){s.audioSpriteInstance[t]={audio:o,startTime:0,endTime:0},e(s.audioSpriteInstance[t]),o.removeEventListener("canplaythrough",r,!1)};o.addEventListener("canplaythrough",r,!1),o.addEventListener("timeupdate",function(){var e=s.audioSpriteInstance[t];e.audio.currentTime<e.startTime&&(e.audio.currentTime=e.startTime),e.audio.currentTime>=e.endTime&&(e.audio.pause(),e.play=!1,e.stopCallback&&(e.stopCallback(),e.stopCallback=null))},!1)}else console.log("NO CALLBACK ON SOUND INIT"),s.audioSpriteInstance[t]=o};var Sound;Sound="undefined"!=typeof Native?Native.Sound:function(){var t={channels:{default:{playing:null,volume:1},background:{playing:null,volume:.2}},channelCount:2,spriteName:null,sprite:{},sprites:{},forceSprite:!1,soundBuffers:{},getChannel:function(t){return t&&"default"!=t?this.channels[t]:this.channels.default},addChannel:function(t,e){for(var i=0;i<this.channels.length;i++)if(this.channels[i]==t)return;t&&(this.channels[e]=t)},stop:function(t){var e=this;if(t){var i=this.getChannel(t);i&&this.instance.stop(i.playing)}else $.each(this.channels,function(t,i){try{"background"!=t&&i&&null!=i.playing&&e.instance.stop(i.playing)}catch(t){}})},isOn:function(){return"true"==Device.getStorageItem("soundOn","true")},mute:function(t){var e=this,i=this.getChannel(t);i.initVol=i.volume,i?i.playing?(this.instance.mute(i),i.muted=!0):i.muted=!0:$.each(this.channels,function(t,i){"background"!=t&&(i.playing?(e.instance.mute(i),i.muted=!0):i.muted=!0)})},unmute:function(t){var e=this,i=this.getChannel(t);i.initVol=i.volume,i?i.playing?(this.instance.unmute(i),i.muted=!1):i.muted=!1:$.each(this.channels,function(t,i){"background"!=t&&(i.playing?(e.instance.unmute(i),i.muted=!1):i.muted=!1)})},turnOn:function(t){var e=t;Device.setStorageItem("soundOn",e),e?this.unmute():this.mute()},add:function(t,e,i,n,a){this.soundBuffers[t]={priority:a||0,offset:e,spriteName:n||t,duration:i}},play:function(t,e,i,n){var a=this;if(this.soundBuffers[t]&&(this.isOn()||"background"==n)){var o=null,s=this.getChannel(n),r=this.soundBuffers[t];"function"==typeof e&&(o=e,e=!1);var c={id:t,priority:i||r.priority,loop:!!e,offset:r.offset,volume:s.muted?0:s.volume,duration:r.duration,spriteName:r.spriteName,buffer:this.sprites[r.spriteName]?this.sprites[r.spriteName]:this.sprite};if(null!=s.playing){var l="channel"+this.channelCount++;this.channels[l]={playing:null,volume:1},(s=this.channels[l]).playing=c,this.instance.play(c,function(){o&&o(),s.playing=null,a.channels[l]=null,delete a.channels[l]})}else s.playing=c,this.instance.play(c,function(){o&&o(),s.playing=null})}},playWithVolume:function(t,e,i,n){try{var a=this,o=null,s=this.getChannel("default");s.volume=null!=e?e:1;var r=this.soundBuffers[t];"function"==typeof n&&(o=n,n=!1);var c={id:t,priority:i||r.priority,loop:!!n,offset:r.offset,volume:s.muted?0:s.volume,duration:r.duration,spriteName:r.spriteName,buffer:this.sprites[r.spriteName]?this.sprites[r.spriteName]:this.sprite};if(null!=s.playing){var l="channel"+this.channelCount++;this.channels[l]={playing:null,volume:1},(s=this.channels[l]).playing=c,this.instance.play(c,function(){o&&o(),s.playing=null,a.channels[l]=null,delete a.channels[l]})}else s.playing=c,this.instance.play(c,function(){o&&o(),s.playing=null})}catch(t){console.error(t)}},init:function(t,e,i,n){var a=this;this.forceSprite=!!e,this.forceSprite&&this.instance.loadSound(t,function(e){a.sprites[t]=e,i&&i()},n)},fadeTo:function(t,e,i,n){var a=this.getChannel(t),o=a.playing;if(o&&!a.muted){var s={channel:t,time:e,sndInst:o,volume:i,callback:n};this.instance.fadeTo(s)}},addSprite:function(t){var e=this;this.instance.loadSprite(t,function(i){e.sprites[t]=i})}},e=null;try{e=new(window.AudioContext||window.webkitAudioContext)}catch(t){e=null,console.log("WEB Audio not supported")}return null!=e?(t.type="webAudio",t.instance=new WebSound(e)):(t.type="htmlSound",t.instance=new htmlSound),t}();var entityFactory=new AbstractFactory;entityFactory.createEntitiesFromJson=function(t){this.createObjectsFromJson(t,function(t,e){e.id=t},function(t,e,i){assert(Account.instance),Account.instance.addEntity(e,t,i)})},Entity.prototype.init=function(t){if(this.params=t,this.id=t.id,this.properties={},t.parent){var e=t.parent;"string"==typeof t.parent&&(e=Account.instance.getEntity(t.parent),this.assert(e," No parent found with id='"+t.parent+"' ")),e.addChild(this)}else console.log(" No parent provided for entity with id='"+this.id+"'");var i=selectValue(t.enabled,!0);this.setEnable(i),this.timeouts=null,this.intervals=null},Entity.prototype.assert=function(t,e){assert(t,e+" for entity id='"+this.id+"'")},Entity.prototype.log=function(t){console.log("Entity id='"+this.id+"', "+t)},Entity.prototype.destroy=function(){this.clearTimeouts?this.clearTimeouts():console.warn("Very suspicious accident! Some shit happened!");var t;if(this.parent&&(this.parent.removeChild?this.parent.removeChild(this):console.warn("Very suspicious accident! Yep, shit happens...")),this.children)for(var e=0;e<this.children.length;e++)t=this.children[e],this.removeChild(t),Account.instance.removeEntity(t.id),e--},Entity.prototype.addChild=function(t){this.children=this.children?this.children:new Array,this.assert(t!=this,"Can't be parent for itself"),this.assert(null==t.parent,"Can't assign as child id='"+t.id+"' since there's parent id='"+(t.parent?t.parent.id:"")+"' "),t.parent=this,this.log("Entity.addChild "+t.id),this.children.push(t)},Entity.prototype.removeChild=function(t){assert(this.children,"no children been assigned"),popElementFromArray(t,this.children)},Entity.prototype.getChild=function(t){assert(this.children,"no children been assigned");var e;return $.each(this.children,function(i,n){n.id==t&&(e=n)}),assert(e,"No child with id = "+t+" has been assigned"),e},Entity.prototype.initChildren=function(t){t&&t.children&&Account.instance.readGlobalUpdate(t.children)},Entity.prototype.update=null,Entity.prototype.isEnabled=function(){return this.enabled},Entity.prototype.setEnable=function(t){this.enabled=t,"function"==typeof this.update&&(t?Account.instance.addScheduledEntity(this):Account.instance.removeScheduledEntity(this))},Entity.prototype.setDirty=function(){var t=this;$.each(arguments,function(e,i){t.dirtyFlags[i]=!0})},Entity.prototype.clearDirty=function(){var t=this;$.each(arguments,function(e,i){t.dirtyFlags[i]=null})},Entity.prototype.isDirty=function(t){return 1==this.dirtyFlags[t]},Entity.prototype.clearAllDirty=function(){this.dirtyFlags={}},Entity.prototype.readUpdate=function(t){var e=this.parent?this.parent.id:null;t.parent!=e&&(null!=this.parent&&(this.parent.removeChild(this),this.parent=null),t.parent&&Account.instance.getEntity(t.parent).addChild(this))},Entity.prototype.readUpdateProperty=function(t,e){return this.properties[e]=t[e],t[e]},Entity.prototype.writeUpdateProperty=function(t,e,i){this.properties[e]!=i&&(t[e]=i,this.properties[e]=i)},Entity.prototype.writeUpdate=function(t,e){t[this.id]=e,this.writeUpdateProperty(e,"class",this.params.class),this.writeUpdateProperty(e,"parent",this.params.parent),this.children&&$.each(this.children,function(e,i){i.writeUpdate(t,new Object)})},Entity.prototype.setInterval=function(t,e){var i=setInterval(t,e);return this.intervals=this.intervals?this.intervals:new Array,this.intervals.push(i),i},Entity.prototype.setTimeout=function(t,e){var i=setTimeout(t,e);return this.timeouts=this.timeouts?this.timeouts:new Array,this.timeouts.push(i),i},Entity.prototype.clearTimeout=function(t){clearTimeout(t)},Entity.prototype.clearInterval=function(t){clearInterval(t)},Entity.prototype.clearTimeouts=function(){for(var t in this.intervals)clearInterval(this.intervals[t]);this.intervals=new Array;for(var t in this.timeouts)clearTimeout(this.timeouts[t]);this.timeouts=new Array},BaseState.inheritsFrom(Entity),BaseState.prototype.init=function(t){BaseState.parent.init.call(this,t),this.guiContainer=new GuiContainer,this.guiContainer.init(),this.guiContainer.resize()},BaseState.prototype.destroy=function(){BaseState.parent.destroy.call(this),this.guiContainer.clear()},BaseState.prototype.addGui=function(t,e){this.guiContainer.addGui(t,e)},BaseState.prototype.removeGui=function(t){this.guiContainer.removeGui(t)},BaseState.prototype.getGui=function(t){return this.guiContainer.getGui(t)},BaseState.prototype.resize=function(){this.guiContainer.resize()},BaseState.prototype.activate=function(t){this.id=t?t.id:null,this.params=t,this.resources?this.preload():this.init(this.params)},BaseState.prototype.hide=function(t){this.getGui("enhancedScene").hide(),t||(this.guiContainer.resetUpdateInterval(),this.setEnable(!1))},BaseState.prototype.show=function(t){void 0===t&&(t=!0),this.getGui("enhancedScene").show(),t&&(this.guiContainer.setUpdateInterval(GLOBAL_UPDATE_INTERVAL),this.setEnable(!0))},BaseState.prototype.preload=function(){var t=0,e=this;this.resources?this.resources.json?(t=countProperties(e.resources.json),$.each(this.resources.json,function(i,n){$.getJSON(i,function(t){e.resources.json[i]=t}).error(function(){assert(!1,"error reading JSON "+i)}).complete(function(){--t<=0&&e.jsonPreloadComplete()})})):this.jsonPreloadComplete():this.preloadComplete()},BaseState.prototype.jsonPreloadComplete=function(){var t=this;if(this.resources.media){new Date;Resources.loadMedia(this.resources.media,function(){t.preloadComplete()},this.preloadingCallback)}else this.preloadComplete()},BaseState.prototype.preloadComplete=function(){this.init(this.params)},BaseState.prototype.preloadJson=function(t){this.resources||(this.resources=new Object),this.resources.json||(this.resources.json=new Object),"string"==typeof t?this.resources.json[t]=null:"array"==typeof t?$.each(this.resources.json,function(t,e){this.resources.json[e]=null}):console.error("Invalid argument for preloadJson: should be array of json urls or single url.")},BaseState.prototype.preloadMedia=function(t,e){this.resources||(this.resources=new Object),this.resources.media||(this.resources.media=new Array),this.preloadingCallback=e,t instanceof Array?this.resources.media=t:console.error("Invalid argument for preloadMedia: array of media urls.")};var GLOBAL_UPDATE_INTERVAL=50,DOM_MODE=!1;Account.inheritsFrom(BaseState),Account.prototype.init=function(t){t=t||{},Account.parent.init.call(this,t),this.allEntities=new Object,this.scheduledEntities=new Object,this.renderEntities=new Object,this.staticSprites={},this.syncWithServerInterval=t.syncWithServerInterval,this.id=selectValue(t.id,"Account01"),this.globalUpdateInterval=selectValue(t.globalUpdateInterval,GLOBAL_UPDATE_INTERVAL),this.addEntity(this),this.backgroundState=new BackgroundState,t.backgroundState=selectValue(t.backgroundState,{}),t.backgroundState.id=selectValue(t.backgroundState.id,"backgroundState01"),this.backgroundState.activate(t.backgroundState),assert(null==Account.instance,"Only one account object at time are allowed"),Account.instance=this,this.tabActive=!0,this.backgroundState.resize()},Account.prototype.addEntity=function(t){assert("string"==typeof t.id,"Entity ID must be string"),assert(null==this.allEntities[t.id],"Entity with ID '"+t.id+"' already exists"),this.allEntities[t.id]=t},Account.prototype.getEntity=function(t){return this.allEntities[t]},Account.prototype.removeEntity=function(t,e){var i=this.allEntities[t];i&&(e||(this.removeScheduledEntity(i),this.removeChild(i),i.destroy()),delete this.allEntities[t])},Account.prototype.removeAllEntities=function(t,e){$.each(this.allEntities,function(t,e){e!==Account.instance&&Account.instance.removeEntity(t,!1)})},Account.prototype.activateUpdateAndRender=function(){var t=this;this.cancelUpdate=!0,setTimeout(function(){t.prevUpdateTime=Date.now(),t.cancelUpdate=!1,t.globalUpdateIntervalHandle=window.requestAnimationFrame(function(){t.update(100)}),t.globalRenderFrameHandle=window.requestAnimationFrame(function(){t.render()})},500)},Account.prototype.addScheduledEntity=function(t){assert("string"==typeof t.id,"Entity ID must be string");var e=this,i=this.globalUpdateInterval;this.globalUpdateIntervalHandle||(e.prevUpdateTime=Date.now(),this.globalUpdateIntervalHandle=window.requestAnimationFrame(function(){e.update(i)})),this.scheduledEntities[t.id]=t},Account.prototype.removeScheduledEntity=function(t){assert("string"==typeof t.id,"Entity ID must be string"),delete this.scheduledEntities[t.id],!this.globalUpdateIntervalHandle&&$.isEmptyObject(this.scheduledEntities)&&(this.clearInterval(this.globalUpdateIntervalHandle),this.globalUpdateIntervalHandle=null)},window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,20)},Account.prototype.addRenderEntity=function(t){assert("string"==typeof t.id,"Entity ID must be string");var e=this;this.globalRenderFrameHandle||(this.lastRenderTime=Date.now(),this.globalRenderFrameHandle=window.requestAnimationFrame(function(){e.render()})),this.renderEntities[t.id]=t},Account.prototype.removeRenderEntity=function(t){assert("string"==typeof t.id,"Entity ID must be string"),delete this.renderEntities[t.id],!this.globalRenderFrameHandle&&$.isEmptyObject(this.renderEntities)&&(this.clearInterval(this.globalRenderFrameHandle),this.globalRenderFrameHandle=null)},Account.prototype.render=function(){var t=this,e=null;$.each(this.renderEntities,function(t,i){i&&i.isVisible&&i.isVisible()&&(e||(e=i),i.render())}),this.cancelUpdate||(this.globalRenderFrameHandle=window.requestAnimationFrame(function(){t.render()},e))},Account.prototype.update=function(t){var e=this,i=Date.now();i-this.prevUpdateTime>=this.globalUpdateInterval?(t=i-this.prevUpdateTime,this.prevUpdateTime=Date.now(),$.each(this.scheduledEntities,function(e,i){i&&i.isEnabled()&&i.update(t)}),$.each(this.staticSprites,function(e,i){i.update(t)})):t+=i-this.prevUpdateTime,this.cancelUpdate||(this.globalUpdateIntervalHandle=window.requestAnimationFrame(function(){e.update(t)}))},Account.prototype.setEnable=function(t){},Account.prototype.resize=function(){this.backgroundState&&this.backgroundState.resize(),null!=this.children&&$.each(this.children,function(t,e){e&&e.resize&&e.resize()})},Account.prototype.readGlobalUpdate=function(t){var e=this;$.each(t,function(i,n){var a=Account.instance.getEntity(i);if(a)n.destroy?(e.removeEntity(i),delete t[i]):a.readUpdate(n);else{Account.instance.getEntity(n.parent)?(n.id=i,a=entityFactory.createObject(n.class,n),e.addEntity(a)):console.error("Can`t find parent with id = "+n.parent+"  for entity = "+i)}})},Account.prototype.writeGlobalUpdate=function(){var t={};return this.writeUpdate(t,new Object),t},Account.prototype.getUpdateFromServer=function(t){this.server.receiveData(t)},Account.prototype.saveUpdateToServer=function(t,e){this.server.sendData(t,e)},Account.prototype.commandToServer=function(t,e,i){var n=this;this.server.command(t,e,function(t,e){n.readGlobalUpdate(e),i(t)})},Account.prototype.syncWithServer=function(t,e,i){var n=this.writeGlobalUpdate();e&&$.extend(!0,n,e);a=this;if(this.server.sendData(n,function(e){a.readGlobalUpdate(e),t&&t()}),null!=(i=selectValue(i,this.syncWithServerInterval))){this.clearTimeout(this.syncWithServerTimeoutId);var a=this;this.syncWithServerTimeoutId=this.setTimeout(function(){a.syncWithServer()},5e3)}},VisualEntity.inheritsFrom(Entity),VisualEntity.prototype.init=function(t){VisualEntity.parent.init.call(this,t),this.x=t.x,this.y=t.y,this.z=t.z,this.width=t.width,this.height=t.height,this.visible=selectValue(t.visible,!0),this.visuals={},this.updateTime=GLOBAL_UPDATE_INTERVAL;var e=selectValue(t.renderable,!1);this.setRenderable(e)},VisualEntity.prototype.createVisual=function(){this.description=Account.instance.descriptionsData[this.params.description],this.assert(this.description,"There is no correct description")},VisualEntity.prototype.addVisual=function(t,e){var i=null==t?0:t;this.assert(null==this.visuals[i],"Visual id = '"+i+"' is already created."),this.visuals[i]=e},VisualEntity.prototype.isRenderable=function(){return this.renderable},VisualEntity.prototype.setRenderable=function(t,e){this.renderable=t,"function"==typeof this.render&&(t?Account.instance.addRenderEntity(this):Account.instance.removeRenderEntity(this)),this.justUpdate=!!e},VisualEntity.prototype.getVisual=function(t){var e=null==t?0:t;return this.visuals[e]?this.visuals[e].visual:null},VisualEntity.prototype.removeVisual=function(t){var e=null==t?0:t,i=this.visuals[e].visual;this.guiParent.removeGui(i),delete this.visuals[e]},VisualEntity.prototype.getVisualInfo=function(t){var e=null==t?0:t;return this.visuals[e]},VisualEntity.prototype.attachToGui=function(t,e){if(!this.visual){this.guiParent=t||this.params.guiParent,this.assert(this.guiParent,"No guiParent provided"),this.createVisual();var i=this;$.each(i.visuals,function(t,n){n.visual.visualEntity=i,i.guiParent.addGui(n.visual),n.visual.clampByParentViewport&&n.visual.clampByParentViewport(e)})}},VisualEntity.prototype.destroy=function(t){if(VisualEntity.parent.destroy.call(this),this.guiParent&&!t){var e=this;$.each(this.visuals,function(t,i){i.visual.hide(),e.guiParent.removeGui(i.visual)})}},VisualEntity.prototype.setZ=function(t){"number"==typeof t&&(this.z=t);var e=this;$.each(e.visuals,function(t,i){if("number"==typeof e.z){var n="number"==typeof i.z?i.z:0;i.visual.setZ(e.z+n)}})},VisualEntity.prototype.setPosition=function(t,e){this.x=t,this.y=e;var i=this;$.each(i.visuals,function(t,e){if(!e.dependent){var n=i.x,a=i.y;"number"==typeof e.offsetX&&(n-=e.offsetX),"number"==typeof e.offsetY&&(a-=e.offsetY),e.visual.setPosition(n,a)}})},VisualEntity.prototype.move=function(t,e){this.setPosition(this.x+t,this.y+e)},VisualEntity.prototype.setPositionToVisual=function(t){var e=this.getVisualInfo(t);this.x=e.visual.x+e.offsetX,this.y=e.visual.y+e.offsetY,this.setPosition(this.x,this.y)},VisualEntity.prototype.show=function(){this.visible=!0,$.each(this.visuals,function(t,e){e.visual.show()})},VisualEntity.prototype.isVisible=function(){return this.visible},VisualEntity.prototype.hide=function(){this.visible=!1,$.each(this.visuals,function(t,e){e.visual.hide()})},VisualEntity.prototype.resize=function(){$.each(this.visuals,function(t,e){e.visual.resize()})},VisualEntity.prototype.update=function(t,e,i){e&&i&&(this.stpX=e-this.x,this.stpY=i-this.y)},VisualEntity.prototype.render=function(t){},VisualEntity.prototype.writeUpdate=function(t,e){this.writeUpdateProperty(e,"x",this.x),this.writeUpdateProperty(e,"y",this.y),VisualEntity.parent.writeUpdate.call(this,t,e)},VisualEntity.prototype.readUpdate=function(t){VisualEntity.parent.readUpdate.call(this,t)},Scene.inheritsFrom(VisualEntity),Scene.prototype.className="Scene",Scene.prototype.createInstance=function(t){var e=new Scene;return e.init(t),e},entityFactory.addClass(Scene),Scene.prototype.init=function(t){Scene.parent.init.call(this,t)},Scene.prototype.createVisual=function(t){var e=this.params,i=guiFactory.createObject("GuiScene",{parent:this.guiParent,style:"scene",x:e.x,y:e.y,width:e.width,height:e.height,background:e.background,canvas:e.canvas}),n={};n.visual=i,this.addVisual(null,n);var a=this;this.children=this.children?this.children:new Array,t||$.each(this.children,function(t,e){a.attachChildVisual(e)})},Scene.prototype.attachChildVisual=function(t){t.attachToGui&&t.attachToGui(this.getVisual(),!0)},Scene.prototype.move=function(t,e,i){var n=this.getVisual();i&&$.each(n.backgrounds,function(a,o){o&&a!=n.backgrounds.length-1&&n.setBackgroundPosition(n.backgrounds[a].left-t*(a/i),n.backgrounds[a].top-e*(a/i),a)}),n.move(t,e)};var ITEM_NAME="Item";Item.inheritsFrom(VisualEntity),Item.prototype.className=ITEM_NAME,Item.prototype.createInstance=function(t){var e=new Item;return e.init(t),e},entityFactory.addClass(Item),Item.prototype.init=function(t){if(Item.parent.init.call(this,t),this.stashed=t.stashed,!this.stashed){var e=this.params.guiParent?this.params.guiParent:this.parent.visual;e&&this.attachToGui(e),this.z=null!=this.z?this.z:0}},Item.prototype.getIcon=function(){return this.description.totalImage},Item.prototype.createVisual=function(){this.assert(this.guiParent,"No gui parent provided for creating visuals"),null==this.description&&(this.description=Account.instance.descriptionsData[this.params.description]),this.assert(this.description,"There is no correct description");var t=Resources.getImage(this.description.totalImage);visual=guiFactory.createObject("GuiSprite",{parent:this.guiParent,style:"sprite",x:this.params.x,y:this.params.y,width:this.description.totalImageWidth,height:this.description.totalImageHeight,totalImage:t,totalImageWidth:this.description.totalImageWidth,totalImageHeight:this.description.totalImageHeight,totalTile:this.description.totalTile});var e={};e.visual=visual,e.z=this.description["z-index"],e.offsetX=this.description.centerX?calcPercentage(this.description.centerX,this.description.width):0,e.offsetY=this.description.centerY?calcPercentage(this.description.centerY,this.description.height):0,this.addVisual(null,e),this.setPosition(this.x,this.y),this.setZ(null)},Item.prototype.writeUpdate=function(t,e){Item.parent.writeUpdate.call(this,t,e)},Item.prototype.readUpdate=function(t){Item.parent.readUpdate.call(this,t)},SimpleCountdown.inheritsFrom(VisualEntity),SimpleCountdown.prototype.className="SimpleCountdown",SimpleCountdown.prototype.createInstance=function(t){var e=new SimpleCountdown;return e.init(t),e},entityFactory.addClass(SimpleCountdown),SimpleCountdown.prototype.init=function(t){this.paused=!0,SimpleCountdown.parent.init.call(this,t),this.label=t.label;var e=null,i=null;this.description&&(e=this.description.go,i=this.description.alarmColor),this.goText=selectValue(t.go,e),t.initStart?this.paused=!1:this.setEnable(!1),this.count=1e3*this.params.count,this.alarmCount=1e3*this.params.alarmCount,this.alarmColor=selectValue(this.params.alarmColor,i)},SimpleCountdown.prototype.setCycleEndCallback=function(t){this.cycleEndCallback=t},SimpleCountdown.prototype.createVisual=function(){SimpleCountdown.parent.createVisual.call(this),this.description.style=null==this.description.style?"dialogButtonLabel lcdmono-ultra":this.description.style,this.label=this.label?this.label:guiFactory.createObject("GuiLabel",{parent:this.guiParent,x:this.params.x,y:this.params.y,style:this.description.style,width:this.description.width,height:this.description.height,align:"center",verticalAlign:"middle",text:this.params.count,fontSize:this.description.fontSize,color:this.description.color});var t={};t.visual=this.label,this.addVisual(null,t),this.paused=!1},SimpleCountdown.prototype.pause=function(){this.paused=!0},SimpleCountdown.prototype.resume=function(){this.paused=!1,this.time=Date.now()},SimpleCountdown.prototype.setTime=function(t){this.count=1e3*t},SimpleCountdown.prototype.addTime=function(t){this.count+=1e3*t},SimpleCountdown.prototype.getTimeRemains=function(){return this.count},SimpleCountdown.prototype.start=function(){this.setEnable(!0),this.paused=!1,this.time=Date.now()},SimpleCountdown.prototype.updateLabel=function(){var t=Math.floor(this.count/1e3);if(t>=60){var e=Math.floor(t/60);t-=60*e,this.label.change(e+" : "+t)}else this.label.change(t)},SimpleCountdown.prototype.update=function(t){!this.paused&&this.count&&(this.count-=Date.now()-this.time,this.time=Date.now(),this.count>0?this.alarmCount&&this.count<this.alarmCount+1e3?(this.label.setColor(this.alarmColor),this.alarmCount=null):this.updateLabel():(this.label.change(this.goText),this.cycleEndCallback&&(this.cycleEndCallback(),this.cycleEndCallback=null)))},Countdown.inheritsFrom(VisualEntity),Countdown.prototype.className="Countdown",Countdown.prototype.createInstance=function(t){var e=new Countdown;return e.init(t),e},entityFactory.addClass(Countdown),Countdown.prototype.init=function(t){Countdown.parent.init.call(this,t)},Countdown.prototype.setCycleEndCallback=function(t){this.cycleEndCallback=t},Countdown.prototype.setEndCallback=function(t){this.EndCallback=t},Countdown.prototype.createVisual=function(){if(Countdown.parent.createVisual.call(this),this.description.sprite){this.sprite=guiFactory.createObject("GuiSprite",{parent:this.guiParent,style:"dialogButton",x:this.params.x,y:this.params.y,width:this.description.sprite.width,height:this.description.sprite.height,totalImage:Resources.getImage(this.description.sprite.totalImage),totalImageWidth:this.description.sprite.totalImageWidth,totalImageHeight:this.description.sprite.totalImageHeight,totalTile:this.description.sprite.totalTile,spriteAnimations:this.description.sprite.spriteAnimations});var t={};t.visual=this.sprite,this.addVisual("sprite",t)}if(this.tickSound=this.description.tickSound?this.description.tickSound:"beepShort",this.lastSound=this.description.lastSound?this.description.lastSound:"beepShort",this.tickDuration=this.description.tickDuration?this.description.tickDuration:1e3,this.count=this.params.count,this.duration=this.count*this.tickDuration,this.alarmColor=this.description.alarmColor,this.alarmCount=this.params.alarmCount,this.paused=!!this.description.paused&&this.description.paused,this.description.label){this.label=guiFactory.createObject("GuiLabel",{parent:this.guiParent,style:this.description.label.params.style?this.description.label.params.style:"dialogButtonLabel lcdmono-ultra",width:this.description.label.params.width,height:this.description.label.params.height,x:this.description.label.params.x?this.description.label.params.x:this.params.x,y:this.description.label.params.y?this.description.label.params.y:this.params.y,align:"center",verticalAlign:"middle",text:this.count,fontSize:this.description.label.params.fontSize,color:this.description.label.params.color});var e={};e.visual=this.label,this.addVisual("label",e)}var i=this,n=!1,a=function(){i.paused||(i.count>1?(i.count--,i.label&&i.label.change(i.count),i.sprite&&i.sprite.playAnimation("countdown",i.tickDuration,!1),i.sprite.setAnimationEndCallback(a)):(i.sprite&&i.sprite.playAnimation("empty",i.tickDuration,!0),i.label&&i.label.change(i.description.go),i.EndCallback&&i.EndCallback(),n=!0))};n||this.sprite&&(this.sprite.playAnimation("countdown",1e3,!1),this.sprite.setAnimationEndCallback(a))},Countdown.prototype.update=function(t){var e=Math.floor(this.duration/1e3)+1;this.paused||(this.sprite&&this.sprite.update(t),this.label&&(this.duration-=t,this.duration>0?(this.cycleEndCallback&&e!=Math.floor(this.duration/1e3)+1&&(this.cycleEndCallback(),e=this.label.text),this.alarmCount&&this.duration/1e3<this.alarmCount?(this.label.setColor(this.description.alarmColor),this.alarmCount=null):this.sprite||this.label.change(Math.floor(this.duration/1e3)+1)):this.sprite||(this.label.change(this.description.go),this.EndCallback&&(this.EndCallback(),delete this.update))),this.label||this.sprite||(this.duration>0?(this.duration-=t,this.cycleEndCallback&&e!=Math.floor(this.duration/1e3)+1&&(this.cycleEndCallback(),e=Math.floor(this.duration/1e3)+1)):this.EndCallback&&(this.EndCallback(),delete this.update)))},Countdown.prototype.pause=function(){this.paused=!0},Countdown.prototype.resume=function(){this.paused=!1},Countdown.prototype.getTimeRemains=function(){return this.count},Inventory.inheritsFrom(Entity),Inventory.prototype.className="Inventory",Inventory.prototype.createInstance=function(t){var e=new Inventory;return e.init(t),e},entityFactory.addClass(Inventory),Inventory.prototype.init=function(t){this.children=new Array,Inventory.parent.init.call(this,t)},Inventory.prototype.clear=function(){this.params.itemList=null},Inventory.prototype.addItem=function(t){t instanceof Item&&Account.instance.commandToServer("changeParent",[t.id,this.id],function(t){t?(console.log("SUCCESS"),console.log("ItemADDED")):console.log("FAIL")})},Inventory.prototype.readUpdate=function(t){Inventory.parent.readUpdate.call(this,t)},Inventory.prototype.writeUpdate=function(t,e){Inventory.parent.writeUpdate.call(this,t,e)};var LEVEL_FADE_TIME=500;BackgroundState.inheritsFrom(BaseState),BackgroundState.prototype.init=function(t){var e,i=selectValue((t=t||{}).image,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=");t.background&&(e=t.background,i=null),this.dialogs=new Object;var n=this;t.dialogs&&$.each(t.dialogs,function(t,e){n.dialogs[t]=guiFactory.createObject("GuiMessageBox",e.params)}),BackgroundState.parent.init.call(this,t),t.transparent?this.transparent=!0:this.transparent=!1,this.mask=guiFactory.createObject("GuiDiv",{parent:"#all",image:this.transparent?null:i,background:this.transparent?null:e,style:this.transparent?"":"mask",width:"100%",height:"100%",x:0,y:0}),t.loader&&(t.loader.text?this.loader=guiFactory.createObject("GuiLabel",{parent:this.mask,image:t.loader.image,text:t.loader.text,style:t.loader.style?t.loader.style:"spite",fontSize:t.loader.fontSize?t.loader.fontSize:40,width:t.loader.width?t.loader.width:274,height:t.loader.height?t.loader.height:66,x:"50%",y:t.loader.y?t.loader.y:"65%",offsetX:t.loader.width?-t.loader.width/2:-137,offsetY:t.loader.height?-t.loader.height/2:-33,align:"center"}):this.loader=guiFactory.createObject("GuiDiv",{parent:this.mask,image:t.loader.image,background:{image:t.loader.image},style:"spite",width:t.loader.width?t.loader.width:274,height:t.loader.height?t.loader.height:66,x:"50%",y:"65%",offsetX:t.loader.width?-t.loader.width/2:-137,offsetY:t.loader.height?-t.loader.height/2:-33}),this.loader.setClickTransparent(!0),this.addGui(this.loader),this.loader.$().css("opacity",0),this.loader.$().css("position","absolute"),this.loader.setZ(11001),this.loader.hide()),this.addGui(this.mask),this.mask.setClickTransparent(!0),this.mask.$().css("opacity",0),this.mask.setZ(1e3),this.mask.hide()},BackgroundState.prototype.fadeIn=function(t,e,i){var n=this;console.log("BackgroundState.prototype.fadeIn"),null!=this.loader&&(this.loader.show(),this.loader.$().css("opacity",0),this.loader.$().stop(),this.loader.$().delay(.5*t),this.loader.fadeTo(1,.5*t,function(){})),this.mask.show(),this.mask.$().stop(),this.mask.$().css("opacity",0),this.transparent||this.mask.$().css("background-color",e),this.mask.fadeTo(1,t,function(){n.faded=!0,i&&i()})},BackgroundState.prototype.fadeOut=function(t,e){var i=this;console.log("BackgroundState.prototype.fadeOut"),null!=this.loader&&(this.loader.$().stop(),this.loader.hide()),this.mask.fadeTo(0,t,function(){i.faded=!1,i.mask.hide(),e&&e()}),this.faded=!1},BackgroundState.prototype.resize=function(){BackgroundState.parent.resize.call(this),this.mask.resize(),null!=this.loader&&(this.loader.resize(),this.loader.$().css("position","absolute")),$.each(this.dialogs,function(t,e){e.resize()})};var DEFAULT_B2WORLD_RATIO=1;"undefined"==typeof Native&&(b2Math=Box2D.Common.Math.b2Math,b2Vec2=Box2D.Common.Math.b2Vec2,b2BodyDef=Box2D.Dynamics.b2BodyDef,b2Body=Box2D.Dynamics.b2Body,b2FixtureDef=Box2D.Dynamics.b2FixtureDef,b2Fixture=Box2D.Dynamics.b2Fixture,b2World=Box2D.Dynamics.b2World,b2MassData=Box2D.Collision.Shapes.b2MassData,b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,b2DebugDraw=Box2D.Dynamics.b2DebugDraw,b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef);var MathUtils={toRad:function(t){return Math.PI/180*t},toDeg:function(t){return 180/Math.PI*t}},Physics=function(){function t(t,n,a){null==e&&(i=null!=a?a:DEFAULT_B2WORLD_RATIO,e=new b2World(null!=t?t:new b2Vec2(0,10),null==n||n),u=new ContactProcessor)}var e=null,i=DEFAULT_B2WORLD_RATIO,n=null,a=null,o=!1,s=!0,r=null,c=[],l=[],u=null;return{createWorld:function(e,i,n){t(e,i,n)},getWorld:function(){return t(),assert(e,"No physics world created!"),e},getB2dToGameRatio:function(){return i},addBodyToDestroy:function(t){l.push(t)},createWorldBorder:function(t){!function(t){assert(e);var i=ENHANCED_BASE_MARGIN_WIDTH;if(!a)var a=0;var o=100,s=BASE_WIDTH,r=BASE_HEIGHT,c=s+200+2*i,l=r+200-a,u=[boxPolyVertices(-o-i,-1100,o,l+1e3),boxPolyVertices(s+i,-1100,o,l+1e3),boxPolyVertices(-o-i,r-a,c,o)];n=Physics.createPolyComposite(0,0,0,u)}()},getContactProcessor:function(){return u},getContactListener:function(){return null},updateWorld:function(){if(!o){var t=this.getWorld();t.Step(1/45,5,5),a&&a.tick(15),r&&t.DrawDebugData(),t.ClearForces();for(e=0;e<c.length;++e)c[e].updatePositionFromPhysics(),DOM_MODE&&c[e].initialPosRequiered&&(c[e].initialPosRequiered=null,c[e].physics.SetAwake(!1));if(l.length>0){for(var e=0;e<l.length;++e)t.DestroyBody(l[e]);l=[]}}},destroy:function(t){t&&(assert(e),e.DestroyBody(t))},destroyWorld:function(){Physics.destroy(n),e=null,c=[]},getWorldBorder:function(){return n||t(),assert(n),n},pause:function(t){o=null==t?!o:t},paused:function(){return o},resetTimeout:function(t){a&&(a.timeOut+=t)},clearTimeout:function(){a=null},setTimeout:function(t,e){a={time:0,callback:t,timeOut:e,tick:function(t){this.time+=t,this.time<this.timeOut||(this.callback(),a=null)}}},updateItemAdd:function(t){-1==c.indexOf(t)&&c.push(t)},updateItemRemove:function(t){var e=c.indexOf(t);-1!=e&&c.splice(e,1)},destroy:function(t){t&&(Physics.updateItemRemove(t),e&&t.physics&&e.DestroyBody(t.physics))},debugDrawing:function(t){!function(t){t&&!r&&(r=new DebugCanvas),!t&&r&&(r.debugDrawContext.clearRect(0,0,r.debugCanvasWidth,r.debugCanvasHeight),r=null)}(t)},debugDrawingIsOn:function(t){return!!r},setDebugModeEnabled:function(t){s=t},debugMode:function(){return s},explode:function(){}}}(),collisionCallback=function(){var t=contact.GetFixtureA().GetBody().GetUserData(),e=contact.GetFixtureB().GetBody().GetUserData(),i=t.descriptions.material,n=e.descriptions.material,a=Physics.getMaterialImpact(i,n);if(t.beginContact&&t.beginContact(e,a),e.beginContact&&entity12.beginContact(t,a),a.effect)new VisualEffect(a.effect)},DAMAGE_DECR=180,FORCE_RATING=.1;Physics.explode=function(t){function e(){setTimeout(function(){for(var r=n.m_bodyList;null!=r;r=r.m_next){var c=r.GetPosition().Copy();c.Multiply(Physics.getB2dToGameRatio());var l=new b2Vec2(c.x-t.center.x,c.y-t.center.y),u=l.Length();if(u<t.radius){var h=l;if(h.Normalize(),h.Multiply(FORCE_RATING*t.force/Math.pow(1+u,i)),r.m_userData&&"CannonBall"!=r.m_userData.params.id&&(r.SetAwake(!1),r.ApplyImpulse(h,r.GetPosition())),r.m_userData&&r.m_userData.destructable){var p=h.Length()/(0!==DAMAGE_DECR?DAMAGE_DECR:t.damageDecr?t.damageDecr:1);r.m_userData.onDamage(p),a+=p}}}s<t.duration&&e(),s+=o},5)}var i=null!=t.decr?t.decr:1;DAMAGE_DECR=null!=t.damageDecr?t.damageDecr:150;var n=Physics.getWorld(),a=0,o=t.delta>0?t.delta:20,s=t.duration/o;Physics.getB2dToGameRatio();e()},ContactProcessor.prototype.addPair=function(t,e,i,n){var a=this;if(!Physics.getContactListener()){var o=Physics.getContactListener();(o=new Box2D.Dynamics.b2ContactListener).BeginContact=function(t){if(a){var e=t.GetFixtureA().GetBody().GetUserData().params.type,i=t.GetFixtureB().GetBody().GetUserData().params.type;a.processBegin(e,i,t)}},o.EndContact=function(t){if(a){var e=t.GetFixtureA().GetBody().GetUserData().params.type,i=t.GetFixtureB().GetBody().GetUserData().params.type;a.processEnd(e,i,t)}},o.PreSolve=function(t,e){},o.PostSolve=function(t,e){};Physics.getWorld().SetContactListener(o)}t in this.pairs?this.pairs[t][e]?this.pairs[t][e][i]=n:(this.pairs[t][e]={},this.pairs[t][e][i]=n):e in this.pairs?this.pairs[e][t]?this.pairs[e][t][i]=n:(this.pairs[e][t]={},this.pairs[e][t][i]=n):(this.pairs[t]={},this.pairs[t][e]={},this.pairs[t][e][i]=n)},ContactProcessor.prototype.setDefaultBeginContact=function(t){this.defaultBegin=t},ContactProcessor.prototype.setDefaultEndContact=function(t){this.defaultEnd=t},ContactProcessor.prototype.processBegin=function(t,e,i){t in this.pairs&&e in this.pairs[t]&&this.pairs[t][e].beginContact?this.pairs[t][e].beginContact(i):e in this.pairs&&t in this.pairs[e]&&this.pairs[e][t].beginContact?this.pairs[e][t].beginContact(i):this.defaultBegin(i)},ContactProcessor.prototype.processEnd=function(t,e,i){t in this.pairs&&e in this.pairs[t]&&this.pairs[t][e].endContact?this.pairs[t][e].endContact(i):e in this.pairs&&t in this.pairs[e]&&this.pairs[e][t].endContact?this.pairs[e][t].endContact(i):this.defaultEnd(i)};var ANIM_DELAY=400;PhysicEntity.inheritsFrom(VisualEntity),PhysicEntity.prototype.className="PhysicEntity",PhysicEntity.prototype.createInstance=function(t){var e=new PhysicEntity;return e.init(t),e},entityFactory.addClass(PhysicEntity),PhysicEntity.prototype.init=function(t){var e={};this.physicsEnabled=!0,DOM_MODE&&(this.initialPosRequiered=!0),null!=t.type&&(e=Account.instance.descriptionsData[t.type]),PhysicEntity.parent.init.call(this,$.extend(t,e)),this.params.physics&&(this.createPhysics(),assert(!this.physics.m_userData),this.physics.m_userData=this,this.updatePositionFromPhysics(),(!this.physics.m_type==b2Body.b2_staticBody||Physics.debugMode())&&Physics.updateItemAdd(this))},PhysicEntity.prototype.createPhysics=function(){function t(t,e){t.density=selectValue(e.density,1),t.restitution=selectValue(e.restitution,1),t.friction=selectValue(e.friction,0),t.isSensor=selectValue(e.sensor,!1),t.userData=selectValue(e.userData,!1),null!=e.filter&&(t.filter.categoryBits=selectValue(e.filter.categoryBits,1),t.filter.groupIndex=selectValue(e.filter.groupIndex,0),t.filter.maskBits=selectValue(e.filter.maskBits,65535))}var e,i=[],n=this.params.physics,a={x:this.params.x/Physics.getB2dToGameRatio(),y:this.params.y/Physics.getB2dToGameRatio()};switch(e=new b2BodyDef,e.type=n.static?b2Body.b2_staticBody:b2Body.b2_dynamicBody,e.userData=null,n.type){case"Box":(o=new b2FixtureDef).shape=new b2PolygonShape,o.shape.SetAsBox(n.width/(2*Physics.getB2dToGameRatio()),n.height/(2*Physics.getB2dToGameRatio())),t(o,n),i.push(o);break;case"Circle":(o=new b2FixtureDef).shape=new b2CircleShape(n.radius/Physics.getB2dToGameRatio()),t(o,n),i.push(o);break;case"Poly":var o=new b2FixtureDef;o.shape=new b2PolygonShape;var s=cloneObject(n.vertices);$.each(s,function(t,e){e.x=(e.x+n.x)/Physics.getB2dToGameRatio(),e.y=(e.y+n.y)/Physics.getB2dToGameRatio()}),o.shape.SetAsArray(s,s.length),t(o,n),i.push(o);break;case"PrimitiveComposite":$.each(n.shapes,function(e,n){var a=new b2FixtureDef;switch(n.type){case"Box":a.shape=new b2PolygonShape;var o=new b2Vec2(n.x/Physics.getB2dToGameRatio(),n.y/Physics.getB2dToGameRatio());a.shape.SetAsOrientedBox(n.width/(2*Physics.getB2dToGameRatio()),n.height/(2*Physics.getB2dToGameRatio()),o);break;case"Circle":a.shape=new b2CircleShape(n.radius/Physics.getB2dToGameRatio()),a.shape.SetLocalPosition(new b2Vec2(n.x/Physics.getB2dToGameRatio(),n.y/Physics.getB2dToGameRatio()));break;case"Poly":a.shape=new b2PolygonShape,$.each(n.vertices,function(t,e){e.x=(e.x+n.x)/Physics.getB2dToGameRatio(),e.y=(e.y+n.y)/Physics.getB2dToGameRatio()}),a.shape.SetAsArray(n.vertices,n.vertices.length)}t(a,n),i.push(a)})}e.position.Set(0,0),e.linearDamping=null!=n.linearDamping?n.linearDamping:0,e.angularDamping=null!=n.angularDamping?n.angularDamping:0;var r=Physics.getWorld();this.physics=r.CreateBody(e);var c=this;$.each(i,function(t,e){c.physics.CreateFixture(e)}),this.physics.SetPosition(a),this.destructable=n.destructable,this.destructable?this.health=n.health:this.health=null,this.params.angle&&this.rotate(2*this.params.angle)},PhysicEntity.prototype.getContactedBody=function(){if(this.physics.m_contactList)return this.physics.m_contactList.other},PhysicEntity.prototype.getContactList=function(){return this.physics.m_contactList},PhysicEntity.prototype.createVisual=function(){PhysicEntity.parent.createVisual.call(this)},PhysicEntity.prototype.updatePositionFromPhysics=function(){if(null!=this.physics&&(!DOM_MODE||this.physics.IsAwake())){var t=this.getPosition();(!DOM_MODE||this.initialPosRequiered||!Device.isMobile()||!this.pos||Math.abs(t.x-this.pos.x)>1||Math.abs(t.y-this.pos.y)>1)&&(this.pos=this.getPosition(),this.setPosition(t.x-this.params.physics.x-this.params.physics.width/2,t.y-this.params.physics.y-this.params.physics.height/2));var e=this.getPhysicsRotation().toFixed(3);(!DOM_MODE||this.initialPosRequiered||!Device.isMobile()||!this.angleInDeg||Math.abs(e-this.angleInDeg)>.02)&&(this.angleInDeg=this.getPhysicsRotation().toFixed(3),e=MathUtils.toDeg(e),$.each(this.visuals,function(t,i){i.visual.rotate(e)}))}},PhysicEntity.prototype.physicsEnable=function(t){this.physicsEnabled=!!t,this.physics.SetActive(this.physicsEnabled)},PhysicEntity.prototype.getPhysicsRotation=function(){return this.physics.GetAngle()},PhysicEntity.prototype.setPhysicsPosition=function(t){(t=new b2Vec2(t.x,t.y)).Multiply(1/Physics.getB2dToGameRatio()),DOM_MODE&&this.physics.SetAwake(!0),this.physics.SetPosition(t),this.updatePositionFromPhysics(),DOM_MODE&&this.physics.SetAwake(!1)},PhysicEntity.prototype.getPosition=function(){if(this.physics){var t=this.physics.GetPosition().Copy();return t.Multiply(Physics.getB2dToGameRatio()),t}},PhysicEntity.prototype.onDragBegin=function(){this.physicsEnable(!1)},PhysicEntity.prototype.onDragEnd=function(){this.physicsEnable(!0)},PhysicEntity.prototype.rotateByAxis=function(t,e){var i=new Transform;i.translate(t.x,t.y);var n=new Transform;n.rotateDegrees(e),i.multiply(n),n.reset(),n.translate(-t.x,-t.y),i.multiply(n);var a=this;$.each(this.visuals,function(t,e){var n=i.transformPoint(a.params.x-a.params.physics.x,a.params.y-a.params.physics.y);a.physics.SetPosition(new b2Vec2(n[0],n[1]))})},PhysicEntity.prototype.rotate=function(t){var e=this.physics.GetPosition(),i=this.physics.GetAngle()+t;DOM_MODE&&this.physics.SetAwake(!0),this.physics.SetPositionAndAngle(e,i/2),this.updatePositionFromPhysics(),DOM_MODE&&this.physics.SetAwake(!1)},PhysicEntity.prototype.destroy=function(){PhysicEntity.parent.destroy.call(this),this.physics&&(Physics.getWorld().IsLocked()?Physics.addBodyToDestroy(this.physics):Physics.getWorld().DestroyBody(this.physics)),Account.instance.removeEntity(this.id,!0)},PhysicEntity.prototype.onDamage=function(t){var e=this;!this.destructable||this.health<=0||(this.health-=t,this.params.physics.destructionLevels&&$.each(e.params.physics.destructionLevels,function(t,i){e.health<=i.minHealth&&$.each(e.visuals,function(t,e){e.visual.playAnimation(i.animName,ANIM_DELAY,!1,!0)})}),this.health<=0&&$.each(e.visuals,function(t,i){e.params.builtInDestruction?i.visual.setAnimationEndCallback(function(){e.destroy()}):e.destroy()}))},PhysicEntity.prototype.setMaterial=function(t){"string"==typeof t&&""!=t&&(this.material=t)},PhysicEntity.prototype.getMaterial=function(){return this.material},PhysicScene.inheritsFrom(Scene),PhysicScene.prototype.className="PhysicScene",PhysicScene.prototype.createInstance=function(t){var e=new PhysicScene;return e.init(t),e},entityFactory.addClass(PhysicScene),PhysicScene.prototype.init=function(t){PhysicScene.parent.init.call(this,t),this.physicWorld=Physics.getWorld(),t.physicsBorder&&Physics.createWorldBorder(t.physicsBorder),this.contactProcessor=function(t){}},PhysicScene.prototype.addChild=function(t){PhysicScene.parent.addChild.call(this,t)},PhysicScene.prototype.createVisual=function(){PhysicScene.parent.createVisual.call(this),this.setInterval(function(){Physics.updateWorld()},15)},PhysicScene.prototype.setBackgrounds=function(t,e){e||(e=this.getVisual()),$.each(t,function(t,i){e.setBackground(i.src,i.backWidth,i.backHeight,i.backX,i.backY,i.repeat,i.idx)}),e.resize()},PhysicScene.prototype.attachChildVisual=function(t){PhysicScene.parent.attachChildVisual.call(this,t)},PhysicScene.prototype.destroy=function(){PhysicScene.parent.destroy.call(this)},CreatePhysicsTrigger=function(t,e,i){var n={};return n.rect=e,n.world=t,n.action=i,n.checkIfIn=function(t){var e=!1;return t.x>n.rect.left&&t.x<n.rect.right&&t.y>n.rect.top&&t.y<n.rect.bottom&&(e=!0),e},n.move=function(t,e){this.rect.left+=t,this.rect.right+=t,this.rect.top+=e,this.rect.bottom+=e},n.setPosition=function(t,i){var n=e.right-e.left,a=e.bottom-e.top;this.rect.left=t,this.rect.right=t+n,this.rect.top=i,this.rect.bottom=i+a},n.update=function(){for(var t=n.world.m_bodyList;null!=t;t=t.m_next){var e=t.GetPosition().Copy();e.Multiply(Physics.getB2dToGameRatio()),n.checkIfIn(e)&&n.action(t)}},n},Effect.inheritsFrom(VisualEntity),Effect.prototype.className="Effect",Effect.prototype.createInstance=function(t){var e=new Effect;return e.init(t),e},entityFactory.addClass(Effect),Effect.prototype.init=function(t){var e={};null!=t.type&&(e=Account.instance.descriptionsData[t.type]),Effect.parent.init.call(this,$.extend(t,e)),this.guis=new Array},Effect.prototype.createVisual=function(){},Effect.prototype.play=function(t,e){var i=this;t&&(i.x=t.x,i.y=t.y),$.each(i.params.visuals,function(n,a){a.parent=i.guiParent;var o=guiFactory.createObject(a.class,$.extend(a,t));o.clampByParentViewport(),i.guis.push(o),$.each(o.animations,function(t,n){o.playAnimation(t,i.params.lifeTime,!1,!0),i.setTimeout(function(){o.hide(),o.remove(),e&&e()},i.params.lifeTime)})})},Effect.prototype.destroy=function(){Effect.parent.destroy.call(this),$.each(this.guis,function(t,e){e.remove(),delete e}),this.guis=new Array};var guiFactory=new AbstractFactory;guiFactory.createGuiFromJson=function(t,e){guiFactory.createObjectsFromJson(t,function(t,i){if(i.parent&&"string"==typeof i.parent){var n=e.getGui(i.parent);if(n||0==(n=$(i.parent)).length&&(n=null),n)return void(i.parent=n)}console.warn("For object '"+t+"' wrong parent '"+i.parent+"' is provided.")},function(t,i){e.addGui(i,t),i.parent&&i.parent.children&&i.parent.children.addGui(i,t),i.name=t})},GuiContainer.prototype.init=function(){this.guiEntities=new Array,this.guiEntitiesMap=new Object},GuiContainer.prototype.resize=function(){for(var t=0;t<this.guiEntities.length;t++)this.guiEntities[t].resize&&this.guiEntities[t].resize()},GuiContainer.prototype.update=function(t){for(var e=0;e<this.guiEntities.length;e++)this.guiEntities[e].update&&this.guiEntities[e].update(t)},GuiContainer.prototype.render=function(t){if(t)for(var e=0;e<this.guiEntities.length;e++)this.guiEntities[e].render&&(t.save(),this.guiEntities[e].render(t),t.restore())},GuiContainer.prototype.setUpdateInterval=function(t){var e=this;this.updateIntervalTime=t,this.updateIntervalHandler=setInterval(function(){e.update(e.updateIntervalTime)},this.updateIntervalTime)},GuiContainer.prototype.resetUpdateInterval=function(){this.updateIntervalHandler&&(clearInterval(this.updateIntervalHandler),this.updateIntervalHandler=null,this.updateIntervalTime=null)},GuiContainer.prototype.clear=function(){for(var t=0;t<this.guiEntities.length;t++)this.guiEntities[t].remove&&this.guiEntities[t].remove();popAllElementsFromArray(this.guiEntities),this.guiEntitiesMap={}},GuiContainer.prototype.remove=function(){this.clear(),this.resetUpdateInterval()},GuiContainer.prototype.addGui=function(t,e){assert(t,"Trying to add null pointer!"),this.guiEntities.push(t),"string"==typeof e&&(t.name=e,this.guiEntitiesMap[e]=t)},GuiContainer.prototype.removeGui=function(t){popElementFromArray(t,this.guiEntities),this.guiEntitiesMap[t.name]&&delete this.guiEntitiesMap[t.name],t.remove()},GuiContainer.prototype.getGui=function(t){return this.guiEntitiesMap[t]},GuiElement.prototype.className="GuiElement",GuiElement.prototype.createInstance=function(t){var e=new GuiElement;return e.initialize(t),e},guiFactory.addClass(GuiElement),GuiElement.prototype.generateId=function(){return this.className+uniqueId()},GuiElement.prototype.generate=function(t){return assert(this.id,"Id not defined"),assert(this.style,"Class for object with id = '"+this.id+"' is not defined"),'<div id="'+this.id+'" class="'+this.style+' unselectable">'+t+"</div>"},GuiElement.prototype.create=function(t){this.setParent(this.parent)||(this.setParent($("body")),console.warn("No parent was provided for object id = "+this.id)),t=null==t?"":t;var e=this.generate(t);"GuiDiv1990"==this.id&&console.log("Generated source for element: ",e),this.parent.jObject.append(e),this.jObject=$("#"+this.id),assert(this.jObject.length>0,"Object id ='"+this.id+"' was not properly created")},GuiElement.prototype.$=function(){return this.jObject},GuiElement.prototype.setEnable=function(t){this.enable=t},GuiElement.prototype.isEnabled=function(){return 1==this.enable},GuiElement.prototype.callBindedFunction=function(t,e){this.isEnabled()?this[e](t):console.log("Button is not enabled "+this.id)},GuiElement.prototype.bind=function(t,e){if(e="string"==typeof e?e:"click",t&&(this[e]=t),this[e]){this.unbind(e);var i=this;this.jObject.bind(Device.event(e)+".guiElementEvents",function(t){i.callBindedFunction(t,e)})}},GuiElement.prototype.unbind=function(t){t="string"==typeof t?t:"",this.jObject.unbind(t+".guiElementEvents")},GuiElement.prototype.init=function(){this.children.init(),this.create(this.src),this.pushFunction&&this.bind(this.pushFunction),this.resize()},GuiElement.prototype.initialize=function(t){this.params=t,this.parent=t.parent,this.id=this.generateId(),$("#"+this.id).length>0&&console.error(" GuiElement with  id = '"+this.id+"' is already exists."),this.style=t.style,this.width=t.width,this.height=t.height,this.enable=!0,this.children=new GuiContainer,this.children.init(),this.src=t.html?t.html:this.src,t.jObject?this.jObject=t.jObject:this.create(this.src),this.jObject.data("guiElement",this),this.pushFunction&&this.bind(this.pushFunction);var e=this;t.animations&&$.each(t.animations,function(t,i){e.addJqueryAnimation(t,i)}),this.setOffset(Screen.macro(t.offsetX),Screen.macro(t.offsetY)),this.setPosition(Screen.macro(t.x),Screen.macro(t.y)),this.setSize(Screen.macro(t.width),Screen.macro(t.height)),"number"==typeof t.z&&this.setZ(t.z),t.hide?this.hide():this.show(),"number"==typeof t.opacity&&this.setOpacity(t.opacity),this.resize()},GuiElement.prototype.setOffset=function(t,e){this.offsetX=t,this.offsetY=e},GuiElement.prototype.calcPercentageWidth=function(t){if("string"==typeof t&&t.indexOf("%")>-1){var e=this.parent.jObject.width()/Screen.widthRatio();assert("number"==typeof e,"Wrong parent or value for % param name='"+this.name+"'"),t=parseFloat(t.replace("%",""))*e/100}return t},GuiElement.prototype.calcPercentageHeight=function(t){if("string"==typeof t&&t.indexOf("%")>-1){var e=this.parent.jObject.height()/Screen.heightRatio();assert("number"==typeof e,"Wrong parent or value for % param name='"+this.name+"'"),t=parseFloat(t.replace("%",""))*e/100}return t},GuiElement.prototype.setPosition=function(t,e){this.x=t,this.y=e;var i=0,n=0;"number"==typeof this.offsetX&&(i=this.offsetX),null!=this.offsetY&&(n=this.offsetY),t=this.calcPercentageWidth(t),e=this.calcPercentageHeight(e),this.setRealPosition(t+i,e+n)},GuiElement.prototype.move=function(t,e){this.x+=t,this.y+=e,this.setPosition(this.x,this.y)},GuiElement.prototype.getRealPosition=function(){return{x:this.jObject.css("left").replace("px",""),y:this.jObject.css("top").replace("px","")}},GuiElement.prototype.getPosition=function(){return{x:this.x,y:this.y}},GuiElement.prototype.setZ=function(t){this.jObject.css("z-index",t),this.jObject.css("-webkit-transform","translateZ(0)"),this.z=t},GuiElement.prototype.show=function(){this.jObject.show(),this.visible=!0},GuiElement.prototype.hide=function(){this.jObject.hide(),this.visible=!1},GuiElement.prototype.setOpacity=function(t){this.jObject.css("opacity",t)},GuiElement.prototype.isEventIn=function(t){var e=Device.getPositionFromEvent(t),i=this.$().offset().left,n=i+this.$().width(),a=this.$().offset().top,o=a+this.$().height();return e.x>i&&e.x<n&&e.y>a&&e.y<o},GuiElement.prototype.addJqueryAnimation=function(t,e){this.jqueryAnimations=this.jqueryAnimations?this.jqueryAnimations:new Object,this.jqueryAnimations[t]=e},GuiElement.prototype.playJqueryAnimation=function(t,e){var i=this.jqueryAnimations[t];assert(i,"No animation found with name '"+t+"'"),this.stopJqueryAnimation();for(var n=null,a=this,o=function(t,e){t.setPosition(e.x||t.x,e.y||t.y),e.display&&("hide"===e.display?t.hide():"show"===e.display&&t.show())},s=0;s<i.length;s++){var r,c=i[s];if(r=c.animate){var l=new Object;$.each(r.actions,function(t,e){var i=e[0],n=e[1],a=e[2];"left"==i||"width"==i?a="number"==typeof a?Math.round(a*Screen.widthRatio()):a:"top"!=i&&"height"!=i||(a="number"==typeof a?Math.round(a*Screen.heightRatio()):a),l[i]=n+a.toString()}),a.$().animate(l,r.time)}else if(r=c.start){var u=null!=r.x?r.x:a.x,h=null!=r.y?r.y:a.y;a.setPosition(u,h),o(a,r)}else(r=c.final)&&(n=function(){var t=null!=r.x?r.x:a.x,e=null!=r.y?r.y:a.y;a.setPosition(t,e),o(a,r)})}this.jqueryAnimationCallback=function(){n&&n(),e&&e()},this.$().queue("fx",function(){a.jqueryAnimationCallback(),a.jqueryAnimationCallback=null,a.jObject.stop(!0)})},GuiElement.prototype.stopJqueryAnimation=function(){this.$().is(":animated")&&(this.$().stop(!0),this.jqueryAnimationCallback&&(this.jqueryAnimationCallback(),this.jqueryAnimationCallback=null))},GuiElement.prototype.isVisible=function(){return this.visible},GuiElement.prototype.setSize=function(t,e){this.width=t,this.height=e,this.resize()},GuiElement.prototype.setRealSize=function(t,e){var i=Screen.calcRealSize(t,e);this.jObject.css("width",i.x),this.jObject.css("height",i.y)},GuiElement.prototype.setRealPosition=function(t,e){var i=Screen.calcRealSize(t,e);this.jObject.css("left",i.x),this.jObject.css("top",i.y)},GuiElement.prototype.resize=function(){var t=this.calcPercentageWidth(this.width),e=this.calcPercentageHeight(this.height);this.setRealSize(t,e),this.setPosition(this.x,this.y),this.children.resize()},GuiElement.prototype.disableResize=function(t){null==this.originalResize&&(this.originalResize=this.resize),this.resize=0==t?this.originalResize:function(){}},GuiElement.prototype.change=function(t){this.src=t,this.detach(),this.create(t),this.pushFunction&&this.bind(this.pushFunction),this.resize(),this.show()},GuiElement.prototype.globalOffset=function(){var t=this.jObject.offset();return t=Screen.calcLogicSize(t.left,t.top),{x:t.x,y:t.y}},GuiElement.prototype.setParent=function(t,e){var i=null,n=null;if("string"==typeof t?n=$(t):t&&"object"==typeof t&&(t.jquery?n=t:t.jObject&&t.jObject.length>0&&(i=t)),n&&(assert(n.length>0,"Object id ='"+this.id+"' has wrong parent: '"+t+"'"),(i=n.data("guiElement"))||(i=guiFactory.createObject("GuiElement",{jObject:n}))),i){var a=this.parent;if(this.parent=i,a&&e){var o,s;o=a.globalOffset(),s=i.globalOffset();var r=o.x-s.x,c=o.y-s.y;this.move(r,c)}return this.jObject&&this.jObject.appendTo(i.jObject),!0}return console.error("Can't attach object '"+this.id+"' to parent that doesn't exists '"+t+"'"),!1},GuiElement.prototype.remove=function(){this.tooltip&&this.tooltip.remove(),this.children.remove(),this.jObject.remove()},GuiElement.prototype.detach=function(){this.jObject.detach()},GuiElement.prototype.addGui=function(t,e){this.children.addGui(t,e)},GuiElement.prototype.removeGui=function(t){this.children.removeGui(t)},GuiElement.prototype.getGui=function(t){return this.children.getGui(t)},GuiElement.prototype.center=function(){this.jObject.css("text-align","center")},GuiElement.prototype.fadeTo=function(t,e,i,n){var a=this;this.fadeToTimeout&&(clearTimeout(this.fadeToTimeout),this.fadeToTimeout=null),this.visible||n||(this.fadeToTimeout=setTimeout(function(){a.show()},1)),this.jObject.animate({opacity:t},e,i)},GuiElement.prototype.blinking=function(t,e,i,n){if(t){var a,o,s=e||1e3,r=this;a=function(){r.jObject.animate({opacity:i||0},s,o)},o=function(){r.jObject.animate({opacity:n||1},s,a)},a()}else this.jObject.stop()},GuiElement.prototype.right=function(){this.jObject.css("text-align","right")},GuiElement.prototype.left=function(){this.jObject.css("text-align","left")},GuiElement.prototype.setClickTransparent=function(t){t?this.jObject.css("pointer-events","none"):this.jObject.css("pointer-events","auto")},GuiElement.prototype.enableTouchEvents=function(t){Device.isTouch()?(document.body.ontouchstart=function(t){return t.preventDefault(),touchStartX=touchEndX=t.touches[0].pageX,touchStartY=touchEndY=t.touches[0].pageY,!1},document.body.ontouchmove=function(t){return t.preventDefault(),touchEndX=t.touches[0].pageX,touchEndY=t.touches[0].pageY,!1},document.body.ontouchend=function(e){if(e.preventDefault(),touchEndX&&touchEndY){var i={};i.pageX=touchEndX,i.pageY=touchEndY,t(i)}return!1}):this.jObject.bind("mousedown",t)},GuiElement.prototype.isPointInsideReal=function(t,e){var i=this.jObject.offset(),n=this.jObject.width(),a=this.jObject.height();return t>i.left&&t<i.left+n&&e>i.top&&e<i.top+a},GuiElement.prototype.getEventPosition=function(t){var e=Device.getPositionFromEvent(t),i=this.jObject.offset(),n={};n.x=e.x-i.left,n.y=e.y-i.top;return Screen.calcLogicSize(n.x,n.y)},VIEWPORT_KILLER=!1,GuiDiv.inheritsFrom(GuiElement),GuiDiv.prototype.className="GuiDiv",GuiDiv.prototype.createInstance=function(t){var e=new GuiDiv;return e.initialize(t),e},guiFactory.addClass(GuiDiv),GuiDiv.prototype.initialize=function(t){if(this.divname=t.divname,this.backgrounds=new Array,VIEWPORT_KILLER&&this.disableViewport(),t.image&&(t.background={image:t.image}),this.remote=t.remote,this.viewRect={},t.enhancedScene?(t.width=t.width?t.width:ENHANCED_BASE_WIDTH,t.height=t.height?t.height:ENHANCED_BASE_HEIGHT,t.x=t.x?t.x:-ENHANCED_BASE_MARGIN_WIDTH,t.y=t.y?t.y:-ENHANCED_BASE_MARGIN_HEIGHT,this.enhancedScene=!0,this.setViewport(Screen.fullRect())):t.innerScene&&(t.width=t.width?t.width:BASE_WIDTH,t.height=t.height?t.height:BASE_HEIGHT,t.x=t.x?t.x:ENHANCED_BASE_MARGIN_WIDTH,t.y=t.y?t.y:ENHANCED_BASE_MARGIN_HEIGHT,this.innerScene=!0),GuiDiv.parent.initialize.call(this,t),this.applyBackground(t.background),t.enhancedScene&&this.resize(),assert(!this.innerScene||this.parent.enhancedScene,"inner scene should always be child to enhanced scene"),this.innerScene&&this.clampByParentViewport(),t.canvas){var e=t.canvas;$.extend(e,{parent:this}),e.width=t.canvas.width?t.canvas.width:this.width,e.height=t.canvas.height?t.canvas.height:this.height,e.x=t.canvas.x?t.canvas.x:this.x,e.y=t.canvas.y?t.canvas.y:this.y,e.offsetX=t.canvas.offsetX?t.canvas.offsetX:this.offsetX,e.offsetY=t.canvas.offsetY?t.canvas.offsetY:this.offsetY,this.canvas=guiFactory.createObject("GuiCanvas",e)}},GuiDiv.prototype.generate=function(t){return'<div id="'+this.id+'" class="'+this.style+' unselectable"'+(this.divname?'name="'+this.divname+'"':"")+"></div>"},GuiDiv.prototype.empty=function(){this.jObject.empty()},GuiDiv.prototype.applyBackground=function(t){if(t instanceof Array)for(var e=t.length-1,i=0;i<t.length;i++)t[i].image=Resources.getImage(t[i].image),this.setBackgroundFromParams(t[i],e--);else t&&(t.image=this.remote?t.image:Resources.getImage(t.image),this.setBackgroundFromParams(t,null))},GuiDiv.prototype.setBackground=function(t,e,i,n,a,o,s,r,c){"begin"==c?(this.backgrounds.unshift({}),c=0):"end"==c&&(c=this.backgrounds.length),c=c||0,s=s||(this.backgrounds[c]&&this.backgrounds[c].frameX?this.backgrounds[c].frameX:0),r=r||(this.backgrounds[c]&&this.backgrounds[c].frameY?this.backgrounds[c].frameY:0),e=e||(this.backgrounds[c]&&this.backgrounds[c].width?this.backgrounds[c].width:this.width),i=i||(this.backgrounds[c]&&this.backgrounds[c].height?this.backgrounds[c].height:this.height),this.backgrounds[c]={url:t,width:e,height:i,left:n||0,top:a||0,frameX:s,frameY:r,repeat:o||"no-repeat"},this.showBackground()},GuiDiv.prototype.setBackgroundFromParams=function(t,e){var i=t.x?Screen.macro(t.x):0,n=t.y?Screen.macro(t.y):0,a=t.width?Screen.macro(t.width):this.width,o=t.height?Screen.macro(t.height):this.height,s=t.frameX?Screen.macro(t.frameX):0,r=t.frameY?Screen.macro(t.frameY):0,c=t.repeat?t.repeat:null;this.setBackground(t.image,a,o,i,n,c,s,r,e)},GuiDiv.prototype.setBackgroundPosition=function(t,e,i){i=i||0;var n=t||0,a=e||0;this.backgrounds[i].left=n,this.backgrounds[i].top=a,this.setRealBackgroundPosition(0,0)},GuiDiv.prototype.setRealBackgroundPosition=function(t,e){var i=" ";$.each(this.backgrounds,function(n,a){if(a){var o=Screen.calcRealSize(a.left+t,a.top+e);i+=o.x+"px "+o.y+"px,"}}),i=i.substr(0,i.length-1),this.jObject.css("background-position",i)},GuiDiv.prototype.resizeBackground=function(){var t=" ",e=" ",i=this;$.each(this.backgrounds,function(n,a){if(a){var o=Screen.calcRealSize(a.left+a.frameX,a.top+a.frameY);t+=o.x+"px "+o.y+"px,";var s=i.calcPercentageWidth(a.width),r=i.calcPercentageHeight(a.height),c=Screen.calcRealSize(s,r);e+=c.x+"px "+c.y+"px,"}}),e=e.substr(0,e.length-1),t=t.substr(0,t.length-1),this.jObject.css("background-size",e),this.jObject.css("background-position",t)},GuiDiv.prototype.setPosition=function(t,e){GuiDiv.parent.setPosition.call(this,t,e),this.viewport&&this.clampByViewport()},GuiDiv.prototype.resize=function(){GuiDiv.parent.resize.call(this),this.resizeBackground(),this.viewport&&this.clampByViewport(),this.canvas&&this.canvas.resize(this.width,this.height)},GuiDiv.prototype.dragBegin=function(t){if(!this.dragStarted){DragManager.setItem(this,t),this.dragStarted=!0;var e=Device.getPositionFromEvent(t);this.dragX=e.x,this.dragY=e.y,this.onDragBegin&&this.onDragBegin(),this.$().addClass("dragged")}},GuiDiv.prototype.dragMove=function(t){if(this.dragStarted){var e=Device.getPositionFromEvent(t),i=e.x-this.dragX,n=e.y-this.dragY;this.move(i/Screen.widthRatio(),n/Screen.heightRatio()),this.dragX=e.x,this.dragY=e.y}},GuiDiv.prototype.dragEnd=function(t){this.dragStarted&&(this.onBeforeDragEnd&&this.onBeforeDragEnd(t),this.onDragEnd&&this.onDragEnd(t),this.$().removeClass("dragged"),this.dragStarted=!1)},GuiDiv.prototype.setDragable=function(t){if(this.dragable=t,t){var e=this;this.$().bind(Device.event("cursorDown")+".dragEvents",function(t){e.dragBegin(t)})}else this.$().unbind(".dragEvents")},GuiDiv.prototype.setDragListener=function(t,e){this.dragSlot=t,t?(e&&(this.dragListenerPriority=e),DragManager.addListener(this)):(DragManager.removeListener(this),this.$().unbind(".dragEvents"))},GuiDiv.prototype.hideBackground=function(){this.jObject.css("background-image","none")},GuiDiv.prototype.showBackground=function(){var t=" ",e=" ",i=" ";$.each(this.backgrounds,function(n,a){if(a){if(a.url&&(t+="url('"+a.url+"'),"),a.frameX&&a.frameY){var o=Screen.calcRealSize(a.frameX,a.frameY);i+=o.x+"px "+o.y+"px,"}e+=a.repeat+","}}),t=t.substr(0,t.length-1),e=e.substr(0,e.length-1),i=i.substr(0,i.length-1),this.jObject.css("background-image",t),this.jObject.css("background-position",i),this.jObject.css("background-repeat",e)},GuiDiv.prototype.clampByParentViewport=function(t){0==t?(this.setViewport(null,null),this.resize()):this.setViewport(this.parent.viewRect,!0)},GuiDiv.prototype.setViewport=function(t,e){Screen.fixedSize||this.viewportDisable?this.viewport=null:(this.viewport=t,this.isParentsViewport=e,this.jObject&&this.viewport&&this.clampByViewport())},GuiDiv.prototype.disableViewport=function(){this.viewportDisable=!0,this.viewport=null},GuiDiv.prototype.globalOffset=function(){var t=this.jObject.offset();t=Screen.calcLogicSize(t.left,t.top);var e=this.viewRect&&this.viewRect.left?this.viewRect.left:0,i=this.viewRect&&this.viewRect.top?this.viewRect.top:0;return{x:t.x-e,y:t.y-i}},GuiDiv.prototype.clampByViewport=function(){if(this.isVisible()){var t=this.offsetX?this.offsetX:0,e=this.offsetY?this.offsetY:0,i=this.calcPercentageWidth(this.x)+t,n=this.calcPercentageHeight(this.y)+e,a={left:i,top:n,right:i+this.width,bottom:n+this.height},o=this.viewport,s=Math.max(a.left,o.left),r=Math.max(a.top,o.top),c=Math.min(a.right,o.right)-s,l=Math.min(a.bottom,o.bottom)-r;c<0||l<0?this.viewRect.isOutside||(this.jObject.hide(),this.viewRect.isOutside=!0):this.viewRect.isOutside&&(this.viewRect.isOutside=!1,this.isVisible()&&this.jObject.show());var u=s,h=r;this.isParentsViewport&&(u-=Math.max(o.left,0),h-=Math.max(o.top,0)),this.setRealPosition(u,h),this.setRealSize(c,l);var t=a.left-s,e=a.top-r;if(this.setRealBackgroundPosition(t,e),this.innerScene)return this.viewRect.left=o.left-i,this.viewRect.top=o.top-n,this.viewRect.right=o.right-i,this.viewRect.bottom=o.bottom-n,this.viewRect.width=o.width,void(this.viewRect.height=o.height);this.viewRect.left=s-i,this.viewRect.top=r-n,this.viewRect.right=this.viewRect.left+c,this.viewRect.bottom=this.viewRect.top+l,this.viewRect.width=c,this.viewRect.height=l,this.viewRect.offsetX=u,this.viewRect.offsetY=h;this.id;this.enhancedScene?" Enhanced":this.innerScene&&" Inner"}},GuiDiv.prototype.clampByViewportSimple=function(){if(this.isVisible()){var t,e,i=this.viewport,n=this.offsetX?this.offsetX:0,a=this.offsetY?this.offsetY:0,o=this.calcPercentageWidth(this.x)+n,s=this.calcPercentageHeight(this.y)+a,r={left:o,top:s,right:o+this.width,bottom:s+this.height},i=this.viewport;this.isParentsViewport&&(t=r.left-i.left,e=r.top-i.top),t+this.width<0||t>i.width||e+this.height<0||e>i.height?this.viewRect.isOutside||(this.jObject.hide(),this.viewRect.isOutside=!0):this.viewRect.isOutside&&(this.jObject.show(),this.viewRect.isOutside=!1),this.setRealPosition(t,e)}},GuiDiv.prototype.remove=function(){this.canvas&&this.canvas.remove(),GuiDiv.parent.remove.call(this),this.setDragListener(!1)},GuiDiv.prototype.setSize=function(t,e,i){if(null!=this.width){var n=this.backgrounds[i||0];if(n&&(n.frameX||n.frameY)){var a=t/this.width,o=e/this.height;n.width*=a,n.height*=o,n.frameX*=a,n.frameY*=o}}GuiDiv.parent.setSize.call(this,t,e)},GuiButton.inheritsFrom(GuiDiv),GuiButton.prototype.className="GuiButton",GuiButton.prototype.createInstance=function(t){var e=new GuiButton;return e.initialize(t),e},guiFactory.addClass(GuiButton),GuiButton.prototype.generate=function(t){var e="<div id='"+this.id+"' class='"+this.style+" unselectable'"+(this.divname?"name='"+this.divname+"'>":">");return e+="</div>"},GuiButton.prototype.initialize=function(t){this.divname=t.divname,GuiButton.parent.initialize.call(this,t),this.clampByViewport=GuiDiv.prototype.clampByViewportSimple,this.params=t;var e=this;this.label={hide:!1},!1===t.active?this.active=!1:this.active=!0;var i,n={},a=function(t){var a=GuiDiv.prototype.createInstance({parent:e,style:t.imageStyle?t.imageStyle:"buttonImage",width:e.width,height:e.height,x:t.x?t.x:"50%",y:t.y?t.y:"50%",background:t.background});e.children.addGui(a);var o=selectValue(t.width,n.width,e.width),s=selectValue(t.height,n.height,e.height);t.scale&&(o=Math.round(o*t.scale/100),s=Math.round(s*t.scale/100));var r=-Math.round(o/2),c=-Math.round(s/2);a.setOffset(r,c),t.background||(t.image=Resources.getImage(t.image),a.setBackground(t.image,o,s,0,0)),a.setSize(o,s),a.hide();var l;if(t.label){i=i||t.label;var u=1;"number"==typeof t.scale&&(u=t.scale/100),o=selectValue(t.label.width,i.width,e.width)*u,s=selectValue(t.label.height,i.height,e.height)*u,fontSize=selectValue(t.label.fontSize,i.fontSize)*u,r=selectValue(t.label.offsetX,i.offsetX,-Math.round(o/2)),c=selectValue(t.label.offsetY,i.offsetY,-Math.round(s/2)),o=Math.round(o),s=Math.round(s),l=guiFactory.createObject("GuiLabel",{parent:a,style:selectValue(t.label.style,i.style),width:o,height:s,cursor:"pointer",text:selectValue(t.label.text,i.text),fontSize:fontSize,align:selectValue(t.label.align,i.align,"center"),verticalAlign:selectValue(t.label.align,i.align,"middle"),x:selectValue(t.label.x,i.x,"50%"),y:selectValue(t.label.y,i.y,"50%"),offsetX:t.label.offsetX?r+t.label.offsetX:r,offsetY:t.label.offsetY?c+t.label.offsetY:c}),e.children.addGui(l),l.hide()}return{image:a,label:l,callback:function(){if(e.currentStateParams!==t){e.currentStateParams=t;var i=e.currentImage,n=e.currentLabel;e.currentImage=a,e.currentImage&&e.currentImage.show(),e.currentLabel=l,e.currentLabel&&!1===e.label.hide&&e.currentLabel.show(),n&&n.hide(),i&&i.hide()}}}};if(t.normal){n=t.normal;var o=a(t.normal);e.label.normal=o.label,e.imageNormal=o.image,e.normalState=function(){o.callback.call(e),e.clickAllowed=!1},e.normalState.call(e)}if(Device.isTouch()){if(t.hover){s=a(t.hover);e.label.hover=s.label,e.imageActive=s.image,e.activeState=s.callback}}else{if(t.hover){s=a(t.hover);e.label.hover=s.label,e.imageHover=s.image,e.hoverState=s.callback}if(t.active){var s=a(t.active);e.imageActive=s.image,e.label.active=s.label,e.activeState=s.callback}else t.hover&&(e.activeState=e.normalState)}if(t.passive){passiveParams=t.passive;var r=a(t.passive);e.label.passive=r.label,e.imagePassive=r.image,e.passiveState=function(){r.callback.call(e),e.clickAllowed=!1},e.active||e.passiveState.call(e)}},GuiButton.prototype.changeLabel=function(t){$.each(this.label,function(e,i){"hide"!=e&&i.change(t)})},GuiButton.prototype.hideLabel=function(){this.label.hide=!0,$.each(this.label,function(t,e){"hide"!=t&&e.hide()})},GuiButton.prototype.showLabel=function(){this.label.hide=!1,$.each(this.label,function(t,e){"hide"!=t&&e.show()})},GuiButton.prototype.bind=function(t){if(this.activeState){var e=this;this.backedToNormal=!1,this.clickAllowed=!1,this.unbind(),this.hoverState&&!Device.isTouch()&&(this.jObject.bind("mouseenter.guiElementEvents",function(){e.active&&e.hoverState()}),this.jObject.bind("mouseleave.guiElementEvents",function(){e.active?e.normalState():e.passiveState()})),t&&(this.pushFunction=t);var i=this.hoverState?this.hoverState:this.normalState,n=function(t){if(e.active&&e.isEnabled()){if(e.clickAllowed){if(e.pushFunction){t.currentTarget.getAttribute("name");e.pushFunction(t)}e.clickAllowed=!1}i.call(e)}};this.activeState&&(Device.isTouch()?(this.jObject.bind("touchstart",function(){e.active&&(e.activeState.call(e),e.clickAllowed=!0,e.backedToNormal=!1)}),this.jObject.bind("touchend",n),this.jObject.bind("touchmove",function(t){if(e.active&&!e.backedToNormal){t.preventDefault();var n=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];$(document.elementFromPoint(n.pageX,n.pageY));e.isPointInsideReal(n.pageX,n.pageY)||(i.call(e),e.backedToNormal=!0)}})):(this.jObject.bind("mousedown",function(){e.active&&(e.activeState.call(e),e.clickAllowed=!0)}),this.jObject.bind("mouseup",n))),this.jObject.css("cursor","pointer")}else GuiButton.parent.bind.call(this,t)},GuiButton.prototype.changeButtonBackgrounds=function(t,e){this.imageNormal&&this.imageNormal.setBackgroundFromParams(t,e),this.imageHover&&this.imageHover.setBackgroundFromParams(t,e),this.imageActive&&this.imageActive.setBackgroundFromParams(t,e),this.imagePassive&&this.imagePassive.setBackgroundFromParams(t,e)},GuiButton.prototype.setButtonBackgrounds=function(t){this.imageNormal&&this.imageNormal.setBackground(t),this.imageHover&&this.imageHover.setBackground(t),this.imageActive&&this.imageActive.setBackground(t),this.imagePassive&&this.imagePassive.setBackground(t)},GuiButton.prototype.highlight=function(t){this.params.highlight?t?(this.img=this.params.background.image,this.setBackground(Resources.getImage(this.params.highlight.image)),this.backgroundShown=t,this.showBackground()):(this.setBackground(this.img),this.showBackground()):(this.backgroundShown=t,this.backgroundShown?this.showBackground():this.hideBackground())},GuiButton.prototype.isActive=function(){return this.active},GuiButton.prototype.activate=function(t){this.params.passive&&(!1===t?(this.passiveState(),this.active=!1):(this.active=!0,this.normalState()))},GuiButton.prototype.resize=function(){GuiButton.parent.resize.call(this)},GuiLabel.inheritsFrom(GuiElement),GuiLabel.prototype.className="GuiLabel",GuiLabel.prototype.createInstance=function(t){var e=new GuiLabel;return e.initialize(t),e},guiFactory.addClass(GuiLabel),GuiLabel.prototype.initialize=function(t){this.divname=t.divname,GuiLabel.parent.initialize.call(this,t),this.fontSize=t.fontSize?t.fontSize:20,this.change(t.text),t.cursor&&(this.jObject.css("cursor",t.cursor),this.cursor=t.cursor),t.align&&this.align(t.align,t.verticalAlign),t.color&&this.setColor(t.color),this.setLineHeight(t.lineHeight?t.lineHeight:1)},GuiLabel.prototype.generate=function(t){this.id;return this.rowId=this.id+"_row",this.cellId=this.id+"_cell","<div id='"+this.id+"' class='"+this.style+" unselectable' style='cursor: default'><div id='"+this.rowId+"' style='display:table-row; '><div id='"+this.cellId+"'"+(this.divname?" name='"+this.divname+"'":"")+" style='display:table-cell;'>"+t+"</div></div></div>"},GuiLabel.prototype.create=function(t){GuiDiv.parent.create.call(this,t),$("#"+this.cellId).css("font-size",Math.floor(this.fontSize*Math.min(Screen.widthRatio(),Screen.heightRatio()))+"px")},GuiLabel.prototype.change=function(t,e){t=Resources.getString(t),$("#"+this.cellId).text(t),e&&(this.fontSize=e),$("#"+this.cellId).css("font-size",Math.floor(this.fontSize*Math.min(Screen.widthRatio(),Screen.heightRatio()))+"px")},GuiLabel.prototype.append=function(t){$("#"+this.cellId).append(t),this.resize()},GuiLabel.prototype.empty=function(){$("#"+this.cellId).empty(),this.resize()},GuiLabel.prototype.setPosition=function(t,e){GuiLabel.parent.setPosition.call(this,t,e)},GuiLabel.prototype.setRealSize=function(t,e){GuiLabel.parent.setRealSize.call(this,t,e);var i=Screen.calcRealSize(t,e);$("#"+this.rowId).css("width",i.x),$("#"+this.rowId).css("height",i.y),$("#"+this.cellId).css("width",i.x),$("#"+this.cellId).css("height",i.y),$("#"+this.cellId).css("font-size",Math.floor(this.fontSize*Math.min(Screen.widthRatio(),Screen.heightRatio()))+"px")},GuiLabel.prototype.resize=function(){GuiLabel.parent.resize.call(this)},GuiLabel.prototype.setColor=function(t){this.jObject.css("color",t)},GuiLabel.prototype.setLineHeight=function(t){this.jObject.css("line-height",t)},GuiLabel.prototype.align=function(t,e){t&&$("#"+this.cellId).css("text-align",t),e&&$("#"+this.cellId).css("vertical-align",e)},GuiScroll.inheritsFrom(GuiElement),GuiScroll.prototype.className="GuiScroll",GuiScroll.prototype.generate=function(t){return this.listId=this.id+"_list",this.scrollId=this.id+"_scroll",this.listId=this.scrollId,"<div id='"+this.id+"' class='"+this.style+" scrollerWrapper unselectable'><div id='"+this.scrollId+"' class='scrollerBackground'></div></div>"},GuiScroll.prototype.createInstance=function(t){var e=new GuiScroll(t.parent,t.style,t.width,t.height);return e.initialize(t),e},guiFactory.addClass(GuiScroll),GuiScroll.prototype.initialize=function(t){GuiScroll.parent.initialize.call(this,t),this.createScroll()},GuiScroll.prototype.createScroll=function(){var t=this;this.hScroll=null==this.params.hScroll||this.params.hScroll,this.vScroll=null==this.params.vScroll||this.params.vScroll,this.params.fixedHeight&&this.setFixedHeight(this.params.fixedHeight),this.scroll=new iScroll(this.id,{hScroll:this.hScroll,vScroll:this.vScroll,useTransform:!0,onBeforeScrollStart:function(t){for(var e=t.target;1!=e.nodeType;)e=e.parentNode;t.preventDefault()},onScrollStart:function(e){var i=e.target;for(t.candidateToClick=null;;)if(1==i.nodeType&&""!=i.id){var n=$("#"+i.id);if(n.length>0){var a=n.data("guiElement");if(a){if(a.listItemClickCallback){t.candidateToClick=a;break}if(a.listItemMouseDownCallback){a.listItemMouseDownCallback(e);break}}}if(!(i=i.parentNode)||i.id==t.listId||i.id==t.scrollId||i.id==t.id)break}else i=i.parentNode},onScrollMove:function(e){t.candidateToClick=null},onBeforeScrollEnd:function(){t.candidateToClick&&(t.candidateToClick.listItemClickCallback(),t.candidateToClick=null)}})},GuiScroll.prototype.refresh=function(t){this.scroll.scrollTo(0,0,0,!1),this.fixedHeight?this.scroll.refresh(this.fixedHeight*Screen.heightRatio()):this.scroll.refresh()},GuiScroll.prototype.addListItem=function(t){t.setParent("#"+this.listId),t.unbind(),this.children.addGui(t),this.resize()},GuiScroll.prototype.removeListItem=function(t){this.children.removeGui(t),this.resize()},GuiScroll.prototype.clearList=function(){$("#"+this.listId).empty(),this.children.clear()},GuiScroll.prototype.remove=function(){this.scroll&&(this.scroll.destroy(),delete this.scroll),GuiScroll.parent.remove.call(this)},GuiScroll.prototype.resizeScroll=function(){if(this.hScroll&&!this.vScroll){for(var t=0,e=0;e<this.children.guiEntities.length;e++)t+=this.children.guiEntities[e].$().outerWidth(!0);$("#"+this.listId).width(t)}},GuiScroll.prototype.setFixedHeight=function(t){this.fixedHeight=t},GuiScroll.prototype.resize=function(){GuiScroll.parent.resize.call(this),this.resizeScroll(),this.scroll&&this.refresh()},DOM_MODE=!0;GUISPRITE_HACK_ON=!1;GuiSprite.inheritsFrom(GuiDiv),GuiSprite.prototype.className="GuiSprite",GuiSprite.prototype.createInstance=function(t){var e=new GuiSprite;return e.initialize(t),e},guiFactory.addClass(GuiSprite),GuiSprite.prototype.initialize=function(t){GuiSprite.parent.initialize.call(this,t),this.clampByViewport=this.clampByViewportSimple,this.totalWidth=t.totalImageWidth,this.totalHeight=t.totalImageHeight,this.frameCallback=null,this.offsetY1=0,this.offsetX1=0,this.totalSrc=t.totalImage,GUISPRITE_HACK_ON&&(this.totalSrc=Resources.getImage(t.totalImage)),null==t.totalTile?this.totalTile={x:0,y:0}:this.totalTile=t.totalTile,this.flipped=null!=t.flipped&&t.flipped,this.setBackground(this.totalSrc),this.currentAnimation=null,this.spatialAnimation=null,this.animations=new Object;var e=this;t.spriteAnimations&&$.each(t.spriteAnimations,function(t,i){e.addSpriteAnimation(t,i)}),this.jObject.css("background-position",Math.floor(Screen.widthRatio()*this.totalTile.x*this.width)+"px "+Math.floor(Screen.heightRatio()*this.height*this.totalTile.y)+"px"),this.resize(),t.startAnimation&&(this.playAnimation(t.startAnimation.name,t.startAnimation.duration,t.startAnimation.loop),this.setStaticUpdate(!0)),this.frames={},t.frames&&(this.frames=t.frames)},GuiSprite.prototype.setStaticUpdate=function(t){!1===t?delete Account.instance.staticSprites[this.id]:Account.instance.staticSprites[this.id]=this},GuiSprite.prototype.addSpriteAnimation=function(t,e){this.animations[t]={frames:e.frames,row:e.row,frameDuration:e.frameDuration,spatial:e.spatial}},GuiSprite.prototype.addAnimation=function(t,e,i,n){this.animations[t]={frames:e,row:i,frameDuration:n}},GuiSprite.prototype.update=function(t){if(null!=this.currentAnimation||null!=this.spatialAnimation){var e=(new Date).getTime();for(t||(t=e-this.lastUpdateTime),this.lastUpdateTime=e,this.currentFrameTime+=t,null!==this.spatialAnimation&&this.updateSpatialAnimation(t);this.currentFrameTime>=this.currentFrameLength;){if(1==this.updateAnimation())return;this.currentFrameTime-=this.currentFrameLength}}},GuiSprite.prototype.updateSpatialAnimation=function(t){if(null!=this.spatialAnimation){var e=t/this.spatialAnimation.duration;this.spatialAnimation.timeLeft>t?this.move(this.spatialAnimation.dx*e,this.spatialAnimation.dy*e):(e=this.spatialAnimation.timeLeft/this.spatialAnimation.duration,this.move(this.spatialAnimation.dx*e,this.spatialAnimation.dy*e),this.spatialAnimation.callback&&this.spatialAnimation.callback(),this.spatialAnimation=null),this.spatialAnimation&&(this.spatialAnimation.timeLeft-=t),this.resize()}},GuiSprite.prototype.updateAnimation=function(){if(null!=this.currentAnimation){if(this.currentFrame>=this.animations[this.currentAnimation].frames.length&&(this.currentFrame=0,!this.looped))return this.stopAnimation(),!0;var t=Math.round(this.totalWidth/this.width),e=this.animations[this.currentAnimation].frames[this.currentFrame];if(this.frames[e]){var i=this.frames[e];this.jObject.css("background-position",Math.round(-Screen.widthRatio()*i.x+Screen.heightRatio()*this.offsetX1)+"px "+Math.round(-Screen.heightRatio()*i.y+Screen.heightRatio()*this.offsetY1)+"px ")}else{var n=e%t,a=(e-n)/t,o=this.animations[this.currentAnimation].row+a;e=n,this.jObject.css("background-position",Math.round(-Screen.widthRatio()*e*this.width+Screen.heightRatio()*this.offsetX1)+"px "+Math.round(-Screen.heightRatio()*o*this.height+Screen.heightRatio()*this.offsetY1)+"px "),this.frame=e,this.row=o}this.setRealBackgroundPosition(),null!=this.frameCallback&&this.frameCallback[this.currentAnimation]&&this.frameCallback[this.currentAnimation](this.currentFrame),this.currentFrame++}},GuiSprite.prototype.stopAnimation=function(t){if(this.jObject.stop(),clearInterval(this.updateAnimationCallback),this.updateAnimationCallback=null,this.currentAnimation=null,!t&&this.animationEndCallback){var e=this.animationEndCallback;this.animationEndCallback=null,e.call(this)}},GuiSprite.prototype.remove=function(){GuiSprite.parent.remove.call(this),clearInterval(this.updateAnimationCallback),this.updateAnimationCallback=null},GuiSprite.prototype.setFrameCallback=function(t){this.frameCallback=t},GuiSprite.prototype.setAnimationEndCallback=function(t){this.animationEndCallback=t},GuiSprite.prototype.playAnimation=function(t,e,i,n){var a=this.animations[t];assert(a,"No such animation: "+t),this.stopAnimation(!0),this.currentAnimation=t,this.lastAnimation=t;var o=this;this.currentFrame=0,this.currentFrameTime=0,this.lastUpdateTime=(new Date).getTime(),this.currentFrameLength=e?e/a.frames.length:this.animations[this.currentAnimation].frameDuration,this.looped=i,n&&(this.updateAnimationCallback=setInterval(function(){o.updateAnimation()},this.currentFrameLength)),this.updateAnimation()},GuiSprite.prototype.isPlayingAnimation=function(t){return this.currentAnimation==t},GuiSprite.prototype.animate=function(t,e){var i=this,n=0,a=0;t.x&&(n=t.x-this.x),t.y&&(a=t.y-this.y),this.spatialAnimation={dx:n,dy:a,duration:t.duration,timeLeft:t.duration},t.fade?this.fadeTo(0,t.duration-100,function(){i.spatialAnimation=null,e&&e()}):this.spatialAnimation.callback=e},GuiSprite.prototype.flip=function(t){this.flipped=t,this.transform()},GuiSprite.prototype.transform=function(t){t&&(null!=t.matrix&&(this.matrix=t.matrix),null!=t.angle&&(this.angle=t.angle),null!=t.scale&&(this.scale=t.scale),null!=t.translate&&(this.translate=t.translate));var e=selectValue(this.scale,1),i=e;i*=this.flipped?-1:1,cssTransform(this.jObject,this.matrix,this.angle,i,e,this.translate)},GuiSprite.prototype.rotate=function(t){this.angle=t,this.transform()},GuiSprite.prototype.setTransformOrigin=function(t){this.transformOrigin=t;var e=this.jObject;e.css("-webkit-transform-origin",t),e.css("transform-origin",t),e.css("-moz-transform-origin",t),e.css("-o-transform-origin",t),e.css("transform-origin",t),e.css("msTransform-origin",t)},GuiSprite.prototype.setPosition=function(t,e){this.x=t,this.y=e,this.viewport?this.clampByViewport():this.setRealPosition(t,e)},GuiSprite.prototype.setRealPosition=function(t,e){var i={translate:{x:Math.round(t*Screen.widthRatio()),y:Math.round(e*Screen.heightRatio())}};this.transform(i)},GuiSprite.prototype.setTransform=function(t,e){this.angle=e,this.matrix=t,this.transform()},GuiSprite.prototype.resize=function(){GuiSprite.parent.resize.call(this),this.setRealBackgroundPosition(this.offsetX1,this.offsetY1)},GuiSprite.prototype.setRealBackgroundPosition=function(t,e){e&&(this.offsetY1=e),t&&(this.offsetX1=t);var i=selectValue(this.frame,0),n=selectValue(this.row,0);this.jObject.css("background-position",Math.round(Screen.widthRatio()*(-i*this.width+t))+"px "+Math.round(Screen.heightRatio()*(n*this.height+e))+"px ")},GuiSprite.prototype.resizeBackground=function(){var t=Screen.calcRealSize(this.totalWidth,this.totalHeight);this.jObject.css("background-size",t.x+"px "+t.y+"px")},GuiSprite.prototype.recolor=function(t){var e=recolorImage(Resources.getAsset(this.params.totalImage),t);return this.setBackgroundFromParams({image:e},null),e},GuiSprite.prototype.recolorFullImage=function(t){var e=recolorFullImage(Resources.getAsset(this.params.totalImage),t);return this.setBackgroundFromParams({image:e},null),e},GuiScene.inheritsFrom(GuiDiv),GuiScene.prototype.className="GuiScene",GuiScene.prototype.createInstance=function(t){var e=new GuiScene(t.parent,t.style,t.width,t.height,t.canvas,null);return e.initialize(t),e},guiFactory.addClass(GuiScene),GuiDialog.inheritsFrom(GuiDiv),GuiDialog.prototype.className="GuiDialog",GuiDialog.prototype.maskDivSoul=null,GuiDialog.prototype.createInstance=function(t){var e=new GuiDialog(t.parent,t.style,t.width,t.height,null);return e.initialize(t),e},guiFactory.addClass(GuiDialog),GuiDialog.prototype.resize=function(){GuiDialog.parent.resize.call(this),this.children.resize()},GuiDialog.prototype.initialize=function(t){GuiDialog.parent.initialize.call(this,t),this.maskDiv=null,this.visible=!1;if(!GuiDialog.prototype.maskDivSoul){GuiDialog.prototype.maskDivSoul=guiFactory.createObject("GuiDiv",{parent:"#all",style:"mask",width:"100%",height:"100%",x:0,y:0});var e=GuiDialog.prototype.maskDivSoul.remove;GuiDialog.prototype.maskDivSoul.remove=function(){GuiDialog.prototype.maskDivSoul=null,e.call(this)}}this.maskDiv=GuiDialog.prototype.maskDivSoul,this.maskDiv.setBackground("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII="),this.maskDiv.bind(function(t){return t.preventDefault(),!1}),this.children.addGui(this.maskDiv),this.maskDiv.setZ(130),this.setZ(131),this.maskDiv.hide(),this.resize()},GuiDialog.prototype.init=function(){GuiDialog.parent.init.call(this)},GuiDialog.prototype.show=function(){GuiDialog.parent.show.call(this),this.maskDiv&&(this.maskDiv.resize(),this.maskDiv.show()),this.visible=!0},GuiDialog.prototype.hide=function(){GuiDialog.parent.hide.call(this),this.maskDiv&&this.maskDiv.hide(),this.visible=!1},GuiDialog.prototype.isVisible=function(){return this.visible};var _PIXIJS=!1;GuiCanvas.prototype.className="GuiCanvas",GuiCanvas.prototype.createInstance=function(t){var e=new GuiCanvas;return e.initialize(t),e},guiFactory.addClass(GuiCanvas),GuiCanvas.prototype.generateId=function(){return this.className+uniqueId()},GuiCanvas.prototype.create=function(t){var e=document.createElement("canvas");this.contex=e.getContext("2d"),this.contex.imageSmoothingEnabled=!1,this.contex.webkitImageSmoothingEnabled=!1,this.contex.mozImageSmoothingEnabled=!1,e.id=this.id,e.width=this.width,e.height=this.height,e.style.position="absolute",document.body.appendChild(e),this.jObject=$("#"+this.id),this.setAwake(!0),this.setParent(this.parent)||console.warn("No parent was provided for object id = "+this.id),assert(this.jObject.length>0,"Object id ='"+this.id+"' was not properly created")},GuiCanvas.prototype.initialize=function(t){if(this.params=t,this.parent=t.parent,this.id=this.generateId(),this.setSize(Screen.macro(t.width),Screen.macro(t.height),!0),this.setOffset(Screen.macro(t.offsetX),Screen.macro(t.offsetY)),this.setGuiOffset(Screen.macro(t.guiOffsetX),Screen.macro(t.guiOffsetY)),this.setPosition(Screen.macro(t.x),Screen.macro(t.y),!0),$("#"+this.id).length>0&&console.error(" GuiCanvas with  id = '"+this.id+"' is already exists."),this.children=new GuiContainer,this.children.init(),this.create(),this.terrainPattern=null,t.image){var e=Resources.getAsset(t.image);this.terrainPattern=this.contex.createPattern(e,"repeat")}this.jObject.data("GuiCanvas",this),"number"==typeof t.z&&this.setZ(t.z),t.hide?this.hide():this.show(),"number"==typeof t.opacity&&this.setOpacity(t.opacity),this.enabled=!0,this.resize(),Account.instance.addRenderEntity(this)},GuiCanvas.prototype.setOffset=function(t,e){this.offsetX=t,this.offsetY=e,this.baseDiv&&this.baseDiv.setOffset(t,e)},GuiCanvas.prototype.setGuiOffset=function(t,e){this.guiOffsetX=this.calcPercentageWidth(t||0),this.guiOffsetY=this.calcPercentageHeight(e||0),this.setAwake(!0)},GuiCanvas.prototype.calcPercentageWidth=function(t){if("string"==typeof t&&t.indexOf("%")>-1){var e=this.parent.jObject.width()/Screen.widthRatio();assert("number"==typeof e,"Wrong parent or value for % param name='"+this.name+"'"),t=parseFloat(t.replace("%",""))*e/100}return t},GuiCanvas.prototype.calcPercentageHeight=function(t){if("string"==typeof t&&t.indexOf("%")>-1){var e=this.parent.jObject.height()/Screen.heightRatio();assert("number"==typeof e,"Wrong parent or value for % param name='"+this.name+"'"),t=parseFloat(t.replace("%",""))*e/100}return t},GuiCanvas.prototype.setPosition=function(t,e,i){this.x=t,this.y=e,i?this.setAwake(!0):this.resize()},GuiCanvas.prototype.move=function(t,e){this.x+=t,this.y+=e,this.setPosition(this.x,this.y)},GuiCanvas.prototype.getRealPosition=function(){return{x:this.jObject.css("left").replace("px",""),y:this.jObject.css("top").replace("px","")}},GuiCanvas.prototype.getPosition=function(){return{x:this.x,y:this.y}},GuiCanvas.prototype.setZ=function(t){this.jObject.css("z-index",t),this.jObject.css("-webkit-transform","translateZ(0)"),this.z=t},GuiCanvas.prototype.show=function(){this.jObject.show(),this.visible=!0},GuiCanvas.prototype.hide=function(){this.jObject.hide(),this.visible=!1},GuiCanvas.prototype.setOpacity=function(t){this.jObject.css("opacity",t)},GuiCanvas.prototype.isEventIn=function(t){var e=Device.getPositionFromEvent(t),i=this.$().offset().left,n=i+this.$().width(),a=this.$().offset().top,o=a+this.$().height();return e.x>i&&e.x<n&&e.y>a&&e.y<o},GuiCanvas.prototype.addJqueryAnimation=function(t,e){this.jqueryAnimations=this.jqueryAnimations?this.jqueryAnimations:new Object,this.jqueryAnimations[t]=e},GuiCanvas.prototype.playJqueryAnimation=function(t,e){var i=this.jqueryAnimations[t];assert(i,"No animation found with name '"+t+"'"),this.stopJqueryAnimation();for(var n=null,a=this,o=function(t,e){t.setPosition(e.x||t.x,e.y||t.y),e.display&&("hide"===e.display?t.hide():"show"===e.display&&t.show())},s=0;s<i.length;s++){var r,c=i[s];if(r=c.animate){var l=new Object;$.each(r.actions,function(t,e){var i=e[0],n=e[1],a=e[2];"left"==i||"width"==i?a="number"==typeof a?Math.round(a*Screen.widthRatio()):a:"top"!=i&&"height"!=i||(a="number"==typeof a?Math.round(a*Screen.heightRatio()):a),l[i]=n+a.toString()}),a.$().animate(l,r.time)}else if(r=c.start){var u=null!=r.x?r.x:a.x,h=null!=r.y?r.y:a.y;a.setPosition(u,h),o(a,r)}else(r=c.final)&&(n=function(){var t=null!=r.x?r.x:a.x,e=null!=r.y?r.y:a.y;a.setPosition(t,e),o(a,r)})}this.jqueryAnimationCallback=function(){n&&n(),e&&e()},this.$().queue("fx",function(){a.jqueryAnimationCallback(),a.jqueryAnimationCallback=null,a.jObject.stop(!0)})},GuiCanvas.prototype.stopJqueryAnimation=function(){this.$().is(":animated")&&(this.$().stop(!0),this.jqueryAnimationCallback&&(this.jqueryAnimationCallback(),this.jqueryAnimationCallback=null))},GuiCanvas.prototype.isVisible=function(){return this.visible},GuiCanvas.prototype.setSize=function(t,e,i){this.width=t,this.height=e,i?this.setAwake(!0):this.resize()},GuiCanvas.prototype.setRealSize=function(t,e){var i=Screen.calcRealSize(t,e);this.contex.canvas.width=i.x,this.contex.canvas.height=i.y,this.setAwake(!0)},GuiCanvas.prototype.setRealPosition=function(t,e){var i=Screen.calcRealSize(t,e);this.jObject.css("left",i.x),this.jObject.css("top",i.y),this.setAwake(!0)},GuiCanvas.prototype.resize=function(){w=this.calcPercentageWidth(this.width),h=this.calcPercentageHeight(this.height),this.setRealSize(w,h);var t=0,e=0;"number"==typeof this.offsetX&&(t=this.offsetX),null!=this.offsetY&&(e=this.offsetY),x=this.calcPercentageWidth(this.x),y=this.calcPercentageHeight(this.y),this.setRealPosition(x+t,y+e),this.baseDiv&&(this.baseDiv.setSize(this.width,this.height),this.baseDiv.setPosition(this.x,this.y),this.baseDiv.resize()),this.children.resize(),this.setAwake(!0)},GuiCanvas.prototype.disableResize=function(t){null==this.originalResize&&(this.originalResize=this.resize),this.resize=0==t?this.originalResize:function(){}},GuiCanvas.prototype.globalOffset=function(){var t=this.jObject.offset();return t=Screen.calcLogicSize(t.left,t.top),{x:t.x,y:t.y}},GuiCanvas.prototype.setParent=function(t,e){var i=null,n=null;if("string"==typeof t?n=$(t):t&&"object"==typeof t&&(t.jquery?n=t:t.jObject&&t.jObject.length>0&&(i=t)),n&&(assert(n.length>0,"Object id ='"+this.id+"' has wrong parent: '"+t+"'"),(i=n.data("GuiCanvas"))||(i=guiFactory.createObject("GuiCanvas",{jObject:n}))),i){var a=this.parent;if(this.parent=i,a&&e){var o,s;o=a.globalOffset(),s=i.globalOffset();var r=o.x-s.x,c=o.y-s.y;this.move(r,c)}return this.jObject&&this.jObject.appendTo(i.jObject),!0}return console.error("Can't attach object '"+this.id+"' to parent that doesn't exists '"+t+"'"),!1},GuiCanvas.prototype.remove=function(){Account.instance.removeRenderEntity(this),Account.instance.removeScheduledEntity(this),this.tooltip&&this.tooltip.remove(),this.children.remove(),this.jObject.remove()},GuiCanvas.prototype.detach=function(){this.jObject.detach()},GuiCanvas.prototype.addGui=function(t,e){this.children.addGui(t,e),this.setAwake(!0)},GuiCanvas.prototype.removeGui=function(t){this.children.removeGui(t),this.setAwake(!0)},GuiCanvas.prototype.getGui=function(t){return this.children.getGui(t)},GuiCanvas.prototype.enableTouchEvents=function(t){Device.isTouch()?(document.body.ontouchstart=function(t){return t.preventDefault(),touchStartX=touchEndX=t.touches[0].pageX,touchStartY=touchEndY=t.touches[0].pageY,!1},document.body.ontouchmove=function(t){return t.preventDefault(),touchEndX=t.touches[0].pageX,touchEndY=t.touches[0].pageY,!1},document.body.ontouchend=function(e){if(e.preventDefault(),touchEndX&&touchEndY){var i={};i.pageX=touchEndX,i.pageY=touchEndY,t(i)}return!1}):this.jObject.bind("mousedown",t)},GuiCanvas.prototype.isPointInsideReal=function(t,e){var i=this.jObject.offset(),n=this.jObject.width(),a=this.jObject.height();return t>i.left&&t<i.left+n&&e>i.top&&e<i.top+a},GuiCanvas.prototype.getEventPosition=function(t){var e=Device.getPositionFromEvent(t),i=this.jObject.offset(),n={};n.x=e.x-i.left,n.y=e.y-i.top;return Screen.calcLogicSize(n.x,n.y)},GuiCanvas.prototype.update=function(){},GuiCanvas.prototype.isEnabled=function(){return this.enabled},GuiCanvas.prototype.setAwake=function(t){var e=this;this.awake=!0,this.awakeTimeout&&clearTimeout(this.awakeTimeout),this.awakeTimeout=setTimeout(function(){e.awake=!1},500)},GuiCanvas.prototype.render=function(){if(this.awake){var t=this.width*Screen.widthRatio(),e=this.height*Screen.heightRatio();this.terrainPattern?(this.contex.fillStyle=this.terrainPattern,this.contex.fillRect(0,0,t,e)):this.contex.clearRect(0,0,t,e),this.children.render(this.contex)}},DOM_MODE=!1,GuiCSprite.prototype.className="GuiCSprite",GuiCSprite.prototype.createInstance=function(t){var e=new GuiCSprite;return e.initialize(t),e},guiFactory.addClass(GuiCSprite),GuiCSprite.prototype.initialize=function(t){var e=this;this.params=t,this.x=this.calcPercentageWidth(t.x||0),this.y=this.calcPercentageHeight(t.y||0),this.z=t.z||0,this.opacity=t.opacity?t.opacity:1,this.width=t.width,this.height=t.height,this.parent=t.parent.canvas?t.parent.canvas:t.parent,this.id=this.parent.generateId.call(this),this.total={image:t.totalImage,width:t.totalImageWidth,height:t.totalImageHeight,tile:t.totalTile},this.setOffset(t.offsetX,t.offsetY),this.setTransformOrigin(t.transformOrigin),this.img=Resources.getImageAsset(this.total.image,function(t){(function(t){e.imageHeight=Math.round(e.height*t.height/e.total.height),e.imageWidth=Math.round(e.width*t.width/e.total.width),e.scale={x:Math.round(e.width/e.imageWidth*100)/100,y:Math.round(e.height/e.imageHeight*100)/100},e.backgroundPosition={x:0,y:0},e.backgroundSize={w:e.total.width,h:e.total.height},e.rotate(0),e.resizeBackground(),e.params.hide||e.show(),e.setEnabled(!0),Account.instance.addScheduledEntity(e)}).call(e,t)}),e.imageHeight=Math.round(e.height*e.img.height/e.total.height),e.imageWidth=Math.round(e.width*e.img.width/e.total.width),e.scale={x:Math.round(e.width/e.imageWidth*100)/100,y:Math.round(e.height/e.imageHeight*100)/100},this.backgroundPosition={x:0,y:0},this.backgroundSize={w:this.total.width,h:this.total.height},this.currentAnimation=null,this.spatialAnimation=null,this.animations=new Object,t.spriteAnimations&&$.each(t.spriteAnimations,function(t,i){e.addSpriteAnimation(t,i)}),this.frames={},t.frames&&(this.frames=t.frames),this.parent.canvas?this.parent.canvas.addGui(this):this.parent.addGui(this)},GuiCSprite.prototype.addSpriteAnimation=function(t,e){this.animations[t]={frames:e.frames,row:e.row,frameDuration:e.frameDuration,spatial:e.spatial}},GuiCSprite.prototype.addAnimation=function(t,e,i,n){this.animations[t]={frames:e,row:i,frameDuration:n}},GuiCSprite.prototype.isEnabled=function(){return this.enabled},GuiCSprite.prototype.setEnabled=function(t){this.enabled=!!t},GuiCSprite.prototype.updateSpatialAnimation=function(t){if(null!=this.spatialAnimation){var e=t/this.spatialAnimation.duration;this.spatialAnimation.timeLeft>t?this.move(this.spatialAnimation.dx*e,this.spatialAnimation.dy*e):(e=this.spatialAnimation.timeLeft/this.spatialAnimation.duration,this.move(this.spatialAnimation.dx*e,this.spatialAnimation.dy*e),this.spatialAnimation.callback&&this.spatialAnimation.callback(),this.spatialAnimation=null),this.spatialAnimation&&(this.spatialAnimation.timeLeft-=t)}},GuiCSprite.prototype.updateAnimation=function(){if(null!=this.currentAnimation){if(this.currentFrame>=this.animations[this.currentAnimation].frames.length&&(this.currentFrame=0,!this.looped))return this.stopAnimation(),!0;var t=Math.round(this.total.width/this.width),e=this.animations[this.currentAnimation].frames[this.currentFrame];if(this.frames[e]){var i=this.frames[e];this.changeBackgroundPosition(i.x,i.y)}else{var n=e%t,a=(e-n)/t,o=this.animations[this.currentAnimation].row+a;e=n,this.changeBackgroundPosition(e,o),this.frame=e,this.row=o}null!=this.frameCallback&&this.frameCallback[this.currentAnimation]&&this.frameCallback[this.currentAnimation](this.currentFrame),this.currentFrame++}},GuiCSprite.prototype.move=function(t,e){this.x+=t,this.y+=e,this.parent.setAwake(!0)},GuiCSprite.prototype.stopAnimation=function(t){if(clearInterval(this.updateAnimationCallback),this.updateAnimationCallback=null,this.currentAnimation=null,!t&&this.animationEndCallback){var e=this.animationEndCallback;this.animationEndCallback=null,e.call(this)}},GuiCSprite.prototype.changeBackgroundPosition=function(t,e){this.backgroundPosition.x=t,this.backgroundPosition.y=e,this.parent.setAwake(!0)},GuiCSprite.prototype.setFrameCallback=function(t){this.frameCallback=t},GuiCSprite.prototype.setAnimationEndCallback=function(t){this.animationEndCallback=t},GuiCSprite.prototype.playAnimation=function(t,e,i,n){var a=this.animations[t];assert(a,"No such animation: "+t),this.stopAnimation(!0),this.currentAnimation=t,this.lastAnimation=t;var o=this;this.currentFrame=0,this.currentFrameTime=0,this.lastUpdateTime=(new Date).getTime(),this.currentFrameLength=e?e/a.frames.length:this.animations[this.currentAnimation].frameDuration,this.looped=i,n&&(this.updateAnimationCallback=setInterval(function(){o.updateAnimation()},this.currentFrameLength)),this.updateAnimation()},GuiCSprite.prototype.isPlayingAnimation=function(t){return this.currentAnimation==t},GuiCSprite.prototype.flip=function(t){this.flipped=t,this.parent.setAwake(!0)},GuiCSprite.prototype.transform=function(t){t&&(null!=t.matrix&&(this.matrix=t.matrix),null!=t.angle&&(this.angle=t.angle),null!=t.scale&&(this.scale=t.scale),null!=t.translate&&(this.translate=t.translate));selectValue(this.scale,1);this.flipped,this.parent.setAwake(!0)},GuiCSprite.prototype.rotate=function(t){this.angle=t,this.parent.setAwake(!0)},GuiCSprite.prototype.setTransformOrigin=function(t){this.transformOrigin={x:t&&!isNaN(t.x)?Math.round(100*t.x)/100:.5,y:t&&!isNaN(t.x)?Math.round(100*t.y)/100:.5},this.parent.setAwake(!0)},GuiCSprite.prototype.setPosition=function(t,e){this.x=this.calcPercentageWidth(t),this.y=this.calcPercentageHeight(e),this.parent.setAwake(!0)},GuiCSprite.prototype.setOffset=function(t,e){this.offsetX=this.calcPercentageWidth(t||0),this.offsetY=this.calcPercentageHeight(e||0),this.parent.setAwake(!0)},GuiCSprite.prototype.setRealPosition=function(t,e){},GuiCSprite.prototype.setTransform=function(t){this.matrix=t},GuiCSprite.prototype.resize=function(){},GuiCSprite.prototype.setRealBackgroundPosition=function(t,e){e&&(this.offsetY1=e),t&&(this.offsetX1=t);var i=selectValue(this.frame,0),n=selectValue(this.row,0);this.changeBackgroundPosition(-i,n),this.parent.setAwake(!0)},GuiCSprite.prototype.resizeBackground=function(){},GuiCSprite.prototype.calcPercentageWidth=function(t){if("string"==typeof t&&t.indexOf("%")>-1){var e=this.parent.jObject.width()/Screen.widthRatio();assert("number"==typeof e,"Wrong parent or value for % param name='"+this.name+"'"),t=parseFloat(t.replace("%",""))*e/100}return t},GuiCSprite.prototype.calcPercentageHeight=function(t){if("string"==typeof t&&t.indexOf("%")>-1){var e=this.parent.jObject.height()/Screen.heightRatio();assert("number"==typeof e,"Wrong parent or value for % param name='"+this.name+"'"),t=parseFloat(t.replace("%",""))*e/100}return t},GuiCSprite.prototype.setZ=function(t){},GuiCSprite.prototype.remove=function(){Account.instance.removeScheduledEntity(this)},GuiCSprite.prototype.hide=function(){this.visible=!1,this.parent.setAwake(!0)},GuiCSprite.prototype.show=function(){this.visible=!0,this.parent.setAwake(!0)},GuiCSprite.prototype.clampByParentViewport=function(){},GuiCSprite.prototype.fadeTo=function(t,e,i,n){var a={};a.start=this.opacity,a.end=t>0?t<1?t:1:0,a.dO=a.end-a.start,a.time=e>0?e:500,a.speed=Math.abs(a.dO/a.time),a.callback=i,a.changeVisibility=n,a.norm=a.dO/Math.abs(a.dO),this.fadeAnimation=a,this.fading=!0},GuiCSprite.prototype.fade=function(t){var e=this.fadeAnimation.speed*t*this.fadeAnimation.norm,i=this.opacity+e;(this.fadeAnimation.end-i)*this.fadeAnimation.norm/Math.abs(this.fadeAnimation.norm)>0?this.setOpacity(i):(this.fading=!1,this.setOpacity(this.fadeAnimation.end),this.fadeAnimation.callback&&this.fadeAnimation.callback(),this.fadeAnimation.changeVisibility&&this.hide())},GuiCSprite.prototype.update=function(t){this.fading&&this.fade(t)},GuiCSprite.prototype.setOpacity=function(t){(t>=0||t<=1)&&(this.opacity=t)},GuiCSprite.prototype.convertToPixi=function(){_PIXIJS&&(this.pixiSprite.alpha=this.opacity,this.pixiSprite.visible=this.visible,this.pixiSprite.x=Math.round((this.x+this.parent.guiOffsetX+this.offsetX)*Screen.widthRatio()),this.pixiSprite.y=Math.round((this.y+this.parent.guiOffsetY+this.offsetY)*Screen.heightRatio()),this.pixiSprite.rotation=MathUtils.toRad(Math.round(this.angle)),this.pixiSprite.width=this.width,this.pixiSprite.height=this.height,this.pixiSprite.tilePosition=new PIXI.Point(this.transformOrigin.x,this.transformOrigin.y),this.pixiSprite.scale=new PIXI.Point(Screen.widthRatio()*this.scale.x,Screen.heightRatio()*this.scale.y),this.pixiSprite.tilePosition=new PIXI.Point(this.backgroundPosition.x*this.width,this.backgroundPosition.y*this.height))},GuiCSprite.prototype.render=function(t){if(this.visible){var e={x:Screen.widthRatio(),y:Screen.heightRatio()},i=Math.round((this.x+this.parent.guiOffsetX+this.offsetX)*e.x),n=Math.round((this.y+this.parent.guiOffsetY+this.offsetY)*e.y),a=Math.ceil(this.width*e.x),o=Math.ceil(this.height*e.y),s=Math.ceil(this.backgroundPosition.x*this.imageWidth),r=Math.ceil(this.backgroundPosition.y*this.imageHeight),c={x:this.transformOrigin.x,y:this.transformOrigin.y},l={x:Math.round(i+a*c.x),y:Math.round(n+o*c.y)},u=MathUtils.toRad(Math.round(this.angle));u=1*u.toFixed(3),t.translate(l.x,l.y),t.rotate(u),t.globalAlpha=this.opacity;var h=Math.ceil(this.imageWidth),p=Math.ceil(this.imageHeight),d=-Math.ceil(a*c.x),m=-Math.ceil(o*c.y);s+h<=this.img.width&&r+p<=this.img.height?t.drawImage(this.img,s,r,h,p,d,m,a,o):console.warn("Shit is happining. Again. Source rect is out of image bounds")}};var SCORE=null,GUI_SPRITE_IMAGES_FROM_RESOURCES=!0,GUISPRITE_HACK_ON=!0;window.attachEvent?window.attachEvent("onload",startTheGame):window.addEventListener("load",startTheGame,!0),CannonsAndSoldiersAccount.inheritsFrom(Account),CannonsAndSoldiersAccount.prototype.className="CannonsAndSoldiersAccount",CannonsAndSoldiersAccount.prototype.init=function(){CannonsAndSoldiersAccount.parent.init.call(this,{backgroundState:{background:{image:"images/bg.jpg"},transparent:!0}});var t=new Country("Spain","ESP",ColorRgb.Colors.RED,ColorRgb.Colors.BLUE),e=new Country("Germany","DEU",ColorRgb.Colors.WHITE,ColorRgb.Colors.BLACK),i=new Country("Portugal","PRT",ColorRgb.Colors.RED,ColorRgb.Colors.RED),n=new Country("Colombia","COL",ColorRgb.Colors.YELLOW,ColorRgb.Colors.WHITE),a=new Country("Uruguay","URY",new ColorRgb(135,206,250),ColorRgb.Colors.BLACK),o=new Country("Argentina","ARG",new ColorRgb(175,238,238),ColorRgb.Colors.BLACK),s=new Country("Brazil","BRA",ColorRgb.Colors.YELLOW,ColorRgb.Colors.BLUE),r=new Country("Switzerland","CHE",ColorRgb.Colors.RED,ColorRgb.Colors.WHITE),c=new Country("Italy","ITA",ColorRgb.Colors.BLUE,ColorRgb.Colors.WHITE),l=new Country("Greece","GRC",ColorRgb.Colors.BLUE,ColorRgb.Colors.BLUE),u=new Country("England","ENG",ColorRgb.Colors.WHITE,ColorRgb.Colors.WHITE);this.countries=[t,e,i,s,n,a,o,r,c,l,u,new Country("Belgium","BEL",ColorRgb.Colors.RED,ColorRgb.Colors.GRAY),new Country("Chile","CHL",ColorRgb.Colors.WHITE,ColorRgb.Colors.GRAY),new Country("USA","USA",ColorRgb.Colors.BLUE,ColorRgb.Colors.BLUE),new Country("Netherlands","NLD",new ColorRgb(255,140,0),new ColorRgb(255,140,0)),new Country("France","FRA",ColorRgb.Colors.BLUE,ColorRgb.Colors.WHITE),new Country("Ukraine","UKR",ColorRgb.Colors.YELLOW,ColorRgb.Colors.YELLOW),new Country("Russia","RUS",ColorRgb.Colors.RED,ColorRgb.Colors.RED),new Country("Mexico","MEX",ColorRgb.Colors.GREEN,ColorRgb.Colors.WHITE),new Country("Croatia","HRV",ColorRgb.Colors.RED,ColorRgb.Colors.WHITE),new Country("Cote","CIV",new ColorRgb(255,140,0),new ColorRgb(255,140,0)),new Country("Scotland","SCO",ColorRgb.Colors.BLUE,ColorRgb.Colors.WHITE),new Country("Denmark","DNK",ColorRgb.Colors.RED,ColorRgb.Colors.WHITE),new Country("Egypt","EGY",ColorRgb.Colors.WHITE,ColorRgb.Colors.WHITE),new Country("Bosn. & Herz.","BIH",ColorRgb.Colors.BLUE,ColorRgb.Colors.WHITE),new Country("Sweden","SWE",ColorRgb.Colors.YELLOW,ColorRgb.Colors.BLUE),new Country("Algeria","DZA",new ColorRgb(0,255,127),new ColorRgb(0,255,127)),new Country("Ecuador","ECU",ColorRgb.Colors.YELLOW,ColorRgb.Colors.BLUE),new Country("Slovenia","SVN",ColorRgb.Colors.WHITE,ColorRgb.Colors.WHITE),new Country("Serbia","SRB",ColorRgb.Colors.RED,ColorRgb.Colors.BLUE),new Country("Honduras","HND",ColorRgb.Colors.WHITE,ColorRgb.Colors.WHITE),new Country("Romania","ROM",ColorRgb.Colors.YELLOW,ColorRgb.Colors.YELLOW),new Country("Armenia","ARM",ColorRgb.Colors.RED,ColorRgb.Colors.RED),new Country("Costa Rica","CRI",ColorRgb.Colors.RED,ColorRgb.Colors.NAVY),new Country("Panama","PAN",ColorRgb.Colors.RED,ColorRgb.Colors.RED),new Country("Czech Republic","CZE",ColorRgb.Colors.RED,ColorRgb.Colors.WHITE),new Country("Iran","IRN",ColorRgb.Colors.WHITE,ColorRgb.Colors.WHITE),new Country("Ghana","GHA",ColorRgb.Colors.WHITE,ColorRgb.Colors.WHITE),new Country("Australia","AUS",ColorRgb.Colors.YELLOW,ColorRgb.Colors.GREEN),new Country("Cameroon","CMR",ColorRgb.Colors.GREEN,ColorRgb.Colors.RED),new Country("Japan","JPN",ColorRgb.Colors.NAVY,ColorRgb.Colors.NAVY),new Country("Nigeria","NGA",new ColorRgb(0,255,127),new ColorRgb(0,255,127)),new Country("South Korea","KOR",ColorRgb.Colors.WHITE,ColorRgb.Colors.WHITE),new Country("China","CHN",ColorRgb.Colors.RED,ColorRgb.Colors.RED)],this.topCountries=[t,e,i,n,a,o,s,r,c,l,u],this.currentFlag=Device.getStorageItem("Flag",-1),this.usedFlags=JSON.parse(Device.getStorageItem("usedFlags","[]")),this.states=new Object,this.states.MenuState01={MenuState01:{class:MenuState.prototype.className,parent:"Account01",children:{}}},this.states.LevelMenuState01={LevelMenuState01:{class:LevelMenuState.prototype.className,parent:"Account01",children:{}}},this.states.CountrySelectMenuState01={CountrySelectMenuState01:{class:CountrySelectMenuState.prototype.className,parent:"Account01",children:{}}},this.states.GameState01={GameState01:{class:GameState.prototype.className,parent:"Account01",scene:"Scene01",children:{}}},Account.instance=this;var h=guiFactory.createObject("GuiDiv",{parent:this.backgroundState.mask,background:{image:"images/icon114x114alpha.png"},style:"dialog",width:114,height:114,x:"50%",y:"50%",offsetY:-70,offsetX:-57,hide:!0}),p=guiFactory.createObject("GuiLabel",{parent:this.backgroundState.mask,style:"gameButton bowl-white",text:Resources.getString("loading")+"...",fontSize:35,y:"50%",x:"50%",width:500,height:50,offsetX:-250,offsetY:90,align:"center",hide:!0});this.backgroundState.addGui(h),this.backgroundState.addGui(p),this.backgroundState.textLogo=p,this.turnOnMaskLogo=function(t){t?(h.show(),p.show()):(h.hide(),p.hide())}},CannonsAndSoldiersAccount.prototype.switchState=function(t,e,i,n,a){var o=this,s=function(){var n=new Object;$.each(Account.instance.states,function(a,s){a===t&&((n=Account.instance.states[a])[a].parent=i,n[e]={destroy:!0},o.readGlobalUpdate(n))})};a&&a.hide&&a.fadeTo(0,LEVEL_FADE_TIME,function(){a.hide()}),n?s():this.backgroundState.fadeIn(LEVEL_FADE_TIME,"#0d5600",s)},Country.prototype.getShortName=function(){return null!=this.shortName?this.shortName:this.name.substr(0,3)};var LVL_MENU_GUI_JSON="resources/ui/LevelMenu.json",LEVEL_DESCRIPTION="resources/levels/",LEVEL_ORDER="resources/levelOrder.json",REPLY=!1,LVL_INDEX=0,LAST_LEVEL=33,LAST_UNLOCKED=0;LevelMenuState.inheritsFrom(BaseState),LevelMenuState.prototype.className="LevelMenuState",LevelMenuState.prototype.createInstance=function(t){var e=new LevelMenuState;return e.activate(t),e},entityFactory.addClass(LevelMenuState),LevelMenuState.prototype.jsonPreloadComplete=function(){LevelMenuState.parent.jsonPreloadComplete.call(this)},LevelMenuState.prototype.init=function(t){function e(){var t=Math.floor(Math.random()*Account.instance.countries.length);return t==Account.instance.currentFlag||-1!=Account.instance.usedFlags.indexOf(t)||-1!=Account.instance.topCountries.indexOf(Account.instance.countries[t])?-1:(Account.instance.usedFlags.push(t),t)}function i(){var t=Math.floor(Math.random()*Account.instance.topCountries.length);return(t=Account.instance.countries.indexOf(Account.instance.topCountries[t]))==Account.instance.currentFlag||-1!=Account.instance.usedFlags.indexOf(t)?-1:(Account.instance.usedFlags.push(t),t)}function n(t,e,i){var n=guiFactory.createObject("GuiDiv",{parent:u,background:{image:"FinalArt/Menu/LevelSelect/LevelBase_A.png"},style:"gameButton",width:562,height:60,x:t,y:e});return s.getGui("menuContainer").addGui(n,i),n}function a(t){var e=Account.instance.countries[Account.instance.usedFlags[l]],i=c.frames[e.name+".png"].frame,n=guiFactory.createObject("GuiDiv",{parent:t,background:{image:"FinalArt/"+c.meta.image,width:c.meta.size.w,height:c.meta.size.h,frameX:-i.x,frameY:-i.y},style:"gameButton",width:i.w,height:i.h,x:45,y:12});t.addGui(n,p.length);var a=guiFactory.createObject("GuiLabel",{parent:t,style:"gameButton bowl-normal",width:100,height:40,x:102,y:19,text:e.getShortName(),fontSize:24});t.addGui(a,"label"+p.length),p.push(n),l++}function o(t,e){var i;if(SCORE["level_"+(h.length-1)]>0||0==h.length){if(!SCORE["level_"+h.length]){var n=guiFactory.createObject("GuiDiv",{parent:e,style:"gameButton",background:{image:"FinalArt/Menu/LevelSelect/LastLevel.png"},width:86,height:65,x:t-7,y:-2});e.addGui(n)}i=guiFactory.createObject("GuiButton",{parent:e,normal:{label:{style:"gameButton bowl-white-unboredered",text:h.length+1,fontSize:24,y:"55%",x:"45%"}},hover:{scale:115,label:{style:"gameButton bowl-white-unboredered",text:h.length+1,fontSize:30,color:"#01B5FF",z:12}},style:"gameButton",width:70,height:70,x:t,y:-8,unlocked:!0});for(var a=SCORE["level_"+h.length+"Stars"],o=0;o<3;o++){var r=guiFactory.createObject("GuiDiv",{parent:i,background:{image:"FinalArt/Menu/LevelSelect/"+(o<a?"TwinkleFull.png":"TwinkleEmpty.png")},style:"gameButton",width:21,height:21,x:60,y:20*o+7});i.addGui(r,o)}}else i=guiFactory.createObject("GuiButton",{parent:e,normal:{image:"FinalArt/Lock.png"},hover:{image:"FinalArt/Lock.png",scale:115},style:"gameButton",width:26,height:34,x:t+21,y:12,unlocked:!1});s.getGui("menuContainer").addGui(i,h.length),i.bind(function(t){i.params.unlocked&&(LVL_INDEX=h.indexOf(i),LEVEL_DESCRIPTION="resources/levels/"+Account.instance.levelOrder[LVL_INDEX+1],Sound.playWithVolume("click"),s.goToGameState())}),h.push(i)}LevelMenuState.parent.init.call(this,t);var s=this;if(this.sliding=!1,REPLY)this.goToGameState();else{guiFactory.createGuiFromJson(this.resources.json[LVL_MENU_GUI_JSON],this);var r=this.resources.json[LEVEL_ORDER];Account.instance.levelOrder=r;var c=Account.instance.countriesSheet,l=0,u=this.getGui("slideContainer");u.setZ(-1);var h=[],p=[];!function(){if(0===Account.instance.usedFlags.length)for(var t=0;t<12;t++){var n=-1;if(t>7)do{n=i()}while(-1==n);else do{n=e()}while(-1==n)}Device.setStorageItem("usedFlags",JSON.stringify(Account.instance.usedFlags))}();for(var d=118,m=76,g=0;g<5;g++){a(y=n(d,m+72*g,g));for(f=0;f<4;f++)o(d+96+91*f,y)}d+=1e3,m=150;for(g=0;g<3;g++){a(y=n(d,m+72*g,g));for(f=0;f<2;f++)o(d-1e3+96+2*f*91,y)}d+=1e3,m=150;for(g=0;g<3;g++){a(y=n(d,m+72*g,g));for(f=0;f<2;f++)o(d-2e3+96+2*f*91,y)}var y=n(d+=1e3,m=221,g);a(y);for(var f=0;f<2;f++)o(d-3e3+96+2*f*91,y);this.bindButtons();var v=0;$.each(SCORE,function(t,e){v+=1*e}),-1===Account.instance.currentFlag&&(Account.instance.currentFlag=5);var c=Account.instance.countriesSheet,S=Account.instance.countries[Account.instance.currentFlag],b=c.frames[S.name+".png"].frame,E=this.getGui("menuContainer"),A=guiFactory.createObject("GuiButton",{parent:E,normal:{image:"FinalArt/Menu/Button.png",label:{style:"gameButton bowl-normal",text:S.getShortName(),fontSize:28,x:"66%",y:"48%"}},hover:{image:"FinalArt/Menu/Button.png",scale:115,label:{style:"gameButton bowl-normal",text:S.getShortName(),fontSize:28,x:"66%",y:"48%"}},style:"gameButton",width:162,height:60,x:330,y:420});E.addGui(A),A.bind(function(t){Sound.playWithVolume("click"),s.switchState("CountrySelectMenuState01",s.id,s.parent.id,!1)});var w=guiFactory.createObject("GuiDiv",{parent:A,background:{image:"FinalArt/"+c.meta.image,width:c.meta.size.w,height:c.meta.size.h,frameX:-b.x,frameY:-b.y},style:"gameButton",width:b.w,height:b.h,x:22,y:12});A.addGui(w),A.resize(),LAST_UNLOCKED=function(){for(var t=0,e=0;e<h.length-1;e++){if(!(SCORE["level_"+e]>0))return t;t=e+1}return t}(),this.initSlideContainer(),this.checkSlideBtns(),this.resize(),Loader.loadingMessageShowed()?Account.instance.backgroundState.fadeIn(REPLY?0:LEVEL_FADE_TIME,"#0d5600",function(){s.getGui("enhancedScene").jObject.css("opacity","0"),s.getGui("enhancedScene").fadeTo(1,LEVEL_FADE_TIME),Account.instance.backgroundState.fadeOut(LEVEL_FADE_TIME),Loader.hideLoadingMessage(),$(window).trigger("resize")}):(s.getGui("enhancedScene").jObject.css("opacity","0"),setTimeout(function(){s.getGui("enhancedScene").fadeTo(1,LEVEL_FADE_TIME),Account.instance.backgroundState.fadeOut(LEVEL_FADE_TIME,function(){$(window).trigger("resize")})},100))}},LevelMenuState.prototype.initSlideContainer=function(){var t=this.getGui("slideContainer");LAST_UNLOCKED>31?t.x-=3e3:LAST_UNLOCKED>25?t.x-=2e3:LAST_UNLOCKED>19&&(t.x-=1e3),t.resize()},LevelMenuState.prototype.bindButtons=function(){var t=this,e=this.getGui("menu"),i=this.getGui("slideContainer");i.setZ(-1),e.bind(function(e){Sound.playWithVolume("click"),t.switchState("MenuState01",t.id,t.parent.id)});var n=this.getGui("nextGame");n.bind(function(e){LVL_INDEX=LAST_UNLOCKED,LEVEL_DESCRIPTION="resources/levels/"+Account.instance.levelOrder[LVL_INDEX+1],Sound.playWithVolume("click"),t.goToGameState()}),LVL_INDEX===LAST_LEVEL&&n.hide();var a=this.getGui("arrowLeft");a.bind(function(e){t.sliding||(t.sliding=!0,Sound.playWithVolume("click"),t.slide(i,i.x+1e3,75,function(){t.sliding=!1,t.checkSlideBtns()}))}),(a=this.getGui("arrowRight")).bind(function(e){t.sliding||(t.sliding=!0,Sound.playWithVolume("click"),t.slide(i,i.x-1e3,75,function(){t.sliding=!1,t.checkSlideBtns()}))})},LevelMenuState.prototype.checkSlideBtns=function(){var t=this.getGui("slideContainer").x,e=this.getGui("arrowLeft"),i=this.getGui("arrowRight");t>-1e3?e.hide():e.show(),t<-2e3?i.hide():i.show()},LevelMenuState.prototype.slide=function(t,e,i,n){var a=this,o=e-t.x;o/=Math.abs(o),o*=i;var s=setInterval(function(){Math.abs(t.x-e)>i?(t.x+=o,t.resize()):(t.x=e,t.resize(),clearInterval(s),n&&n.call(a))},10)},LevelMenuState.prototype.goToGameState=function(){this.switchState("GameState01",this.id,this.parent.id)},LevelMenuState.prototype.switchState=function(t,e,i,n){Account.instance.switchState(t,e||this.id,i||this.parent.id,n||!1,this.getGui("enhancedScene"))};var MENU_GUI_JSON="resources/ui/mainMenu.json",CREDITS_JSON="resources/ui/credits.json",DESCRIPTIONS_JSON="resources/objectsDescription.json",COUNTRIES_SHEET="resources/countriesSheet.json";MenuState.prototype=new BaseState,MenuState.prototype.constructor=MenuState,MenuState.inheritsFrom(BaseState),MenuState.prototype.className="MenuState",MenuState.prototype.createInstance=function(t){var e=new MenuState;return e.activate(t),e},entityFactory.addClass(MenuState),MenuState.prototype.jsonPreloadComplete=function(){if(!Account.instance.mediaPreloaded){var t=["FinalArt/Backgrounds/BackGround_001.jpg","FinalArt/Ball/ball.png","FinalArt/Ball/PointCloud001.png","FinalArt/Ball/PointCloud002.png","FinalArt/Ball/PointCloud003.png","FinalArt/Blocks/Brick/Brick2_Sheet.png","FinalArt/Blocks/Brick/Brick3_Sheet.png","FinalArt/Blocks/Brick/Brick_Sheet.png","FinalArt/Blocks/Glass/Glass2_Sheet.png","FinalArt/Blocks/Glass/Glass3_Sheet.png","FinalArt/Blocks/Glass/Glass_Sheet.png","FinalArt/Blocks/Metal/Metal_001.png","FinalArt/Blocks/Metal/Metal_002.png","FinalArt/Blocks/Metal/Metal_003.png","FinalArt/Blocks/Wood/Wood2_Sheet.png","FinalArt/Blocks/Wood/Wood3_Sheet.png","FinalArt/Blocks/Wood/Wood_Sheet.png","FinalArt/Cannon/Power001.png","FinalArt/Enemy/Enemy_LineArt_Sheet.png","FinalArt/Enemy/Enemy_Pants_Sheet.png","FinalArt/Enemy/Enemy_Shirt_Sheet.png","FinalArt/Goal/Web_Back_001.png","FinalArt/Goal/Web_Front_001.png","FinalArt/Menu/endGameMenu/CongratBG.png","FinalArt/Menu/endGameMenu/CongratTextField.png","FinalArt/Menu/endGameMenu/WinStarEmpty.png","FinalArt/Menu/endGameMenu/WinStarFull.png","FinalArt/Menu/Game/Balls_A.png","FinalArt/Menu/Game/pause.png","FinalArt/Menu/Game/play.png","FinalArt/Menu/Game/re-some.png","FinalArt/Menu/Game/scores.png","FinalArt/Menu/Game/SideMenu.png","FinalArt/Menu/Game/versus.png","FinalArt/Menu/LevelSelect/LastLevel.png","FinalArt/Menu/LevelSelect/LevelBase_A.png","FinalArt/Menu/LevelSelect/TestMenuBG.jpg","FinalArt/Menu/LevelSelect/TwinkleEmpty.png","FinalArt/Menu/LevelSelect/TwinkleFull.png","FinalArt/Menu/LevelSelect/WordsBase.png","FinalArt/Menu/Main/help.png","FinalArt/Menu/Main/Live.png","FinalArt/Menu/Main/logicking.png","FinalArt/Menu/Main/Mute.png","FinalArt/Menu/Main/StartScreen_001.jpg","FinalArt/Menu/Pause/shadow.png","FinalArt/Menu/Pause/shadowed.png","FinalArt/Menu/ArrowL.png","FinalArt/Menu/ArrowR.png","FinalArt/Menu/Button.png","FinalArt/Menu/Divider.png","FinalArt/Menu/FlagBase.png","FinalArt/Player/GG_LineArt_Sheet.png","FinalArt/Player/GG_Pants_Sheet.png","FinalArt/Player/GG_Shirt_Sheet.png","FinalArt/Star/StarLevel_001.png","FinalArt/Tutorial/Tutorial.png","FinalArt/countriesSheet.png","FinalArt/judgeCLR.png","FinalArt/Lock.png","France.png","Germany.png","Italy.png","Portugal.png","Russia.png","Spain.png","turkey.png","United_Kingdom.png","Ukraine.png"];$.each(this.resources.json[DESCRIPTIONS_JSON],function(e,i){$.each(i.visuals,function(e,i){i.totalImage&&t.push(i.totalImage)})}),Loader.updateLoadingState(Loader.currentLoadingState()+10);var e=Loader.currentLoadingState(),i=100-e;this.preloadMedia(t,function(t){Loader.updateLoadingState(e+Math.round(i*(t.loaded/t.total)))}),Account.instance.mediaPreloaded=!0}MenuState.parent.jsonPreloadComplete.call(this)},MenuState.prototype.init=function(t){MenuState.parent.init.call(this,t),guiFactory.createGuiFromJson(this.resources.json[MENU_GUI_JSON],this);var e=this.getGui("enhancedScene");guiFactory.createGuiFromJson(this.resources.json[CREDITS_JSON],this),Account.instance.countriesSheet=this.resources.json[COUNTRIES_SHEET],this.onLanguageChange=function(){i.getGui("play").changeLabel(Resources.getString("play")),i.getGui("langBack").changeLabel(Resources.getString("back")),i.getGui("changeLang").changeLabel(Resources.getString("language")),i.getGui("fullScreen").changeLabel(Resources.getString("fullScreen")),i.getGui("mainFlag").setBackground("images/"+Resources.getString("flag")),i.getGui("mainFlag").resize();for(var t=0;t<i.langButtons.length;t++)i.langButtons[t].onLanguageChange();Account.instance.backgroundState.textLogo.change(Resources.getString("loading")+"...")},Sound.isOn()?(this.getGui("soundOff").hide(),this.getGui("soundOn").show()):(Sound.turnOn(!1),this.getGui("soundOn").hide(),this.getGui("soundOff").show());var i=this,n=this.getGui("play");n.bind(function(t){Sound.playWithVolume("click"),-1==Account.instance.currentFlag?i.switchState("CountrySelectMenuState01"):i.switchState("LevelMenuState01")});(n=this.getGui("soundOn")).bind(function(t){Sound.turnOn(!1),i.getGui("soundOn").hide(),i.getGui("soundOff").show()});(n=this.getGui("soundOff")).bind(function(t){Sound.turnOn(!0),Sound.playWithVolume("click"),i.getGui("soundOff").hide(),i.getGui("soundOn").show(),Sound.playWithVolume("click")});(n=this.getGui("fullScreen")).bind(function(t){toggleFullScreen()}),Device.isMobile()&&-1!==navigator.userAgent.indexOf("Chrome")||n.hide();(n=this.getGui("changeLang")).bind(function(t){Sound.play("click"),a.resizeScroll(),i.getGui("dialogLanguage").resize(),i.getGui("dialogLanguage").show(),a.refresh()});(n=this.getGui("langBack")).bind(function(t){Sound.play("click"),i.getGui("dialogLanguage").hide()});var a=i.getGui("langScroll"),o=[{lang:"EN",text:"en",flag:"United_Kingdom.png"},{lang:"RU",text:"ru",flag:"Russia.png"},{lang:"FR",text:"fr",flag:"France.png"},{lang:"IT",text:"it",flag:"Italy.png"},{lang:"ES",text:"es",flag:"Spain.png"},{lang:"DE",text:"de",flag:"Germany.png"},{lang:"TR",text:"tr",flag:"turkey.png"},{lang:"PT",text:"pt",flag:"Portugal.png"},{lang:"UA",text:"ua",flag:"Ukraine.png"},{lang:"DU",text:"du",flag:"Dutch.png"}];a.setFixedHeight(90*o.length),this.langButtons=[];for(var s=0;s<o.length;s++){var r=guiFactory.createObject("GuiDiv",{parent:this.getGui("langScroll"),style:"dialog",width:100,height:67,x:10,y:10+90*s}),c=guiFactory.createObject("GuiButton",{parent:r,normal:{image:"FinalArt/Menu/Button.png",label:{style:"gameButton bowl-white-unboredered",text:o[s].text,fontSize:35,y:"45%",color:"#753424"}},hover:{image:"FinalArt/Menu/Button.png",scale:110,label:{}},style:"dialog",width:250,height:67,x:117,y:0}),l=guiFactory.createObject("GuiDiv",{parent:r,background:{image:o[s].flag},style:"dialog",width:92,height:67,x:0,y:0,offsetY:0});r.addGui(c),r.addGui(l),a.addListItem(r),a.refresh(),function(t,e){c.buttonText=e,c.bind(function(e){Sound.play("click"),Resources.setLanguage(t),setTimeout(function(){i.onLanguageChange(),i.getGui("dialogLanguage").hide()},500)})}(o[s].lang,o[s].text),c.onLanguageChange=function(){this.changeLabel(Resources.getString(this.buttonText))},this.langButtons.push(c)}var u=this.getGui("creditsDialog");this.getGui("help").bind(function(t){u.show(),i.scroll.refresh(),t.preventDefault(),Sound.playWithVolume("click")});this.getGui("resume").bind(function(t){Sound.playWithVolume("click"),u.hide()});this.scroll=this.getGui("scroll");var h=this.getGui("logicking"),p=this.getGui("text");p.append("<span id='creditsLabel'><br><br><br><br><b><big>Yuri Dobronravin <br><br>Pavlo Honchar<br><br>Viktor Kurochkin<br><br>Volodymyr Shevernytskyy<br><br>Sergey Danysh<br><br>Andrew Zakolukin <br><br>Nikolay Overchenko</big></b> <br><br><br><b>SOUNDS</b><br><i>from Freesound.org</i><br><br>Button Click.wav <br><i>by KorgMS2000B</i><br><br>BUBBLES POPPING.wav<br><i>by Ch0cchi</i>"),p.align("center"),this.scroll.addListItem(h),this.scroll.addListItem(p),this.scroll.refresh,setTimeout(function(){Account.instance.resize(),i.onLanguageChange()},1500),setTimeout(function(){i.getGui("fullScreen").resize(),i.onLanguageChange(),Loader.loadingMessageShowed()?Account.instance.backgroundState.fadeIn(LEVEL_FADE_TIME,"#0d5600",function(){Loader.hideLoadingMessage(),e.show(),$(window).trigger("resize"),setTimeout(function(){Account.instance.backgroundState.fadeOut(LEVEL_FADE_TIME),setTimeout(function(){Account.instance.turnOnMaskLogo(!0)},500)},500)}):(e.jObject.css("opacity","0"),e.show(),e.fadeTo(1,LEVEL_FADE_TIME),Account.instance.backgroundState.fadeOut(LEVEL_FADE_TIME,function(){$(window).trigger("resize")}))},100)},MenuState.prototype.switchState=function(t,e,i,n){Account.instance.switchState(t,e||this.id,i||this.parent.id,n||!1,this.getGui("enhancedScene"))};var COUNTRY_MENU_GUI_JSON="resources/ui/countrySelectMenu.json",REPLY=!1,VISIBLE_FLG_CNT=32;CountrySelectMenuState.inheritsFrom(BaseState),CountrySelectMenuState.prototype.className="CountrySelectMenuState",CountrySelectMenuState.prototype.createInstance=function(t){var e=new CountrySelectMenuState;return e.activate(t),e},entityFactory.addClass(CountrySelectMenuState),CountrySelectMenuState.prototype.jsonPreloadComplete=function(){CountrySelectMenuState.parent.jsonPreloadComplete.call(this)},CountrySelectMenuState.prototype.init=function(t){function e(t,e,a){var o=Account.instance.countries[a],s=guiFactory.createObject("GuiButton",{parent:n,normal:{image:"FinalArt/Menu/FlagBase.png",label:{style:"gameButton bowl-normal",text:o.getShortName(),fontSize:28,x:"66%",y:"48%"}},hover:{image:"FinalArt/Menu/FlagBase.png",scale:115,label:{style:"gameButton bowl-normal",text:o.getShortName(),fontSize:28,x:"66%",y:"48%"}},style:"gameButton",width:162,height:60,x:t,y:e});s.bind(function(t){Sound.playWithVolume("click"),function(t){PlayerGuiSprite.pantsImage=null,PlayerGuiSprite.shirtImage=null,PlayerGuiCSprite.pantsImage=null,PlayerGuiCSprite.shirtImage=null;var e=Account.instance.currentFlag,n=Account.instance.usedFlags.indexOf(t);-1!=n&&(Account.instance.usedFlags[n]=e),Account.instance.currentFlag=t,Device.setStorageItem("Flag",Account.instance.currentFlag),i.switchState("LevelMenuState01",i.id,i.parent.id)}(a)});var r=Account.instance.countriesSheet,c=r.frames[o.name+".png"].frame,l=guiFactory.createObject("GuiDiv",{parent:s,background:{image:"FinalArt/"+r.meta.image,width:r.meta.size.w,height:r.meta.size.h,frameX:-c.x,frameY:-c.y},style:"gameButton",width:c.w,height:c.h,x:22,y:12});return s.addGui(l,"flag"+i.countryButtons.length),s.resize(),i.countryButtons.push(s),s}CountrySelectMenuState.parent.init.call(this,t);var i=this;Account.instance.usedFlags=[],guiFactory.createGuiFromJson(this.resources.json[COUNTRY_MENU_GUI_JSON],this);var n=this.getGui("slideContainer");this.countryButtons=[];for(var a,o,s=Account.instance.countries.length,r=0;r<2;r++){a=1e3*r+60;for(var c=0;c<5;c++){o=70*c+90;for(var l=0;l<4;l++){var u=20*r+4*c+l;if(u>s-1)break;e(a+174*l,o,u)}}}Loader.loadingMessageShowed()?Account.instance.backgroundState.fadeIn(REPLY?0:LEVEL_FADE_TIME,"#0d5600",function(){i.getGui("enhancedScene").jObject.css("opacity","0"),i.getGui("enhancedScene").fadeTo(1,LEVEL_FADE_TIME),Account.instance.backgroundState.fadeOut(LEVEL_FADE_TIME),Loader.hideLoadingMessage(),$(window).trigger("resize")}):(i.getGui("enhancedScene").jObject.css("opacity","0"),setTimeout(function(){i.getGui("enhancedScene").jObject.css("opacity","0"),i.getGui("enhancedScene").fadeTo(1,LEVEL_FADE_TIME),Account.instance.backgroundState.fadeOut(LEVEL_FADE_TIME,function(){$(window).trigger("resize")})},100)),this.checkSlideBtns(),this.bindButtons()},CountrySelectMenuState.prototype.bindButtons=function(){var t=this,e=(this.getGui("menu"),this.getGui("slideContainer"));e.setZ(-1);this.getGui("menu").bind(function(e){Sound.playWithVolume("click"),Device.setStorageItem("Flag",Account.instance.currentFlag),SCORE={},Device.setStorageItem("scores",JSON.stringify(SCORE)),Account.instance.usedFlags=[],t.switchState("MenuState01",t.id,t.parent.id)});var i=this.getGui("arrowLeft");i.bind(function(i){t.sliding||(t.sliding=!0,Sound.playWithVolume("click"),t.slide(e,e.x+1e3,75,function(){t.sliding=!1,t.checkSlideBtns()}))}),(i=this.getGui("arrowRight")).bind(function(i){t.sliding||(t.sliding=!0,Sound.playWithVolume("click"),t.slide(e,e.x-1e3,75,function(){t.sliding=!1,t.checkSlideBtns()}))})},CountrySelectMenuState.prototype.slide=function(t,e,i,n){if(0===i)return t.x=e,t.resize(),void(n&&n.call(this));var a=this,o=e-t.x;o/=Math.abs(o),o*=i;var s=setInterval(function(){Math.abs(t.x-e)>i?(t.x+=o,t.resize()):(t.x=e,t.resize(),clearInterval(s),n&&n.call(a))},10)},CountrySelectMenuState.prototype.checkSlideBtns=function(){var t=this.getGui("slideContainer").x,e=this.getGui("arrowLeft"),i=this.getGui("arrowRight");t>-1e3?e.hide():e.show(),t<0?i.hide():i.show()},CountrySelectMenuState.prototype.resize=function(){CountrySelectMenuState.parent.resize.call(this);for(var t=0;t<this.countryButtons.length;t++)this.countryButtons[t].resize()},CountrySelectMenuState.prototype.switchState=function(t,e,i,n){Account.instance.switchState(t,e||this.id,i||this.parent.id,n||!1,this.getGui("enhancedScene"))},FtSound={playSoundProfile:function(t,e,i){var n=(i-e.min)/(e.max-e.min);n<0||(n>1&&(n=1),Sound.playWithVolume(t,n,e.priority,e.loop))}};var ANIMATION_SPEED=700,FIRE_ANIMATION_OFFSET=200,STD_BALLS_COUNT=3;Player.inheritsFrom(PhysicEntity),Player.prototype.className="Player",Player.prototype.createInstance=function(t){var e=new Player;return e.init(t),e},entityFactory.addClass(Player),Player.prototype.init=function(t){Player.parent.init.call(this,t),t.y-=12,this.direction=new b2Vec2(1,0),this.initialDirection=new b2Vec2(1,0),this.powerRatio=0,this.balls=t.balls?t.balls:STD_BALLS_COUNT,this.scores=t.scores?t.scores:[100,200,300];Account.instance.getEntity("GameState01").getGui("ballsInfo").children.guiEntities[1].change(this.balls)},Player.prototype.createPhysics=function(){var t,e=[],i=this.params.physics,n={x:(this.params.x+i.offsetX)/Physics.getB2dToGameRatio(),y:(this.params.y+i.offsetY)/Physics.getB2dToGameRatio()};(t=new b2BodyDef).type=i.static?b2Body.b2_staticBody:b2Body.b2_dynamicBody,t.userData=null;var a=new b2FixtureDef;a.shape=new b2PolygonShape,a.shape.SetAsBox(i.width/(2*Physics.getB2dToGameRatio()),i.height/(2*Physics.getB2dToGameRatio())),function(t,e){t.density=selectValue(e.density,1),t.restitution=selectValue(e.restitution,1),t.friction=selectValue(e.friction,0),t.isSensor=selectValue(e.sensor,!1),t.userData=selectValue(e.userData,!1),null!=e.filter&&(t.filter.categoryBits=selectValue(e.filter.categoryBits,1),t.filter.groupIndex=selectValue(e.filter.groupIndex,0),t.filter.maskBits=selectValue(e.filter.maskBits,65535))}(a,i),e.push(a),t.position.Set(0,0),t.linearDamping=null!=i.linearDamping?i.linearDamping:0,t.angularDamping=null!=i.angularDamping?i.angularDamping:0;var o=Physics.getWorld();this.physics=o.CreateBody(t);var s=this;$.each(e,function(t,e){s.physics.CreateFixture(e)}),this.physics.SetPosition(n),this.destructable=i.destructable,this.destructable?this.health=i.health:this.health=null,this.params.angle&&this.rotate(2*this.params.angle)},Player.prototype.createVisual=function(){function t(){var i=e.getVisual("pants").animations,n=e.getVisual("shirt").animations;i&&i.getReady&&n&&n.getReady?(BattleScene.instance.sortEntities(),e.playAnimation("getReady",0,!1,!0)):setTimeout(t,50)}var e=this,i=Account.instance.descriptionsData[this.params.type];$.each(i.visuals,function(t,i){var n=guiFactory.createObject(i.class,$.extend({parent:"GuiSprite"===i.class||"PlayerGuiSprite"===i.class?e.guiParent:BattleScene.instance.canvasDiv,style:"sprite",x:e.params.x,y:e.params.y},i));n.setZ(n.params.z),e.mainGui||(e.mainGui=n),0==i.visible&&n.hide();var a={};a.visual=n,e.addVisual(t,a)}),t(),this.ballSpawnPosition={x:85,y:444}},Player.prototype.rotateGuiElement=function(t,e,i){var n={x:i.x*Screen.widthRatio(),y:i.y*Screen.heightRatio()},a=new Transform,o=new Transform;a.translate(n.x,n.y),o.rotateDegrees(e),a.multiply(o),o.translate(-n.x,-n.y),a.multiply(o),t.setTransform(a.m,0)},Player.prototype.navigate=function(t){i=this.getVisual("powerLine");if(!(t.x<this.mainGui.x+72)){this.powerRatio=Math.min((distance(this.ballSpawnPosition,t)-60)/300,1);var e=Account.instance.configData.player.minPowerRatio;this.powerRatio=this.powerRatio>e?this.powerRatio:0,!i.visible&&this.powerRatio>e&&i.show(),i.visible&&this.powerRatio<e&&i.hide(),this.direction.x=Math.max(t.x,this.ballSpawnPosition.x)-this.ballSpawnPosition.x,this.direction.y=Math.min(t.y,this.ballSpawnPosition.y)-this.ballSpawnPosition.y;var i=this.getVisual("powerLine"),n=-calculateAngle(this.direction,this.initialDirection)/2;n>-45&&n<0&&(i.width=this.powerRatio*i.params.width,this.rotateGuiElement(i,n,{x:40+.5*(i.params.totalImageWidth-i.width),y:4*i.height/5+this.mainGui.y})),i.resize()}},Player.prototype.bind=function(t,e){$.each(this.visuals,function(i,n){n.visual&&n.visual.jObject.bind(t,e)})},Player.prototype.createBall=function(){var t=this.parent;t.initChildren({children:{Ball:{class:"Ball",type:"Ball",parent:"Scene01",x:this.ballSpawnPosition.x,y:this.ballSpawnPosition.y}}}),this.ball=Account.instance.getEntity("Ball"),this.ball&&this.ball.attachToGui(t.getVisual(),!1),this.ball.visual.show()},Player.prototype.applyImpulseToBall=function(){this.balls--;var t=this.ball.physics.GetPosition(),e=new b2Vec2(this.direction.x,this.direction.y);e.Normalize(),e.Multiply(this.powerRatio*Account.instance.configData.player.powerRating),this.ball.physics.SetAwake(!0),this.ball.physics.ApplyImpulse(e,new b2Vec2(t.x,t.y))},Player.prototype.fire=function(){this.fired=!0;var t=this;this.getVisual("powerLine").hide(),this.setTimeout(function(){Sound.playWithVolume("shot"),t.applyImpulseToBall(),t.powerRatio=0;Account.instance.getEntity("GameState01").getGui("ballsInfo").children.guiEntities[1].change(t.balls)},FIRE_ANIMATION_OFFSET),t.playAnimation("fire",ANIMATION_SPEED,!1,!0)},Player.prototype.attachToGui=function(t){Player.parent.attachToGui.call(this,t,!1),this.createBall()},Player.prototype.playAnimation=function(t,e,i,n){var a=this.getVisual("line"),o=this.getVisual("pants"),s=this.getVisual("shirt");a.playAnimation(t,e,i,n),o.playAnimation(t,e,i,n),s.playAnimation(t,e,i,n)},Ball.inheritsFrom(PhysicEntity),Ball.prototype.className="Ball",Ball.prototype.createInstance=function(t){var e=new Ball;return e.init(t),e},entityFactory.addClass(Ball),Ball.prototype.init=function(t){Ball.parent.init.call(this,t),this.radius=this.params.physics.radius},Ball.prototype.createVisual=function(){this.description=Account.instance.descriptionsData[this.params.type],this.angle=0,this.visual=guiFactory.createObject("GuiSprite",$.extend({parent:this.guiParent,style:"sprite",x:this.params.x-this.description.visuals.ball.width/2,y:this.params.y-this.description.visuals.ball.height/2},this.description.visuals.ball)),this.visual.params.z&&this.visual.setZ(this.visual.params.z);var t={};t.visual=this.visual,this.addVisual("Ball",t),this.inMotion=!1,this.path=[],this.trace=!0,this.pathLength=0,this.visual.hide()},Ball.prototype.createPath=function(){var t=this.guiParent.visualEntity;if(t){var e=t.pool.clouds.guis[this.pathLength];if(e){var i=this.getPosition();e.setPosition(i.x-e.width/2,i.y-e.height/2),e.show(),this.path.push(e),this.pathLength+=1}}},Ball.prototype.removePath=function(){delete this.path,this.path=[];var t=this.guiParent.visualEntity;$.each(t.pool.clouds.guis,function(t,e){e.visible&&e.hide()}),this.pathLength=0},Ball.prototype.destroy=function(){this.physics&&this.physics.SetLinearVelocity(new b2Vec2(0,0)),this.removePath(),Ball.parent.destroy.call(this)},Ball.prototype.getPathLength=function(){return this.path.length},Ball.prototype.bind=function(t,e){$.each(this.visuals,function(i,n){n.visual&&n.visual.jObject.bind(t,e)})};var DEFAULT_SCORE=50;Block.inheritsFrom(PhysicEntity),Block.prototype.className="Block",Block.prototype.createInstance=function(t){var e=new Block;return e.init(t),e},entityFactory.addClass(Block),Block.prototype.createVisual=function(){var t=this,e=Account.instance.descriptionsData[this.params.type];this.angle=0,$.each(e.visuals,function(e,i){var n=guiFactory.createObject(i.class,$.extend({parent:"GuiSprite"===i.class||"EnemyGuiSprite"===i.class?t.guiParent:BattleScene.instance.canvasDiv,style:"sprite",x:t.params.x,y:t.params.y},i));n.setZ(n.params.z);var a={};a.visual=n,t.addVisual(e,a)}),this.updatePositionFromPhysics()},Block.prototype.onDamage=function(t){var e=Account.instance.configData,i=this.health;Block.parent.onDamage.call(this,t);var n=this.health;n<0&&(n=0);var a=i-n;this.parent.score+=a*e.score.blockDamageCoefficient;if(Account.instance.getEntity("GameState01").getGui("score").children.guiEntities[1].change((this.parent.score*Account.instance.configData.score.rate).toFixed(0)),this.health>0)switch(this.params.material){case"metal":FtSound.playSoundProfile("metal_cube_hit_"+(Math.random()<.5?1:2),e.sounds.metal,t);break;case"brick":FtSound.playSoundProfile("brick_cube_damaged",e.sounds.brick,t);break;case"wood":FtSound.playSoundProfile("wood_cube_damaged",e.sounds.wood,t);break;case"glass":FtSound.playSoundProfile("glass_cube_damaged",e.sounds.glass,t)}else switch(this.params.material){case"metal":FtSound.playSoundProfile("metal_cube_hit_"+(Math.random()<.5?1:2),e.sounds.metal,t);break;case"brick":FtSound.playSoundProfile("brick_cube_destroyed",e.sounds.brick,t);break;case"wood":FtSound.playSoundProfile("wood_cube_destroyed",e.sounds.wood,t);break;case"glass":FtSound.playSoundProfile("glass_cube_destroyed",e.sounds.glass,t)}},Block.prototype.destroy=function(){Block.parent.destroy.call(this)},Block.prototype.attachToGui=function(t){Block.parent.attachToGui.call(this,t,!1)};var IEffect={play:function(t,e,i){function n(){setTimeout(function(){a&&(t.x+=a.x/r,t.y+=a.y/r),o&&t.rotate(o/r),t.resize(),c>=r-1?s&&s():(c+=1,n())},i/r)}var a=!1;e.slide&&(a={x:e.slide.x,y:e.slide.y});var o=!1;e.rotate&&(o=e.rotate);var s=!1;e.onEnd&&(s=e.onEnd);e.scale&&e.scale;var r=e.iterations?e.iterations:20,c=0;n()}},DEATH_DELAY=500;Enemy.inheritsFrom(Block),Enemy.prototype.className="Enemy",Enemy.prototype.createInstance=function(t){var e=new Enemy;return e.init(t),e},entityFactory.addClass(Enemy),Enemy.prototype.init=function(t){Enemy.parent.init.call(this,t),this.oldAngle=0,this.dead=!1},Enemy.prototype.createVisual=function(){function t(){var n=e.getVisual("pants").animations,a=e.getVisual("shirt").animations;n&&n.normal&&a&&a.normal?(e.refreshFace("normal"),e.physics=i,BattleScene.instance.sortEntities(),e.updatePositionFromPhysics()):setTimeout(t,50)}var e=this,i=this.physics;this.physics=null,Enemy.parent.createVisual.call(e),t()},Enemy.prototype.refreshFace=function(t){var e=this;if(this.state!=t)switch(this.state=t,t){case"surprised":e.playAnimation("surprised",500,!1,!0),e.dead=!1;break;case"dead":this.getVisual("shirt").setAnimationEndCallback(function(){e.fadeTo(0,DEATH_DELAY,function(){e.dead&&e.destroy()})}),e.playAnimation("dead",50,!1,!0),e.dead=!0;break;case"normal":e.playAnimation("normal",50,!1,!0),e.dead=!1;break;case"happy":e.playAnimation("happy",50,!1,!0),e.dead=!1}},Enemy.prototype.update=function(){if(!this.DoNotUpdate)if("happy"!=this.state){this.physics&&(this.angle=Math.abs(MathUtils.toDeg(this.physics.GetAngle())));var t=Account.instance.getEntity("Scene01");null!=t&&(this.angle<2?t.finishLevel||this.refreshFace("normal"):this.angle<30?this.refreshFace("surprised"):this.refreshFace("dead"),this.oldAngle=this.angle)}else this.y-=1},Enemy.prototype.destroy=function(){this.parent.score+=Account.instance.configData.score.enemy;Account.instance.getEntity("GameState01").getGui("score").children.guiEntities[1].change((this.parent.score*Account.instance.configData.score.rate).toFixed(0)),Enemy.parent.destroy.call(this),Account.instance.removeScheduledEntity(this),Account.instance.removeChild(this)},Enemy.prototype.fadeTo=function(t,e,i){var n=this.getVisual("line"),a=this.getVisual("pants"),o=this.getVisual("shirt");n.fadeTo(t,e,i),a.fadeTo(t,e,null),o.fadeTo(t,e,null)},Enemy.prototype.playAnimation=function(t,e,i,n){Player.prototype.playAnimation.call(this,t,e,i,n)},Ground.inheritsFrom(PhysicEntity),Ground.prototype.className="Ground",Ground.prototype.createInstance=function(t){var e=new Ground;return e.init(t),e},entityFactory.addClass(Ground),Ground.prototype.init=function(t){Ground.parent.init.call(this,t)};var TRACE_STEP=45,SELF_DESTR_MULT=.8,Z_INDEX=0;BattleScene.inheritsFrom(PhysicScene),BattleScene.prototype.className="BattleScene",BattleScene.prototype.createInstance=function(t){var e=new BattleScene;return e.init(t),e},entityFactory.addClass(BattleScene),BattleScene.prototype.init=function(t){Z_INDEX=0,this.starTimeouts=[],Physics.createWorld(new b2Vec2(0,10),!0,30),BattleScene.parent.init.call(this,t),this.needToReleaseBarrel=!1,this.targeted=!1,this.fired=!1,this.enemies=[],this.score=0,this.pool={clouds:{count:0,guis:[]},scores:{15:{count:2,guis:[]},50:{count:2,guis:[]},100:{count:2,guis:[]},500:{count:1,guis:[]},1000:{count:1,guis:[]},5000:{count:1,guis:[]}}}},BattleScene.prototype.addChild=function(t){BattleScene.parent.addChild.call(this,t)},BattleScene.prototype.initBallPosition=function(){var t=this.player.ball,e=this;t.visual.fadeTo(0,500,function(){t.physics.SetLinearVelocity(new b2Vec2(0,0)),t.physics.SetAngularVelocity(0),t.setPhysicsPosition(e.player.ballSpawnPosition),t.inMotion=!1,t.visual.fadeTo(1,500,function(){e.targeted=!0,e.player.fired=!1,t.leftScene=!1})})},BattleScene.prototype.forceInitBallPosition=function(){var t=this.player.ball,e=this;0!==this.player.balls&&this.needToReleaseBarrelTimeout&&(this.clearTimeout(this.needToReleaseBarrelTimeout),this.needToReleaseBarrel=!1),t.visual.fadeTo(0,100,function(){t.physics.SetLinearVelocity(new b2Vec2(0,0)),t.physics.SetAngularVelocity(0),t.setPhysicsPosition(e.player.ballSpawnPosition),t.inMotion=!1,t.visual.fadeTo(1,100,function(){e.player.fired=!1,e.player.ball.leftScene=!1})})},BattleScene.prototype.createVisual=function(){function t(){e.isStoppedTimeout=null,e.needToReleaseBarrel=!1,0===e.player.balls?(e.playTeamAnimation("facepalm",1e3,2e3,100,200),e.failShow()):e.initBallPosition()}BattleScene.parent.createVisual.call(this);var e=this,i=this.getVisual();!function(){for(var t=0;t<e.pool.clouds.count;t++){var i=guiFactory.createObject("GuiCSprite",{parent:BattleScene.instance.canvasDiv,style:"sprite",width:t%2==0?14:10,height:t%2==0?14:10,totalImage:t%2==0?"FinalArt/Ball/PointCloud002.png":"FinalArt/Ball/PointCloud001.png",totalImageWidth:t%2==0?14:10,totalImageHeight:t%2==0?14:10,totalTile:1,x:0,y:0});i.setZ(5),i.hide(),e.guiParent.addGui(i),i.clampByParentViewport(!1),e.pool.clouds.guis.push(i)}}(),$.each(this.children,function(t,i){"Enemy"==i.params.type&&e.enemies.push(i)});document.getElementById(i.id).style.border="0px solid black",this.setBackgrounds({background:{src:"images/FinalArt/Backgrounds/BackGround_001.jpg",backX:0,backY:0,backWidth:1138,backHeight:640}},Account.instance.getEntity("GameState01").getGui("enhancedScene"));var n={id:"Ground01",class:"Ground",parent:"Scene01",type:"Ground",x:600,y:484,angle:0};this.ground=entityFactory.createObject(n.class,n),Account.instance.addEntity(this.ground),new FootballContactListener;var a=null;this.teamPlayers=[],$.each(this.children,function(t,i){"Player"==i.params.class?(a=i,e.player=i):"TeamPlayer"==i.params.class&&e.teamPlayers.push(i)}),null==a&&alert("There is no Cannon in Scene! It can`t be so, if you have added one. Please add it!"),e.params.balls&&(a.balls=e.params.balls),this.goal=Account.instance.getEntity("Goal"),this.referee=Account.instance.getEntity("Referee");var o=function(t){e.targeting&&(e.player.ball.removePath(),e.player.powerRatio>.1?(e.player.fire(),e.needToReleaseBarrelTimeout=e.setTimeout(function(){e.needToReleaseBarrel=!0},1e3)):e.player.fired=!1),e.targeting=!1};i.jObject.bind(Device.event("cursorMove"),function(t){if(!e.player.fired&&e.player.balls){var i=Device.getLogicPositionFromEvent(t);e.targeting&&a.navigate(i)}}),i.jObject.bind(Device.event("cursorUp"),o),i.jObject.bind(Device.event("cursorDown"),function(t){if(!e.finishLevel){var i=Device.getLogicPositionFromEvent(t);b2Math.DistanceSquared(i,e.player.ballSpawnPosition)>Account.instance.configData.world.touchDistanceSquaredToTargeting||(e.player.fired&&!e.needToReleaseBarrel||(e.targeting=!0),e.player.fired&&e.needToReleaseBarrel&&(e.needToReleaseBarrel=!1,0===e.player.balls?(e.playTeamAnimation("facepalm",1e3,2e3,100,200),e.failShow()):e.forceInitBallPosition()))}}),Account.instance.getEntity("GameState01").getGui("enhancedScene").jObject.bind(Device.event("cursorUp"),o),this.sortEntities(),this.update=function(){e.finishLevel||(Physics.paused()||e.checkBallLeftScene(),e.player.fired&&(e.targeted=!1),e.player.balls||(e.targeted=!1),e.needToReleaseBarrel&&(e.player.ball.leftScene?t():e.isStoppedTimeout||e.checkObjectsStop(t)))},this.initBallPosition(),this.setEnable(!0),Physics.pause(!1)},BattleScene.prototype.checkObjectsStop=function(t){function e(t){var e=i.getBallMaxSpeed();return i.maxSpeed=Math.max(e.linear,e.angular-.003),i.maxSpeed<t}var i=this;this.goal.x-this.player.ball.x<40?e(Account.instance.configData.world.stopSpeedNearGoal)&&(this.isStoppedTimeout=this.setTimeout(function(){e(Account.instance.configData.world.stopSpeedNearGoal)&&(i.isStoppedTimeout=null,t())},1e3)):e(Account.instance.configData.world.stopSpeed)&&(this.isStoppedTimeout=this.setTimeout(function(){e(Account.instance.configData.world.stopSpeed)&&(i.isStoppedTimeout=null,t())},1e3))},BattleScene.prototype.getBallMaxSpeed=function(){var t=this.player.ball.physics;return{linear:t.GetLinearVelocity().Length(),angular:t.GetAngularVelocity()}},BattleScene.prototype.sortEntities=function(){},BattleScene.prototype.checkBallLeftScene=function(){var t=this.player.ball.getPosition(),e=this.getVisual();!this.player.ball.leftScene&&(t.x<e.x-100||t.x>e.width+150)&&(this.needToReleaseBarrel=!0,this.player.ball.leftScene=!0)},BattleScene.prototype.failShow=function(){var t=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4);17==Account.instance.currentFlag&&16==Account.instance.usedFlags[t]?Sound.playWithVolume("ukraine_wins"):Sound.playWithVolume("loss_crowd",.7),this.finishLevel=!0;var e=this,i=Account.instance.getEntity("PlayerVisual"),n=e.parent;n.getGui("star.0").hide(),n.getGui("star.1").hide(),n.getGui("star.2").hide(),this.setTimeout(function(){var t=n.getGui("endGameMenu");t.getGui("resultMessage").changeLabel("oops_you_failed"),Account.instance.getEntity("PlayerVisual").show(),e.setTimeout(function(){Physics.pause(!0),LVL_INDEX==LAST_LEVEL&&t.getGui("resultMessage").changeLabel("great_victory"),n.getGui("endGameMenu").show(),SCORE["level_"+LVL_INDEX]>0&&LVL_INDEX!==LAST_LEVEL?n.getGui("endNextBtn").show():n.getGui("endNextBtn").hide(),i.show(),i.playAnimation("facepalm",0,!1,!1)},800)})},BattleScene.prototype.successShow=function(){Account.instance.getEntity("PlayerVisual").hide();var t=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4);16==Account.instance.currentFlag&&17==Account.instance.usedFlags[t]?Sound.playWithVolume("ukraine_wins"):Sound.playWithVolume("win_crowd_v2",.7);var e=this,i=e.parent,n=i.getGui("endNextBtn");i.getGui("star.0").show(),i.getGui("star.1").show(),i.getGui("star.2").show(),this.setTimeout(function(){n.show();var t=SCORE["level_"+LVL_INDEX];(!t||e.score>t)&&(SCORE["level_"+LVL_INDEX]=Math.floor(e.score),Device.setStorageItem("scores",JSON.stringify(SCORE)));var a=i.getGui("endGameMenu"),o=a.getGui("resultMessage");return o.changeLabel("congratulations"),LVL_INDEX==LAST_LEVEL&&o.changeLabel("great_victory"),e.setTimeout(function(){Physics.pause(!0),a.show(),e.starAnimations()},800),!0},800)},BattleScene.prototype.starAnimations=function(){var t=this,e=this.parent,i=this.player.scores,n=0;if(null!=i){for(var a=i.length-1;a>=0;a--)if(this.score>=i[a]){n=a+1;break}if(SCORE["level_"+LVL_INDEX+"Stars"]=n,Device.setStorageItem("scores",JSON.stringify(SCORE)),n>0){var o=t.setTimeout(function(){var i=e.getGui("star.0");if(i&&(Sound.playWithVolume("first_star"),i.applyBackground({image:"FinalArt/Menu/endGameMenu/WinStarFull.png"})),n>1){var a=t.setTimeout(function(){var i=e.getGui("star.1");if(i&&(Sound.playWithVolume("second_star"),i.applyBackground({image:"FinalArt/Menu/endGameMenu/WinStarFull.png"})),n>2){var a=t.setTimeout(function(){var t=e.getGui("star.2");t&&(Sound.playWithVolume("third_star"),t.applyBackground({image:"FinalArt/Menu/endGameMenu/WinStarFull.png"}))},400);t.starTimeouts.push(a)}},400);t.starTimeouts.push(a)}},400);t.starTimeouts.push(o)}var s="";19===LVL_INDEX?s="groupStage":25===LVL_INDEX?s="play-offRound":31===LVL_INDEX&&(s="final"),""!==s&&this.setTimeout(function(){e.getGui("star.0").hide(),e.getGui("star.1").hide(),e.getGui("star.2").hide();e.getGui("stageMessage").change(s),e.getGui("stageMessage").show()},400*n+800)}else console.error("player.scores is empty in the current level!")},BattleScene.prototype.clearStarTimeouts=function(){for(var t=0;t<this.starTimeouts.length;t++)this.clearTimeout(this.starTimeouts[t])},BattleScene.prototype.checkMaxSpeed=function(){for(var t=this.physicWorld.m_bodyList,e={linear:t.GetLinearVelocity().Length(),angular:t.GetAngularVelocity()};null!=t;t=t.m_next){var i={linear:t.GetLinearVelocity().Length(),angular:t.GetAngularVelocity()};i.linear>e.linear&&(e.linear=i.linear),i.angular>e.angular&&(e.angular=i.angular)}return e},BattleScene.prototype.scoreGoal=function(){if(!this.finishLevel){var t=this;this.finishLevel=!0,this.score+=Account.instance.configData.score.goal,this.score+=this.player.balls*Account.instance.configData.score.ball;Account.instance.getEntity("GameState01").getGui("score").children.guiEntities[1].change((this.score*Account.instance.configData.score.rate).toFixed(0)),this.playTeamAnimation("happy",3e3,4500,100,600),this.setTimeout(function(){t.successShow()},500)}},BattleScene.prototype.playTeamAnimation=function(t,e,i,n,a){var o=!1,s=!1;if(null==e||null==i)o=!0;if(null==n||null==a)s=!0;$.each(this.teamPlayers,function(r,c){c.params.enemy?c.setTimeout(function(){c.playAnimation("happy"===t?"facepalm":"facepalm"===t?"happy":t,o?0:b2Math.RandomRange(e,i),!1,!0)},s?0:b2Math.RandomRange(n,a)):c.setTimeout(function(){c.playAnimation(t,o?0:b2Math.RandomRange(e,i),!1,!0)},s?0:b2Math.RandomRange(n,a))}),this.player.playAnimation(t,o?0:e,!1,!0)},GuiCanvas.prototype.setPosition=function(t,e,i){i||this.resize()};var GAME_GUI_JSON="resources/ui/GameState.json",OBJECTS_DESCRIPTION="resources/objectsDescription.json",EVERY_LEVEL_OBJECTS="resources/everyLevelObjects.json",CONFIG="resources/config.json";GameState.inheritsFrom(BaseState),GameState.prototype.className="GameState",GameState.prototype.createInstance=function(t){var e=new GameState;return e.activate(t),e},entityFactory.addClass(GameState),GameState.prototype.jsonPreloadComplete=function(){GameState.parent.jsonPreloadComplete.call(this)},GameState.prototype.init=function(t){function e(){if(i.getGui("startMenu").hide(),0==LVL_INDEX){t=i.getGui("tutorialMenu");t.show();i.getGui("tutorialMenuLabel").change("take_a_shot");(t=i.getGui("tutorialFrame_0")).show(),t.playAnimation("tutorial",3e3,!0,!0);var t;(t=i.getGui("tutorialEnd")).bind(function(t){i.getGui("tutorialMenu").hide(),Physics.pause(!1);var e=Account.instance.getEntity("Scene01");e.setTimeout(function(){e.referee.whistle()},500)})}else Physics.pause(!1)}var i=this;REPLY=!1,Physics.setDebugModeEnabled(!1),GameState.parent.init.call(this,t),Account.instance.descriptionsData=this.resources.json[OBJECTS_DESCRIPTION],Account.instance.configData=this.resources.json[CONFIG],guiFactory.createGuiFromJson(this.resources.json[GAME_GUI_JSON],this);var n=this.resources.json[EVERY_LEVEL_OBJECTS];$.extend(n,this.resources.json[LEVEL_DESCRIPTION]);var a=Account.instance.getEntity("GameState01").params;a.children=n,this.initChildren(a);var o=Account.instance.getEntity("Scene01"),s=this.getGui("sceneContainer");o.attachToGui(s,!1),this.battleField=o,this.getGui("endGameMenu").hide(),i.getGui("levelInfo").children.guiEntities[1].change(LVL_INDEX+1),Sound.isOn()?this.getGui("soundOff").hide():this.getGui("soundOn").hide(),i.getGui("tutorialMenu").hide();r=this.getGui("pauseBtn");r.bind(function(t){Sound.playWithVolume("click"),function(){var t=i.getGui("pauseMenu");i.physicsBeforePause=Physics.paused(),Physics.pause(!0),t.show(),t.playJqueryAnimation("open",function(){})}()});(r=this.getGui("resume")).bind(function(t){Sound.playWithVolume("click"),function(){var t=i.getGui("pauseMenu");t.playJqueryAnimation("close",function(){Physics.pause(i.physicsBeforePause),t.hide()})}()});(r=this.getGui("restart")).bind(function(t){REPLY=!0,Sound.playWithVolume("click"),BattleScene.instance.clearStarTimeouts(),i.switchState("LevelMenuState01",i.id,i.parent.id,!0)});(r=this.getGui("menu")).bind(function(t){Sound.playWithVolume("click"),BattleScene.instance.clearStarTimeouts(),i.switchState("LevelMenuState01",i.id,i.parent.id)});(r=this.getGui("endMenuBtn")).bind(function(t){LVL_INDEX+=1,Sound.playWithVolume("click"),BattleScene.instance.clearStarTimeouts(),i.switchState("LevelMenuState01",i.id,i.parent.id),console.log(SCORE)});(r=this.getGui("endReplyBtn")).bind(function(t){REPLY=!0,Sound.playWithVolume("click"),BattleScene.instance.clearStarTimeouts(),i.switchState("LevelMenuState01",i.id,i.parent.id,!0)});(r=this.getGui("endNextBtn")).bind(function(t){Sound.playWithVolume("click"),Sound.playWithVolume("click");var e=LVL_INDEX%2+1;1===e&&(REPLY=!0),LVL_INDEX+=1,LEVEL_DESCRIPTION="resources/levels/"+Account.instance.levelOrder[LVL_INDEX+1],BattleScene.instance.clearStarTimeouts(),i.switchState("LevelMenuState01",i.id,i.parent.id,1===e)});(r=this.getGui("soundOn")).bind(function(t){Sound.turnOn(!1),i.getGui("soundOn").hide(),i.getGui("soundOff").show()});(r=this.getGui("soundOff")).bind(function(t){Sound.turnOn(!0),i.getGui("soundOff").hide(),i.getGui("soundOn").show(),Sound.playWithVolume("click")});var r;(r=this.getGui("startOK")).bind(function(t){Sound.playWithVolume("click"),e();var i=Account.instance.getEntity("Scene01");0!==LVL_INDEX&&i.setTimeout(function(){i.referee.whistle()},500)}),Loader.loadingMessageShowed()?Account.instance.backgroundState.fadeIn(REPLY?0:LEVEL_FADE_TIME,"#0d5600",function(){i.getGui("enhancedScene").jObject.css("opacity","0"),i.getGui("enhancedScene").fadeTo(1,LEVEL_FADE_TIME),Account.instance.backgroundState.fadeOut(LEVEL_FADE_TIME),Loader.hideLoadingMessage(),$(window).trigger("resize")}):(i.getGui("enhancedScene").jObject.css("opacity","0"),setTimeout(function(){i.getGui("enhancedScene").fadeTo(1,LEVEL_FADE_TIME),Account.instance.backgroundState.fadeOut(LEVEL_FADE_TIME,function(){Account.instance.resize()})},100)),function(){var t=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4),e=Account.instance.countriesSheet,n=Account.instance.countries[Account.instance.currentFlag],a=e.frames[n.name+".png"].frame,o=Account.instance.countries[Account.instance.usedFlags[t]],s=e.frames[o.name+".png"].frame,r=i.getGui("startMenu"),c=guiFactory.createObject("GuiDiv",{parent:r,background:{image:"FinalArt/"+e.meta.image,width:e.meta.size.w,height:e.meta.size.h,frameX:-a.x,frameY:-a.y},style:"gameButton",width:a.w,height:a.h,x:70,y:130,z:9998});c.resizeBackground(),r.addGui(c);var l=guiFactory.createObject("GuiDiv",{parent:r,background:{image:"FinalArt/"+e.meta.image,width:e.meta.size.w,height:e.meta.size.h,frameX:-s.x,frameY:-s.y},style:"gameButton",width:s.w,height:s.h,x:315,y:130,z:9998});l.resizeBackground(),r.addGui(l),i.getGui("yourTeamLabel").changeLabel(n.name),i.getGui("enemyTeamLabel").changeLabel(o.name);var u="";if(LVL_INDEX<20){var h=LVL_INDEX%4+1;u+=Resources.getString(1===h||2===h?"firstMatch":"secondMatch")+", "}var p=LVL_INDEX%2+1,d=r.getGui("startMenuLabel");u+=Resources.getString(1===p?"firstHalf":"secondHalf"),d.change(u),r.show(),Physics.pause(!0)}()},GameState.prototype.destroy=function(){Account.instance.getEntity("Scene01");GameState.parent.destroy.call(this),PlayerGuiCSprite.enemyPantsImage=null,PlayerGuiCSprite.enemyShirtImage=null,EnemyGuiCSprite.shirtImage=null,EnemyGuiCSprite.pantsImage=null,delete Account.instance.allEntities.Scene01,delete Account.instance.allEntities[this.id],Account.instance.removeEntity("BallExplosion",!0),Account.instance.removeEntity("BigBlockDestruction",!0),Account.instance.removeEntity("SmallBlockDestruction",!0),Physics.destroyWorld()},GameState.prototype.resize=function(){GameState.parent.resize.call(this);var t=BattleScene.instance;t.resize();var e=t.guiParent.getRealPosition();t.canvasOffset={x:parseInt(e.x),y:parseInt(e.y)}},GameState.prototype.switchState=function(t,e,i,n){Account.instance.switchState(t,e||this.id,i||this.parent.id,n||!1,this.getGui("enhancedScene"))},Goal.inheritsFrom(PhysicEntity),Goal.prototype.className="Goal",Goal.prototype.createInstance=function(t){var e=new Goal;return e.init(t),Goal._instance=e,e},entityFactory.addClass(Goal),Goal.prototype.init=function(t){Goal.parent.init.call(this,t)},Goal.prototype.createVisual=function(){var t=this,e=Account.instance.descriptionsData[this.params.type];this.angle=0,$.each(e.visuals,function(e,i){var n=guiFactory.createObject(i.class,$.extend({parent:"GuiCSprite"===i.class?BattleScene.instance.canvasDiv:t.guiParent,style:"sprite",x:t.params.x,y:t.params.y},i));n.params.z&&n.setZ(n.params.z);var a=null!=i.offsetX?i.offsetX:0,o=null!=i.offsetY?i.offsetY:0;(i={}).offsetX=a,i.offsetY=o,i.visual=n,t.addVisual(e,i)}),this.updatePositionFromPhysics()},Goal.prototype.createPhysics=function(){Goal.parent.createPhysics.call(this)},Goal.prototype.attachToGui=function(t){Goal.parent.attachToGui.call(this,t,!1)},Goal.prototype.updatePhysics=function(){Goal.parent.updatePhysics.call(this)},FootballContactListener.prototype.constructor=FootballContactListener,Referee.inheritsFrom(PhysicEntity),Referee.prototype.className="Referee",Referee.prototype.createInstance=function(t){var e=new Referee;return e.init(t),e},entityFactory.addClass(Referee),Referee.prototype.createVisual=function(){var t=this,e=Account.instance.descriptionsData[this.params.type];$.each(e.visuals,function(e,i){var n=guiFactory.createObject(i.class,$.extend({parent:"GuiSprite"===i.class?t.guiParent:BattleScene.instance.canvasDiv,style:"sprite",x:t.params.x,y:t.params.y},i));n.params.z&&n.setZ(n.params.z);var a={};a.visual=n,t.addVisual(e,a)}),this.getVisual("referee").fadeTo(0,0)},Referee.prototype.attachToGui=function(t){Referee.parent.attachToGui.call(this,t,!1)},Referee.prototype.whistle=function(){var t=this.getVisual("referee");this.setTimeout(function(){t.fadeTo(0,700)},1400),t.fadeTo(1,500,function(){Sound.playWithVolume("referee")})},Star.inheritsFrom(PhysicEntity),Star.prototype.className="Star",Star.prototype.createInstance=function(t){var e=new Star;return e.init(t),e},entityFactory.addClass(Star),Star.prototype.destroyAndPlayAnimation=function(){var t=this;this.visual.setAnimationEndCallback(function(){t.parent.score+=Account.instance.configData.score.star;Account.instance.getEntity("GameState01").getGui("score").children.guiEntities[1].change((t.parent.score*Account.instance.configData.score.rate).toFixed(0)),Star.parent.destroy.call(t)}),this.visual.playAnimation("dest",600,!1,!0)},Star.prototype.init=function(t){Star.parent.init.call(this,t)},Star.prototype.createVisual=function(){this.description=Account.instance.descriptionsData[this.params.type],this.angle=0;t=this.description.visuals.star;this.visual=guiFactory.createObject(t.class,$.extend({parent:"GuiCSprite"===t.class?BattleScene.instance.canvasDiv:this.guiParent,style:"sprite",x:this.params.x-this.description.visuals.star.width/2,y:this.params.y-this.description.visuals.star.height/2},this.description.visuals.star)),this.visual.params.z&&this.visual.setZ(this.visual.params.z);var t;(t={}).visual=this.visual,this.addVisual("star",t)},Star.prototype.attachToGui=function(t){Star.parent.attachToGui.call(this,t,!1)},Star.prototype.getPosition=function(){return{x:this.params.x,y:this.params.y}},Star.prototype.updatePositionFromPhysics=function(){var t=this;if(null!=t.physics){var e=this.getPosition();t.setPosition(e.x-t.params.physics.x-t.params.physics.width/2,e.y-t.params.physics.y-t.params.physics.height/2),$.each(this.visuals,function(e,i){var n=t.getPhysicsRotation().toFixed(3);n=MathUtils.toDeg(n),i.visual.rotate(n)})}},TeamPlayer.inheritsFrom(PhysicEntity),TeamPlayer.prototype.className="TeamPlayer",TeamPlayer.prototype.createInstance=function(t){var e=new TeamPlayer;return e.init(t),e},entityFactory.addClass(TeamPlayer),TeamPlayer.prototype.init=function(t){TeamPlayer.parent.init.call(this,t),this.params.flipped&&(this.direction=new b2Vec2(-1,0))},TeamPlayer.prototype.createVisual=function(){function t(){var i=e.getVisual("pants").animations,n=e.getVisual("shirt").animations;i&&i.getReady&&n&&n.getReady?(e.playAnimation("getReady",0,!1,!0),BattleScene.instance.sortEntities(),e.updatePositionFromPhysics()):setTimeout(t,50)}var e=this,i=Account.instance.descriptionsData[this.params.type];$.each(i.visuals,function(t,n){var a=guiFactory.createObject(n.class,$.extend({parent:"GuiSprite"===n.class||"PlayerGuiSprite"===n.class?e.guiParent:BattleScene.instance.canvasDiv,style:"sprite",x:e.params.x,y:e.params.y,flipped:null!=i.flipped&&i.flipped,enemy:!!e.params.enemy&&e.params.enemy},n));a.setZ(a.params.z),0==n.visible&&a.hide();var o={};o.visual=a,e.addVisual(t,o)}),t()},TeamPlayer.prototype.kickBall=function(t){var e=this;this.canKick&&(this.canKick=!1,this.setTimeout(function(){Sound.playWithVolume("shot"),e.applyImpulseToBall(t),e.canKick=!0},FIRE_ANIMATION_OFFSET),e.playAnimation("fire",ANIMATION_SPEED,!1,!0))},TeamPlayer.prototype.applyImpulseToBall=function(t){var e=t.GetPosition(),i=new b2Vec2(this.direction.x,this.direction.y);i.Normalize(),i.Multiply(this.powerRatio*Account.instance.configData.player.teamPlayerPowerRating),t.SetAwake(!0),t.ApplyImpulse(i,new b2Vec2(e.x,e.y))},TeamPlayer.prototype.attachToGui=function(t){TeamPlayer.parent.attachToGui.call(this,t,!1)},TeamPlayer.prototype.playAnimation=Player.prototype.playAnimation,PlayerGuiSprite.inheritsFrom(GuiSprite),PlayerGuiSprite.prototype.className="PlayerGuiSprite",PlayerGuiSprite.prototype.createInstance=function(t){var e=new PlayerGuiSprite;return e.initialize(t),e},guiFactory.addClass(PlayerGuiSprite),PlayerGuiSprite.prototype.initialize=function(t){if(Device.isSupportsToDataURL()){if(GuiSprite.parent.initialize.call(this,t),t.enemy){if("shirt"===t.type){if(null==PlayerGuiSprite.enemyShirtImage){n=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4);(o=(a=Account.instance.countries[Account.instance.usedFlags[n]]).shirtColor)===Account.instance.countries[Account.instance.currentFlag].shirtColor&&a.pantsColor===Account.instance.countries[Account.instance.currentFlag].pantsColor&&(o=ColorRgb.Colors.GRAY);var e=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),o),i=recolorFullImage(s=Resources.getAsset(t.totalImage),e);PlayerGuiSprite.enemyShirtImage=i}this.totalSrc=PlayerGuiSprite.enemyShirtImage}else if("pants"===t.type){if(null==PlayerGuiSprite.enemyPantsImage){var n=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4),a=Account.instance.countries[Account.instance.usedFlags[n]];(o=a.pantsColor)===Account.instance.countries[Account.instance.currentFlag].pantsColor&&a.shirtColor===Account.instance.countries[Account.instance.currentFlag].shirtColor&&(o=ColorRgb.Colors.GRAY);var e=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),o),i=recolorFullImage(s=Resources.getAsset(t.totalImage),e);PlayerGuiSprite.enemyPantsImage=i}this.totalSrc=PlayerGuiSprite.enemyPantsImage}}else if("shirt"===t.type){if(null==PlayerGuiSprite.shirtImage){var o=Account.instance.countries[Account.instance.currentFlag].shirtColor,e=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),o),i=recolorFullImage(s=Resources.getAsset(t.totalImage),e);PlayerGuiSprite.shirtImage=i}this.totalSrc=PlayerGuiSprite.shirtImage}else if("pants"===t.type){if(null==PlayerGuiSprite.pantsImage){var o=Account.instance.countries[Account.instance.currentFlag].pantsColor,e=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),o),s=Resources.getAsset(t.totalImage),i=recolorFullImage(s,e);PlayerGuiSprite.pantsImage=i}this.totalSrc=PlayerGuiSprite.pantsImage}this.clampByViewport=this.clampByViewportSimple,this.totalWidth=t.totalImageWidth,this.totalHeight=t.totalImageHeight,this.frameCallback=null,this.offsetY1=0,this.offsetX1=0,null==t.totalTile?this.totalTile={x:0,y:0}:this.totalTile=t.totalTile,this.flipped=null!=t.flipped&&t.flipped,this.setBackground(this.totalSrc),this.currentAnimation=null,this.spatialAnimation=null,this.animations=new Object;var r=this;t.spriteAnimations&&$.each(t.spriteAnimations,function(t,e){r.addSpriteAnimation(t,e)}),this.jObject.css("background-position",Math.floor(Screen.widthRatio()*this.totalTile.x*this.width)+"px "+Math.floor(Screen.heightRatio()*this.height*this.totalTile.y)+"px"),this.resize(),t.startAnimation&&(this.playAnimation(t.startAnimation.name,t.startAnimation.duration,t.startAnimation.loop),this.setStaticUpdate(!0)),this.frames={},t.frames&&(this.frames=t.frames)}else PlayerGuiSprite.parent.initialize.call(this,t)},PlayerGuiSprite.pantsImage=null,PlayerGuiSprite.shirtImage=null,PlayerGuiSprite.enemyPantsImage=null,PlayerGuiSprite.enemyShirtImage=null,PlayerGuiCSprite.inheritsFrom(GuiCSprite),PlayerGuiCSprite.prototype.className="PlayerGuiCSprite",PlayerGuiCSprite.prototype.createInstance=function(t){var e=new PlayerGuiCSprite;return e.initialize(t),e},guiFactory.addClass(PlayerGuiCSprite),PlayerGuiCSprite.prototype.initialize=function(t){if(Device.isSupportsToDataURL()){var e=this;if(this.params=t,t.enemy){if("shirt"===t.type)if(null==PlayerGuiCSprite.enemyShirtImage){var i=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4),n=(s=Account.instance.countries[Account.instance.usedFlags[i]]).shirtColor,a=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),n),o=recolorFullImage(r=Resources.getAsset(t.totalImage),a);PlayerGuiCSprite.enemyShirtImage=new Image,PlayerGuiCSprite.enemyShirtImage.onload=function(){e.img=PlayerGuiCSprite.enemyShirtImage,e.init()},PlayerGuiCSprite.enemyShirtImage.src=o}else if(isImageOk(PlayerGuiCSprite.enemyShirtImage))this.img=PlayerGuiCSprite.enemyShirtImage,e.init();else{c=PlayerGuiCSprite.enemyShirtImage.onload;PlayerGuiCSprite.enemyShirtImage.onload=function(){c&&c(),e.img=PlayerGuiCSprite.enemyShirtImage,e.init()}}else if("pants"===t.type)if(null==PlayerGuiCSprite.enemyPantsImage){var i=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4),s=Account.instance.countries[Account.instance.usedFlags[i]],n=s.pantsColor,a=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),n),o=recolorFullImage(r=Resources.getAsset(t.totalImage),a);PlayerGuiCSprite.enemyPantsImage=new Image,PlayerGuiCSprite.enemyPantsImage.onload=function(){e.img=PlayerGuiCSprite.enemyPantsImage,e.init()},PlayerGuiCSprite.enemyPantsImage.src=o}else if(isImageOk(PlayerGuiCSprite.enemyPantsImage))this.img=PlayerGuiCSprite.enemyPantsImage,e.init();else{c=PlayerGuiCSprite.enemyPantsImage.onload;PlayerGuiCSprite.enemyPantsImage.onload=function(){c&&c(),e.img=PlayerGuiCSprite.enemyPantsImage,e.init()}}}else if("shirt"===t.type)if(null==PlayerGuiCSprite.shirtImage){var n=Account.instance.countries[Account.instance.currentFlag].shirtColor,a=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),n),o=recolorFullImage(r=Resources.getAsset(t.totalImage),a);PlayerGuiCSprite.shirtImage=new Image,PlayerGuiCSprite.shirtImage.onload=function(){e.img=PlayerGuiCSprite.shirtImage,e.init()},PlayerGuiCSprite.shirtImage.src=o}else if(isImageOk(PlayerGuiCSprite.shirtImage))this.img=PlayerGuiCSprite.shirtImage,e.init();else{c=PlayerGuiCSprite.shirtImage.onload;PlayerGuiCSprite.shirtImage.onload=function(){c&&c(),e.img=PlayerGuiCSprite.shirtImage,e.init()}}else if("pants"===t.type)if(null==PlayerGuiCSprite.pantsImage){var n=Account.instance.countries[Account.instance.currentFlag].pantsColor,a=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),n),r=Resources.getAsset(t.totalImage),o=recolorFullImage(r,a);PlayerGuiCSprite.pantsImage=new Image,PlayerGuiCSprite.pantsImage.onload=function(){e.img=PlayerGuiCSprite.pantsImage,e.init()},PlayerGuiCSprite.pantsImage.src=o}else if(isImageOk(PlayerGuiCSprite.pantsImage))this.img=PlayerGuiCSprite.pantsImage,e.init();else{var c=PlayerGuiCSprite.pantsImage.onload;PlayerGuiCSprite.pantsImage.onload=function(){c&&c(),e.img=PlayerGuiCSprite.pantsImage,e.init()}}}else PlayerGuiCSprite.parent.initialize.call(this,t)},PlayerGuiCSprite.prototype.init=function(){var t=this,e=this.params;this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this.flipped=null!=e.flipped&&e.flipped,this.transformOrigin=e.transformOrigin||{x:.5,y:.5},this.frameSizeScale=e.frameSizeScale||{x:1,y:1},this.opacity=e.opacity?e.opacity:1,this.width=e.width,this.height=e.height,this.parent=e.parent.canvas?e.parent.canvas:e.parent,this.id=this.parent.generateId.call(this),this.total={image:e.totalImage,width:e.totalImageWidth,height:e.totalImageHeight,tile:e.totalTile},this.offsetX=e.offsetX||0,this.offsetY=e.offsetY||0,t.imageHeight=Math.round(Math.round(t.img.height/Math.round(t.total.height/t.height))),t.imageWidth=Math.round(Math.round(t.img.width/Math.round(t.total.width/t.width))),t.scale={x:Math.round(t.width/t.imageWidth*100)/100,y:Math.round(t.height/t.imageHeight*100)/100},this.backgroundPosition={x:0,y:0},this.backgroundSize={w:this.total.width,h:this.total.height},this.rotate(0),this.resizeBackground(),this.currentAnimation=null,this.spatialAnimation=null,this.animations=new Object,e.spriteAnimations&&$.each(e.spriteAnimations,function(e,i){t.addSpriteAnimation(e,i)}),this.frames={},e.frames&&(this.frames=e.frames),this.parent.canvas?this.parent.canvas.addGui(this):this.parent.addGui(this),this.show(),this.setEnabled(!0),Account.instance.addScheduledEntity(this)},PlayerGuiCSprite.pantsImage=null,PlayerGuiCSprite.shirtImage=null,PlayerGuiCSprite.enemyPantsImage=null,PlayerGuiCSprite.enemyShirtImage=null,EnemyGuiSprite.inheritsFrom(GuiSprite),EnemyGuiSprite.prototype.className="EnemyGuiSprite",EnemyGuiSprite.prototype.createInstance=function(t){var e=new EnemyGuiSprite;return e.initialize(t),e},guiFactory.addClass(EnemyGuiSprite),EnemyGuiSprite.prototype.initialize=function(t){if(Device.isSupportsToDataURL()){if(GuiSprite.parent.initialize.call(this,t),"shirt"===t.type){if(null==EnemyGuiSprite.shirtImage){n=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4);(o=(a=Account.instance.countries[Account.instance.usedFlags[n]]).shirtColor)===Account.instance.countries[Account.instance.currentFlag].shirtColor&&a.pantsColor===Account.instance.countries[Account.instance.currentFlag].pantsColor&&(o=ColorRgb.Colors.GRAY);var e=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),o),i=recolorFullImage(s=Resources.getAsset(t.totalImage),e);EnemyGuiSprite.shirtImage=i}this.totalSrc=EnemyGuiSprite.shirtImage}else if("pants"===t.type){if(null==EnemyGuiSprite.pantsImage){var n=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4),a=Account.instance.countries[Account.instance.usedFlags[n]],o=a.pantsColor;o===Account.instance.countries[Account.instance.currentFlag].pantsColor&&a.shirtColor===Account.instance.countries[Account.instance.currentFlag].shirtColor&&(o=ColorRgb.Colors.GRAY);var e=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),o),s=Resources.getAsset(t.totalImage),i=recolorFullImage(s,e);EnemyGuiSprite.pantsImage=i}this.totalSrc=EnemyGuiSprite.pantsImage}this.clampByViewport=this.clampByViewportSimple,this.totalWidth=t.totalImageWidth,this.totalHeight=t.totalImageHeight,this.frameCallback=null,this.offsetY1=0,this.offsetX1=0,null==t.totalTile?this.totalTile={x:0,y:0}:this.totalTile=t.totalTile,this.flipped=null!=t.flipped&&t.flipped,this.setBackground(this.totalSrc),this.currentAnimation=null,this.spatialAnimation=null,this.animations=new Object;var r=this;t.spriteAnimations&&$.each(t.spriteAnimations,function(t,e){r.addSpriteAnimation(t,e)}),this.jObject.css("background-position",Math.floor(Screen.widthRatio()*this.totalTile.x*this.width)+"px "+Math.floor(Screen.heightRatio()*this.height*this.totalTile.y)+"px"),this.resize(),t.startAnimation&&(this.playAnimation(t.startAnimation.name,t.startAnimation.duration,t.startAnimation.loop),this.setStaticUpdate(!0)),this.frames={},t.frames&&(this.frames=t.frames)}else EnemyGuiSprite.parent.initialize.call(this,t)},EnemyGuiSprite.pantsImage=null,EnemyGuiSprite.shirtImage=null,PlayerVisualGui.inheritsFrom(VisualEntity),PlayerVisualGui.prototype.className="PlayerVisualGui",PlayerVisualGui.prototype.createInstance=function(t){var e=new PlayerVisualGui;return e.init(t),e},entityFactory.addClass(PlayerVisualGui),PlayerVisualGui.prototype.createVisual=function(){var t=this,e=Account.instance.descriptionsData[this.params.type];$.each(e.visuals,function(e,i){var n=guiFactory.createObject(i.class,$.extend({parent:Account.instance.allEntities.GameState01.getGui("endGameMenu"),style:"sprite",x:t.params.x,y:t.params.y},i));n.setZ(n.params.z);var a={};a.visual=n,t.addVisual(e,a)}),this.playAnimation("getReady",0,!1,!0),this.hide()},PlayerVisualGui.prototype.playAnimation=function(t,e,i,n){Player.prototype.playAnimation.call(this,t,e,i,n)},PlayerVisualGui.prototype.attachToGui=function(t){PlayerVisualGui.parent.attachToGui.call(this,t,!1)},EnemyGuiCSprite.inheritsFrom(GuiCSprite),EnemyGuiCSprite.prototype.className="EnemyGuiCSprite",EnemyGuiCSprite.prototype.createInstance=function(t){var e=new EnemyGuiCSprite;return e.initialize(t),e},guiFactory.addClass(EnemyGuiCSprite),EnemyGuiCSprite.prototype.initialize=function(t){if(Device.isSupportsToDataURL()){var e=this;if(this.params=t,"shirt"===t.type)if(null==EnemyGuiCSprite.shirtImage){var i=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4),n=(s=Account.instance.countries[Account.instance.usedFlags[i]]).shirtColor,a=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),n),o=recolorFullImage(r=Resources.getAsset(t.totalImage),a);EnemyGuiCSprite.shirtImage=new Image,EnemyGuiCSprite.shirtImage.onload=function(){e.img=EnemyGuiCSprite.shirtImage,e.init()},EnemyGuiCSprite.shirtImage.src=o}else if(isImageOk(EnemyGuiCSprite.shirtImage))this.img=EnemyGuiCSprite.shirtImage,e.init();else{c=EnemyGuiCSprite.shirtImage.onload;EnemyGuiCSprite.shirtImage.onload=function(){c&&c(),e.img=EnemyGuiCSprite.shirtImage,e.init()}}else if("pants"===t.type)if(null==EnemyGuiCSprite.pantsImage){var i=Math.floor(LVL_INDEX>19?LVL_INDEX/2-5:LVL_INDEX/4),s=Account.instance.countries[Account.instance.usedFlags[i]],n=s.pantsColor,a=new ColorRgbChangingPair(new ColorRgb(t.color[0],t.color[1],t.color[2]),n),r=Resources.getAsset(t.totalImage),o=recolorFullImage(r,a);EnemyGuiCSprite.pantsImage=new Image,EnemyGuiCSprite.pantsImage.onload=function(){e.img=EnemyGuiCSprite.pantsImage,e.init()},EnemyGuiCSprite.pantsImage.src=o}else if(isImageOk(EnemyGuiCSprite.pantsImage))this.img=EnemyGuiCSprite.pantsImage,e.init();else{var c=EnemyGuiCSprite.pantsImage.onload;EnemyGuiCSprite.pantsImage.onload=function(){c&&c(),e.img=EnemyGuiCSprite.pantsImage,e.init()}}}else EnemyGuiCSprite.parent.initialize.call(this,t)},EnemyGuiCSprite.prototype.init=function(){var t=this,e=this.params;this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this.opacity=e.opacity?e.opacity:1,this.width=e.width,this.height=e.height,this.parent=e.parent.canvas?e.parent.canvas:e.parent,this.id=this.parent.generateId.call(this),this.total={image:e.totalImage,width:e.totalImageWidth,height:e.totalImageHeight,tile:e.totalTile},this.offsetX=e.offsetX||0,this.offsetY=e.offsetY||0,this.transformOrigin=e.transformOrigin||{x:.5,y:.5},this.frameSizeScale=e.frameSizeScale||{x:1,y:1},t.imageHeight=Math.round(Math.round(t.img.height/Math.round(t.total.height/t.height))),t.imageWidth=Math.round(Math.round(t.img.width/Math.round(t.total.width/t.width))),t.scale={x:Math.round(t.width/t.imageWidth*100)/100,y:Math.round(t.height/t.imageHeight*100)/100},this.backgroundPosition={x:0,y:0},this.backgroundSize={w:this.total.width,h:this.total.height},this.rotate(0),this.resizeBackground(),this.currentAnimation=null,this.spatialAnimation=null,this.animations=new Object,e.spriteAnimations&&$.each(e.spriteAnimations,function(e,i){t.addSpriteAnimation(e,i)}),this.frames={},e.frames&&(this.frames=e.frames),this.parent.canvas?this.parent.canvas.addGui(this):this.parent.addGui(this),this.show(),this.setEnabled(!0),Account.instance.addScheduledEntity(this)},EnemyGuiCSprite.pantsImage=null,EnemyGuiCSprite.shirtImage=null,PowerLineGuiCSprite.inheritsFrom(GuiCSprite),PowerLineGuiCSprite.prototype.className="PowerLineGuiCSprite",PowerLineGuiCSprite.prototype.createInstance=function(t){var e=new PowerLineGuiCSprite;return e.initialize(t),e},guiFactory.addClass(PowerLineGuiCSprite),PowerLineGuiCSprite.prototype.render=function(t){if(this.visible){var e=this.x*Screen.widthRatio()+BattleScene.instance.canvasOffset.x,i=this.y*Screen.heightRatio()+BattleScene.instance.canvasOffset.y,n=this.width*Screen.widthRatio(),a=this.height*Screen.heightRatio(),o=this.params.width*Screen.widthRatio(),s=this.params.height*Screen.heightRatio(),r=o*this.transformOrigin.x,c=s*this.transformOrigin.y;t.translate(e+r,i+c),t.rotate(MathUtils.toRad(this.angle)),t.globalAlpha=this.opacity;var l=Math.ceil(this.backgroundPosition.x*this.imageWidth),u=Math.ceil(this.backgroundPosition.y*this.imageHeight);t.drawImage(this.img,l,u,this.imageWidth*this.frameSizeScale.x,this.imageHeight*this.frameSizeScale.y,-r,-c,n,a)}};