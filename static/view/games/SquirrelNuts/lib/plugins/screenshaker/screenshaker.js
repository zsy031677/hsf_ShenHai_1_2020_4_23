ig.module("plugins.screenshaker.screenshaker").requires("impact.entity").defines(function(){EntityScreenshaker=ig.Entity.extend({gravityFactor:0,pos:{x:0,y:0},lastPos:{x:0,y:0},maxVel:{x:1e3,y:1e3},k:200,c:5,m:1,trap:.3,resetTime:.5,resetTimer:null,timedShakeTimer:null,timedShakeIntensity:100,init:function(e,t,i){this.parent(0,0,i)},update:function(){this.lastPos.x=this.pos.x,this.lastPos.y=this.pos.y,this.accel.x=(-this.k*this.pos.x+-this.c*this.vel.x)/this.m,this.accel.y=(-this.k*this.pos.y+-this.c*this.vel.y)/this.m,this.parent(),this.handleMovementTrace(null),this.resetTimer&&this.resetTimer.delta()>=0&&(this.pos.x=0,this.pos.y=0,this.last.x=0,this.last.y=0,this.vel.x=0,this.vel.y=0,this.accel.x=0,this.accel.y=0,this.resetTimer=null)},draw:function(){},handleMovementTrace:function(e){this.pos.x+=this.vel.x*ig.system.tick,this.pos.y+=this.vel.y*ig.system.tick},kill:function(){},applyImpulse:function(e,t){this.vel.x-=e,this.vel.y-=t,this.resetTimer?this.resetTimer.reset():this.resetTimer=new ig.Timer(this.resetTime)}}),ScreenShaker=ig.Class.extend({spring:new EntityScreenshaker,update:function(e,t){if(this.timedShakeTimer)if(this.timedShakeTimer.delta()<=0){var i=randomRange(0,2*Math.PI);this.applyImpulse(this.timedShakeIntensity*Math.cos(i),this.timedShakeIntensity*Math.sin(i))}else this.timedShakeTimer=null;else this.scrollScreen(e,t);this.spring.update(),this.shakeScreen(ig.game.screen)},shakeScreen:function(e){e.x=e.x-this.spring.lastPos.x+this.spring.pos.x,e.y=e.y-this.spring.lastPos.y+this.spring.pos.y},applyImpulse:function(e,t){this.spring.applyImpulse(e,t)},timedShake:function(e,t){this.timedShakeIntensity=e,this.timedShakeTimer=new ig.Timer(t)},scrollScreen:function(e,t){t.x=0,e.vel.y<=0&&(t.y=Math.round(e.pos.y-(ig.global.gameSettings.systemHeight()-e.size.y-60)))}})});