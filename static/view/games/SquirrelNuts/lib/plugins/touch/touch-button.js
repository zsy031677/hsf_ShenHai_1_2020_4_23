ig.module("plugins.touch.touch-button").requires("impact.system","impact.input","impact.image").defines(function(){"use strict";ig.TouchButton=ig.Class.extend({action:"undefined",image:null,tile:0,pos:{x:0,y:0},size:{x:0,y:0},area:{x1:0,y1:0,x2:0,y2:0},touchX:0,touchY:0,pressed:!1,touchId:0,anchor:null,pressBool:!1,init:function(t,i,s,n,e,o){this.action=t,this.anchor=i,this.size={x:s,y:n},this.image=e||null,this.tile=o||0},align:function(t,i){"left"in this.anchor?this.pos.x=this.anchor.left:"right"in this.anchor&&(this.pos.x=t-this.anchor.right-this.size.x),"top"in this.anchor?this.pos.y=this.anchor.top:"bottom"in this.anchor&&(this.pos.y=i-this.anchor.bottom-this.size.y);var s=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,n=ig.system.scale*(s/ig.system.realWidth);this.area={x1:this.pos.x*n,y1:this.pos.y*n,x2:(this.pos.x+this.size.x)*n,y2:(this.pos.y+this.size.y)*n}},touchStart:function(t){if(!this.pressed){var i={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(i=ig.system.canvas.getBoundingClientRect());for(var s=0;s<t.touches.length;s++){var n=t.touches[s];if(this.checkStart(n.identifier,n.clientX-i.left,n.clientY-i.top))return}}},touchEnd:function(t){if(this.pressed)for(var i=0;i<t.changedTouches.length;i++)if(this.checkEnd(t.changedTouches[i].identifier))return},touchStartMS:function(t){if(!this.pressed){var i={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(i=ig.system.canvas.getBoundingClientRect()),this.checkStart(t.pointerId,t.clientX-i.left,t.clientY-i.top)}},touchEndMS:function(t){this.pressed&&this.checkEnd(t.pointerId)},checkStart:function(t,i,s){return i>this.area.x1&&i<this.area.x2&&s>this.area.y1&&s<this.area.y2&&(this.startPosition({posx:i,posy:s}),this.pressed=!0,this.touchId=t,ig.input.actions[this.action]=!0,ig.input.locks[this.action]||(ig.input.presses[this.action]=!0,ig.input.locks[this.action]=!0),!0)},startPosition:function(t){this.touchX=t.posx,this.touchY=t.posy},endPosition:function(){this.touchX=0,this.touchY=0},checkEnd:function(t){return t===this.touchId&&(this.pressed=!1,this.endPosition(),this.touchId=0,ig.input.delayedKeyup[this.action]=!0,!0)},draw:function(){this.image&&this.image.drawTile(this.pos.x,this.pos.y,this.tile,this.size.x,this.size.y)}}),ig.TouchButtonCollection=ig.Class.extend({buttons:[],init:function(t){this.buttons=t,document.addEventListener("touchstart",this.touchStart.bind(this),!1),document.addEventListener("touchend",this.touchEnd.bind(this),!1),document.addEventListener("MSPointerDown",this.touchStartMS.bind(this),!1),document.addEventListener("MSPointerUp",this.touchEndMS.bind(this),!1),document.body.style.msTouchAction="none"},touchStart:function(t){t.preventDefault();for(var i=0;i<this.buttons.length;i++)this.buttons[i].touchStart(t)},touchEnd:function(t){t.preventDefault();for(var i=0;i<this.buttons.length;i++)this.buttons[i].touchEnd(t)},touchStartMS:function(t){t.preventDefault();for(var i=0;i<this.buttons.length;i++)this.buttons[i].touchStartMS(t)},touchEndMS:function(t){t.preventDefault();for(var i=0;i<this.buttons.length;i++)this.buttons[i].touchEndMS(t)},align:function(){for(var t=ig.system.width||window.innerWidth,i=ig.system.height||window.innerHeight,s=0;s<this.buttons.length;s++)this.buttons[s].align(t,i)},draw:function(){for(var t=0;t<this.buttons.length;t++)this.buttons[t].draw()}})});