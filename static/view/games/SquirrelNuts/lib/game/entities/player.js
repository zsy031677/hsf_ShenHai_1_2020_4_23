ig.module("game.entities.player").requires("impact.entity").defines(function(){EntityPlayer=ig.Entity.extend({flip:!1,friction:{x:200,y:0},name:"player",maxYspeed:3e3,fall:!1,rotationSpeed:5,deathScreenTimer:new ig.Timer,deathScreenDelay:2,deathPlayer:!1,getBackNuts:!1,isShowedNutsScreen:!1,showMap:!0,height:0,type:ig.Entity.TYPE.A,collides:ig.Entity.COLLIDES.PASSIVE,exp:0,lvl:0,lvlMax:0,pointsSkill:0,animSheet:new ig.AnimationSheet("media/media32/hero.png",50,120),init:function(e,l,t){this.parent(e,l,t),this.size={x:26,y:85},this.offset={x:12,y:35},this.addAnim("idle",1,[0]),this.addAnim("attack",.1,[1,2]),this.deathScreenTimer.reset(),this.deathScreenTimer.pause(),ig.global.playerController.getBackNuts&&(ig.global.playerController.isShowedNutsScreen=!0,ig.global.playerController.showMap=!1),this.loadExperience(ig.global.playerController),ig.global.playerController.health=ig.global.playerController.healthSkill+ig.global.playerController.pointHealth*ig.global.playerController.amountHealth,this.maxVel={x:Math.round((ig.global.playerController.speedSkill+ig.global.playerController.pointSpeed*ig.global.playerController.amountSpeed)/2),y:ig.global.playerController.startLaunch},this.vel.y=-1*ig.global.playerController.startLaunch,this.currentAnim.pivot.y=this.size.y,ig.game.fadeScreen=new ig.ScreenFader({fade:"out",speed:1,callback:function(){ig.game.fadeScreen=null}}),ig.game.spawnEntity(EntityGameInterface,0,0)},update:function(){1==this.currentAnim.frame&&(this.currentAnim=this.anims.idle),this.vel.y>0&&(this.fall=!0),this.fall?(this.deathScreenTimer.unpause(),this.currentAnim.angle+=this.rotationSpeed*ig.system.tick,this.deathScreenTimer.delta()>this.deathScreenDelay&&!this.deathPlayer&&(this.deathPlayer=!0,ig.game.spawnEntity(EntityDeadScreen,0,0))):(this.height=-1*Math.round(ig.game.playerVar.pos.y/50),this.height<0&&(this.height=0)),this.movePlayer(),this.parent(),this.collisionScreen()},receiveDamage:function(e){this.fall||(this.vel.y+=-1*(e.bounce+e.bounce*(ig.global.playerController.bounceSkill+ig.global.playerController.pointBounce*ig.global.playerController.amountBounce)),this.vel.y>-1*this.maxYSpeed&&(this.vel.y=-1*this.maxYSpeed),this.takeHealth(e.damage)&&(this.fall=!0))},attack:function(e){this.fall||(ig.game.spawnEntity(EntitySlash,e.pos.x+e.size.x/2,e.pos.y+e.size.y/2,{vel:e.vel}),this.currentAnim=this.anims.attack,this.currentAnim.rewind())},movePlayer:function(){ig.input.state("left")||ig.global.gameController.action(ig.global.gameSettings.systemWidth()/2,ig.global.gameSettings.systemHeight(),0,0,"state",{x:0,y:0})?(this.accel.x=-1*(ig.global.playerController.speedSkill+ig.global.playerController.pointSpeed*ig.global.playerController.amountSpeed),this.flip=!1):ig.input.state("right")||ig.global.gameController.action(ig.global.gameSettings.systemWidth()/2,ig.global.gameSettings.systemHeight(),ig.global.gameSettings.systemWidth()/2,0,"state",{x:0,y:0})?(this.accel.x=ig.global.playerController.speedSkill+ig.global.playerController.pointSpeed*ig.global.playerController.amountSpeed,this.flip=!0):this.accel.x=0,this.currentAnim.flip.x=this.flip,this.anims.attack.flip.x=this.flip},collisionScreen:function(){this.pos.x<0?this.pos.x=0:this.pos.x+this.size.x>ig.global.gameSettings.systemWidth()?this.pos.x=ig.global.gameSettings.systemWidth()-this.size.x:this.pos.y-this.size.y/2>ig.game.screen.y+ig.global.gameSettings.systemHeight()&&(this.fall=!0)},takeHealth:function(e){return ig.global.playerController.health-=e,ig.global.playerController.health<0&&(ig.global.playerController.health=0,!0)},giveHealth:function(e){ig.global.playerController.health-=e,ig.global.playerController.health>ig.global.playerController.healthSkill+ig.global.playerController.pointHealth*ig.global.playerController.amountHealth&&(ig.global.playerController.health=ig.global.playerController.healthSkill+ig.global.playerController.pointHealth*ig.global.playerController.amountHealth)},loadExperience:function(e){this.lvl=e.level,this.lvlMax=e.nextLvlExp,this.exp=e.exp,this.pointsSkill=e.pointsSkill,this.getBackNuts=e.getBackNuts,this.isShowedNutsScreen=e.isShowedNutsScreen,this.showMap=e.showMap},saveExperience:function(e){e.level=this.lvl,e.nextLvlExp=this.lvlMax,e.exp=this.exp,e.pointsSkill=this.pointsSkill,e.getBackNuts=this.getBackNuts,e.isShowedNutsScreen=this.isShowedNutsScreen,e.showMap=this.showMap}})});