ig.module("impact.animation").requires("impact.timer","impact.image").defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(t,i,e){this.width=i,this.height=e,this.image=new ig.Image(t)}}),ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:!1,y:!1},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(t,i,e,s){this.sheet=t,this.pivot={x:t.width/2,y:t.height/2},this.timer=new ig.Timer,this.frameTime=i,this.sequence=e,this.stop=!!s,this.tile=this.sequence[0]},rewind:function(){return this.timer.set(),this.loopCount=0,this.frame=0,this.tile=this.sequence[0],this},gotoFrame:function(t){this.timer.set(this.frameTime*-t-1e-4),this.update()},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var t=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(t/this.sequence.length),this.stop&&this.loopCount>0?this.frame=this.sequence.length-1:this.frame=t%this.sequence.length,this.tile=this.sequence[this.frame]},draw:function(t,i){var e=Math.max(this.sheet.width,this.sheet.height);t>ig.system.width||i>ig.system.height||t+e<0||i+e<0||(1!=this.alpha&&(ig.system.context.globalAlpha=this.alpha),0==this.angle?this.sheet.image.drawTile(t,i,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(t+this.pivot.x),ig.system.getDrawPos(i+this.pivot.y)),ig.system.context.rotate(this.angle),this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y),ig.system.context.restore()),1!=this.alpha&&(ig.system.context.globalAlpha=1))}})});